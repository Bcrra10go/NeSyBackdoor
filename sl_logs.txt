# Hyperparameters and Configuration
CONFIG = {
    'random_seed': 42,
    'batch_size': 64,
    'epochs': 5,
    'test_size': 0.2,
    'num_attributes': 40,
    'image_size': 64,
    'labeled_ratio': 1, # fully labeled
    'learning_rate': 0.001,
    'bce_weight': 5,
    'sl_weight': 0.3,
    'threshold': 0.6,
    'sdd_path' : '../constraints/celebA.sdd',
    'vtree_path' : '../constraints/celebA.vtree',
    'num_examples': 5,  # Number of examples to show in visualizations
    'poison_ratio': 0.1,  # Ratio of labeled data to poison
    'trigger_size': 5,  # Size of the trigger pattern
    'target_attributes': [5],  # Indices of attributes to target (Bangs)
    'attr_names': ['5_o_Clock_Shadow', 'Arched_Eyebrows', 'Attractive', 'Bags_Under_Eyes',
                   'Bald', 'Bangs', 'Big_Lips', 'Big_Nose', 'Black_Hair', 'Blond_Hair',
                   'Blurry', 'Brown_Hair', 'Bushy_Eyebrows', 'Chubby', 'Double_Chin',
                   'Eyeglasses', 'Goatee', 'Gray_Hair', 'Heavy_Makeup', 'High_Cheekbones',
                   'Male', 'Mouth_Slightly_Open', 'Mustache', 'Narrow_Eyes', 'No_Beard',
                   'Oval_Face', 'Pale_Skin', 'Pointy_Nose', 'Receding_Hairline', 'Rosy_Cheeks',
                   'Sideburns', 'Smiling', 'Straight_Hair', 'Wavy_Hair', 'Wearing_Earrings',
                   'Wearing_Hat', 'Wearing_Lipstick', 'Wearing_Necklace', 'Wearing_Necktie', 'Young'],
    'device': 'mps' if torch.backends.mps.is_available() else 'cpu'
}


/Users/diegobecerra/PycharmProjects/PythonProject/.venv/bin/python /Users/diegobecerra/PycharmProjects/PythonProject/celeba/semantic_loss_attack/semantic_loss_badnets.py
Epoch 1/5: 100%|██████████| 2035/2035 [04:29<00:00,  7.55batch/s]

Epoch 1 Losses:
BCE Loss: 0.9195
Semantic Loss: 2.4645
Total Loss: 1.6588

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      64.65%         33.91%          95.39%     1189   27708   3506    29048
Arched_Eyebrows       74.42%         73.26%          75.59%     6351   18054   8669    23885
Attractive            59.53%         98.96%          20.10%     16490   3194   16663    15891
Bags_Under_Eyes       59.32%         23.92%          94.73%     1587   24552   6636    25918
Bald                  74.23%         50.47%          98.00%      376   31172    745    31809
Bangs                 86.44%         85.82%          87.07%     4205   24079   4900    27654
Big_Lips              63.68%         71.26%          56.10%     5611   13845   7874    24680
Big_Nose              62.60%         30.55%          94.65%     2378   23445   7784    24770
Black_Hair            84.67%         81.14%          88.19%     6352   21805   7828    24726
Blond_Hair            89.08%         82.64%          95.53%     3937   26547   4764    27790
Blurry                51.40%          3.26%          99.54%       56   30696   1716    30838
Brown_Hair            74.70%         58.26%          91.13%     3898   23570   6691    25863
Bushy_Eyebrows        71.77%         53.97%          89.57%     2536   24951   4699    27855
Chubby                68.60%         41.09%          96.10%      791   29435   1925    30629
Double_Chin           71.73%         47.09%          96.36%      728   29880   1546    31008
Eyeglasses            86.28%         77.96%          94.61%     1680   28760   2155    30399
Goatee                80.29%         64.99%          95.59%     1359   29121   2091    30463
Gray_Hair             79.53%         61.27%          97.79%      859   30462   1402    31152
Heavy_Makeup          87.21%         94.96%          79.45%     11842   15956   12470    20084
High_Cheekbones       80.12%         90.01%          70.24%     13286   12498   14761    17793
Male                  93.11%         98.00%          88.23%     13379   16677   13652    18902
Mouth_Slightly_Open   64.24%         94.51%          33.97%     14848   5721   15711    16843
Mustache              69.07%         41.09%          97.05%      551   30293   1341    31213
Narrow_Eyes           53.06%          7.99%          98.12%      301   28247   3765    28789
No_Beard              80.27%         94.23%          66.30%     25679   3516   27251    5303
Oval_Face             62.31%         78.16%          46.46%     7150   10874   9148    23406
Pale_Skin             72.03%         46.09%          97.97%      642   30528   1393    31161
Pointy_Nose           64.17%         80.19%          48.14%     7162   11373   8931    23623
Receding_Hairline     66.62%         37.49%          95.74%      998   28620   2662    29892
Rosy_Cheeks           67.34%         37.42%          97.26%      769   29664   2055    30499
Sideburns             77.73%         59.03%          96.42%     1052   29669   1782    30772
Smiling               85.16%         91.61%          78.71%     14283   13352   15591    16963
Straight_Hair         58.04%         28.14%          87.94%     1902   22684   6760    25794
Wavy_Hair             70.86%         56.84%          84.88%     5865   18874   10319    22235
Wearing_Earrings      72.81%         66.03%          79.58%     4001   21085   6059    26495
Wearing_Hat           85.27%         72.17%          98.38%     1198   30393   1660    30894
Wearing_Lipstick      90.49%         93.10%          87.87%     14172   15230   15222    17332
Wearing_Necklace      67.67%         63.19%          72.14%     2474   20660   3915    28639
Wearing_Necktie       81.73%         69.93%          93.52%     1691   28184   2418    30136
Young                 64.69%         97.91%          31.48%     24819   2268   25350    7204

Overall Statistics:
True Positive Accuracy: 63.45%
True Negative Accuracy: 82.40%
Average Balanced Accuracy: 72.92%

Evaluating on poisoned validation data:
Epoch 2/5:   0%|          | 0/2035 [00:00<?, ?batch/s]
Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      66.10%         37.39%          94.81%     1311   27539   3506    29048
Arched_Eyebrows       73.48%         68.05%          78.92%     5899   18850   8669    23885
Attractive            60.07%         98.82%          21.33%     16466   3389   16663    15891
Bags_Under_Eyes       59.59%         24.67%          94.52%     1637   24497   6636    25918
Bald                  76.34%         55.03%          97.65%      410   31060    745    31809
Bangs                 48.65%         97.29%           0.00%     31672      0   32554       0
Big_Lips              63.81%         73.81%          53.80%     5812   13279   7874    24680
Big_Nose              63.59%         33.48%          93.70%     2606   23209   7784    24770
Black_Hair            84.33%         80.33%          88.33%     6288   21840   7828    24726
Blond_Hair            88.46%         80.94%          95.97%     3856   26670   4764    27790
Blurry                52.52%          6.00%          99.04%      103   30543   1716    30838
Brown_Hair            76.07%         62.70%          89.44%     4195   23132   6691    25863
Bushy_Eyebrows        72.71%         57.93%          87.50%     2722   24373   4699    27855
Chubby                70.31%         45.09%          95.53%      868   29260   1925    30629
Double_Chin           72.71%         49.68%          95.74%      768   29686   1546    31008
Eyeglasses            84.71%         72.71%          96.70%     1567   29395   2155    30399
Goatee                80.98%         66.76%          95.20%     1396   29000   2091    30463
Gray_Hair             80.81%         64.27%          97.35%      901   30326   1402    31152
Heavy_Makeup          87.17%         94.68%          79.66%     11807   15999   12470    20084
High_Cheekbones       80.41%         89.47%          71.35%     13207   12696   14761    17793
Male                  92.73%         98.23%          87.23%     13411   16488   13652    18902
Mouth_Slightly_Open   66.93%         92.45%          41.40%     14525   6973   15711    16843
Mustache              70.00%         43.25%          96.74%      580   30197   1341    31213
Narrow_Eyes           52.83%          7.36%          98.31%      277   28303   3765    28789
No_Beard              79.65%         94.64%          64.66%     25790   3429   27251    5303
Oval_Face             62.62%         76.52%          48.72%     7000   11404   9148    23406
Pale_Skin             68.45%         38.41%          98.49%      535   30690   1393    31161
Pointy_Nose           64.11%         79.59%          48.63%     7108   11488   8931    23623
Receding_Hairline     65.83%         35.57%          96.08%      947   28719   2662    29892
Rosy_Cheeks           69.32%         42.04%          96.60%      864   29463   2055    30499
Sideburns             78.48%         61.00%          95.97%     1087   29531   1782    30772
Smiling               85.22%         91.20%          79.24%     14219   13441   15591    16963
Straight_Hair         57.87%         27.78%          87.96%     1878   22689   6760    25794
Wavy_Hair             70.64%         56.01%          85.27%     5780   18959   10319    22235
Wearing_Earrings      71.99%         62.75%          81.24%     3802   21524   6059    26495
Wearing_Hat           77.10%         54.82%          99.39%      910   30705   1660    30894
Wearing_Lipstick      90.48%         93.01%          87.96%     14158   15245   15222    17332
Wearing_Necklace      68.00%         65.34%          70.66%     2558   20236   3915    28639
Wearing_Necktie       82.56%         72.29%          92.83%     1748   27975   2418    30136
Young                 60.90%         99.08%          22.72%     25116   1637   25350    7204

Overall Statistics:
True Positive Accuracy: 63.76%
True Negative Accuracy: 80.17%
Average Balanced Accuracy: 71.96%
Backdoor Attack Success Rate: 97.29%
Epoch 2/5: 100%|██████████| 2035/2035 [02:43<00:00, 12.43batch/s]

Epoch 2 Losses:
BCE Loss: 0.7434
Semantic Loss: 2.1969
Total Loss: 1.4024

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      71.73%         49.17%          94.28%     1724   27386   3506    29048
Arched_Eyebrows       76.98%         80.37%          73.59%     6967   17576   8669    23885
Attractive            64.04%         97.14%          30.95%     16186   4918   16663    15891
Bags_Under_Eyes       63.36%         34.83%          91.90%     2311   23819   6636    25918
Bald                  70.15%         41.48%          98.82%      309   31434    745    31809
Bangs                 88.59%         84.41%          92.76%     4136   25653   4900    27654
Big_Lips              64.88%         69.76%          60.00%     5493   14808   7874    24680
Big_Nose              64.33%         35.05%          93.61%     2728   23186   7784    24770
Black_Hair            86.36%         89.88%          82.84%     7036   20483   7828    24726
Blond_Hair            89.34%         83.14%          95.53%     3961   26547   4764    27790
Blurry                51.65%          3.73%          99.57%       64   30705   1716    30838
Brown_Hair            68.32%         40.52%          96.13%     2711   24861   6691    25863
Bushy_Eyebrows        71.49%         48.20%          94.78%     2265   26402   4699    27855
Chubby                75.61%         57.66%          93.55%     1110   28654   1925    30629
Double_Chin           73.33%         50.32%          96.34%      778   29872   1546    31008
Eyeglasses            86.97%         75.41%          98.53%     1625   29952   2155    30399
Goatee                84.04%         72.17%          95.92%     1509   29221   2091    30463
Gray_Hair             85.51%         74.25%          96.77%     1041   30146   1402    31152
Heavy_Makeup          87.28%         97.59%          76.97%     12169   15459   12470    20084
High_Cheekbones       84.19%         86.69%          81.68%     12797   14533   14761    17793
Male                  94.70%         97.71%          91.70%     13339   17333   13652    18902
Mouth_Slightly_Open   78.59%         87.47%          69.71%     13743   11742   15711    16843
Mustache              75.15%         54.36%          95.93%      729   29943   1341    31213
Narrow_Eyes           57.12%         18.59%          95.65%      700   27536   3765    28789
No_Beard              84.49%         94.96%          74.01%     25878   3925   27251    5303
Oval_Face             64.24%         66.42%          62.07%     6076   14528   9148    23406
Pale_Skin             72.59%         47.02%          98.16%      655   30588   1393    31161
Pointy_Nose           66.56%         79.49%          53.64%     7099   12672   8931    23623
Receding_Hairline     73.83%         54.47%          93.19%     1450   27857   2662    29892
Rosy_Cheeks           80.69%         67.40%          93.98%     1385   28664   2055    30499
Sideburns             84.97%         74.86%          95.07%     1334   29256   1782    30772
Smiling               88.94%         90.05%          87.84%     14039   14900   15591    16963
Straight_Hair         63.35%         43.02%          83.69%     2908   21587   6760    25794
Wavy_Hair             69.69%         46.47%          92.91%     4795   20658   10319    22235
Wearing_Earrings      75.88%         70.52%          81.25%     4273   21526   6059    26495
Wearing_Hat           88.56%         78.55%          98.57%     1304   30451   1660    30894
Wearing_Lipstick      91.24%         96.51%          85.98%     14690   14902   15222    17332
Wearing_Necklace      62.82%         38.01%          87.63%     1488   25096   3915    28639
Wearing_Necktie       87.96%         86.77%          89.16%     2098   26870   2418    30136
Young                 69.14%         95.66%          42.62%     24249   3070   25350    7204

Overall Statistics:
True Positive Accuracy: 66.50%
True Negative Accuracy: 85.43%
Average Balanced Accuracy: 75.97%

Evaluating on poisoned validation data:
Epoch 3/5:   0%|          | 0/2035 [00:00<?, ?batch/s]
Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      70.00%         44.84%          95.15%     1572   27640   3506    29048
Arched_Eyebrows       76.42%         76.56%          76.28%     6637   18220   8669    23885
Attractive            63.37%         97.46%          29.29%     16239   4655   16663    15891
Bags_Under_Eyes       63.35%         34.78%          91.92%     2308   23823   6636    25918
Bald                  80.78%         64.16%          97.40%      478   30982    745    31809
Bangs                 49.78%         99.57%           0.00%     32413      0   32554       0
Big_Lips              64.73%         69.14%          60.32%     5444   14886   7874    24680
Big_Nose              65.36%         37.65%          93.06%     2931   23050   7784    24770
Black_Hair            85.62%         93.27%          77.97%     7301   19278   7828    24726
Blond_Hair            89.07%         82.33%          95.81%     3922   26625   4764    27790
Blurry                50.70%          1.57%          99.83%       27   30787   1716    30838
Brown_Hair            67.34%         38.23%          96.46%     2558   24947   6691    25863
Bushy_Eyebrows        73.34%         53.63%          93.05%     2520   25920   4699    27855
Chubby                75.46%         57.14%          93.77%     1100   28722   1925    30629
Double_Chin           74.39%         52.78%          96.00%      816   29769   1546    31008
Eyeglasses            86.58%         74.71%          98.45%     1610   29927   2155    30399
Goatee                84.30%         73.08%          95.52%     1528   29098   2091    30463
Gray_Hair             85.93%         75.39%          96.48%     1057   30054   1402    31152
Heavy_Makeup          87.56%         97.24%          77.89%     12126   15643   12470    20084
High_Cheekbones       84.07%         87.11%          81.03%     12859   14417   14761    17793
Male                  94.26%         98.21%          90.32%     13407   17073   13652    18902
Mouth_Slightly_Open   78.06%         87.44%          68.68%     13737   11567   15711    16843
Mustache              75.57%         55.63%          95.50%      746   29809   1341    31213
Narrow_Eyes           57.21%         19.28%          95.14%      726   27390   3765    28789
No_Beard              84.40%         94.72%          74.07%     25812   3928   27251    5303
Oval_Face             63.95%         62.46%          65.43%     5714   15315   9148    23406
Pale_Skin             65.45%         31.95%          98.96%      445   30836   1393    31161
Pointy_Nose           66.75%         74.61%          58.90%     6663   13914   8931    23623
Receding_Hairline     73.02%         52.44%          93.60%     1396   27980   2662    29892
Rosy_Cheeks           78.26%         61.27%          95.25%     1259   29051   2055    30499
Sideburns             84.36%         73.63%          95.10%     1312   29263   1782    30772
Smiling               88.78%         90.24%          87.31%     14070   14811   15591    16963
Straight_Hair         64.25%         51.57%          76.93%     3486   19843   6760    25794
Wavy_Hair             68.20%         42.03%          94.37%     4337   20983   10319    22235
Wearing_Earrings      75.53%         70.34%          80.72%     4262   21386   6059    26495
Wearing_Hat           78.78%         58.01%          99.55%      963   30755   1660    30894
Wearing_Lipstick      91.30%         96.21%          86.40%     14645   14974   15222    17332
Wearing_Necklace      63.31%         40.36%          86.26%     1580   24705   3915    28639
Wearing_Necktie       87.97%         86.48%          89.47%     2091   26963   2418    30136
Young                 63.88%         98.79%          28.98%     25042   2088   25350    7204

Overall Statistics:
True Positive Accuracy: 66.41%
True Negative Accuracy: 82.67%
Average Balanced Accuracy: 74.54%
Backdoor Attack Success Rate: 99.57%
Epoch 3/5: 100%|██████████| 2035/2035 [02:43<00:00, 12.44batch/s]

Epoch 3 Losses:
BCE Loss: 0.6950
Semantic Loss: 2.1534
Total Loss: 1.3410

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      73.07%         51.31%          94.83%     1799   27546   3506    29048
Arched_Eyebrows       77.53%         84.16%          70.89%     7296   16933   8669    23885
Attractive            62.30%         98.97%          25.62%     16491   4072   16663    15891
Bags_Under_Eyes       60.45%         26.18%          94.73%     1737   24552   6636    25918
Bald                  72.35%         45.77%          98.92%      341   31465    745    31809
Bangs                 90.16%         86.80%          93.53%     4253   25865   4900    27654
Big_Lips              65.81%         69.38%          62.24%     5463   15362   7874    24680
Big_Nose              65.07%         35.21%          94.93%     2741   23513   7784    24770
Black_Hair            83.92%         75.46%          92.37%     5907   22840   7828    24726
Blond_Hair            91.52%         88.20%          94.84%     4202   26357   4764    27790
Blurry                52.10%          4.60%          99.59%       79   30713   1716    30838
Brown_Hair            76.25%         61.37%          91.13%     4106   23569   6691    25863
Bushy_Eyebrows        75.45%         58.76%          92.15%     2761   25669   4699    27855
Chubby                75.16%         54.86%          95.47%     1056   29240   1925    30629
Double_Chin           71.83%         46.05%          97.60%      712   30263   1546    31008
Eyeglasses            88.12%         77.26%          98.97%     1665   30086   2155    30399
Goatee                85.83%         76.04%          95.61%     1590   29127   2091    30463
Gray_Hair             78.58%         58.63%          98.53%      822   30693   1402    31152
Heavy_Makeup          86.27%         98.82%          73.72%     12323   14805   12470    20084
High_Cheekbones       84.42%         88.29%          80.55%     13033   14333   14761    17793
Male                  95.99%         96.45%          95.53%     13167   18057   13652    18902
Mouth_Slightly_Open   80.88%         92.66%          69.09%     14558   11637   15711    16843
Mustache              74.51%         52.35%          96.66%      702   30172   1341    31213
Narrow_Eyes           60.66%         29.51%          91.81%     1111   26431   3765    28789
No_Beard              84.32%         95.21%          73.43%     25945   3894   27251    5303
Oval_Face             65.10%         70.66%          59.54%     6464   13935   9148    23406
Pale_Skin             88.01%         83.99%          92.04%     1170   28680   1393    31161
Pointy_Nose           67.54%         71.86%          63.21%     6418   14932   8931    23623
Receding_Hairline     66.60%         36.06%          97.13%      960   29035   2662    29892
Rosy_Cheeks           86.41%         81.36%          91.47%     1672   27896   2055    30499
Sideburns             82.28%         67.79%          96.77%     1208   29777   1782    30772
Smiling               89.49%         93.17%          85.81%     14526   14556   15591    16963
Straight_Hair         68.46%         56.42%          80.50%     3814   20764   6760    25794
Wavy_Hair             73.81%         58.64%          88.99%     6051   19786   10319    22235
Wearing_Earrings      77.53%         74.17%          80.89%     4494   21433   6059    26495
Wearing_Hat           89.20%         79.82%          98.59%     1325   30457   1660    30894
Wearing_Lipstick      90.74%         98.01%          83.47%     14919   14467   15222    17332
Wearing_Necklace      64.84%         44.55%          85.13%     1744   24379   3915    28639
Wearing_Necktie       85.46%         75.52%          95.41%     1826   28752   2418    30136
Young                 64.69%         98.36%          31.02%     24934   2235   25350    7204

Overall Statistics:
True Positive Accuracy: 68.57%
True Negative Accuracy: 85.07%
Average Balanced Accuracy: 76.82%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      76.04%         58.39%          93.69%     2047   27215   3506    29048
Arched_Eyebrows       76.96%         77.97%          75.94%     6759   18139   8669    23885
Attractive            65.08%         98.25%          31.90%     16371   5070   16663    15891
Bags_Under_Eyes       62.95%         33.57%          92.33%     2228   23930   6636    25918
Bald                  81.91%         65.91%          97.92%      491   31147    745    31809
Bangs                 49.32%         98.65%           0.00%     32113      0   32554       0
Big_Lips              65.91%         68.94%          62.88%     5428   15519   7874    24680
Big_Nose              67.73%         43.11%          92.35%     3356   22876   7784    24770
Black_Hair            83.41%         73.90%          92.92%     5785   22975   7828    24726
Blond_Hair            90.86%         86.52%          95.20%     4122   26455   4764    27790
Blurry                52.72%          6.06%          99.38%      104   30648   1716    30838
Brown_Hair            76.82%         64.18%          89.47%     4294   23140   6691    25863
Bushy_Eyebrows        75.89%         60.95%          90.83%     2864   25300   4699    27855
Chubby                76.09%         57.25%          94.94%     1102   29080   1925    30629
Double_Chin           73.18%         49.48%          96.88%      765   30041   1546    31008
Eyeglasses            89.43%         80.84%          98.03%     1742   29801   2155    30399
Goatee                85.46%         75.23%          95.68%     1573   29148   2091    30463
Gray_Hair             83.08%         68.54%          97.61%      961   30406   1402    31152
Heavy_Makeup          87.03%         98.15%          75.91%     12239   15246   12470    20084
High_Cheekbones       83.33%         90.62%          76.04%     13377   13530   14761    17793
Male                  95.48%         97.96%          92.99%     13374   17577   13652    18902
Mouth_Slightly_Open   81.20%         92.19%          70.21%     14484   11826   15711    16843
Mustache              75.69%         55.03%          96.35%      738   30073   1341    31213
Narrow_Eyes           58.36%         21.91%          94.80%      825   27292   3765    28789
No_Beard              82.12%         95.92%          68.32%     26140   3623   27251    5303
Oval_Face             65.06%         69.84%          60.29%     6389   14111   9148    23406
Pale_Skin             85.07%         76.38%          93.75%     1064   29213   1393    31161
Pointy_Nose           67.32%         69.68%          64.97%     6223   15348   8931    23623
Receding_Hairline     67.00%         36.93%          97.08%      983   29018   2662    29892
Rosy_Cheeks           85.02%         77.23%          92.82%     1587   28309   2055    30499
Sideburns             80.99%         64.98%          97.00%     1158   29850   1782    30772
Smiling               88.69%         94.50%          82.89%     14734   14060   15591    16963
Straight_Hair         68.82%         62.22%          75.42%     4206   19454   6760    25794
Wavy_Hair             73.32%         57.22%          89.42%     5905   19882   10319    22235
Wearing_Earrings      77.31%         74.80%          79.82%     4532   21147   6059    26495
Wearing_Hat           82.10%         64.76%          99.44%     1075   30722   1660    30894
Wearing_Lipstick      91.28%         97.14%          85.42%     14786   14805   15222    17332
Wearing_Necklace      66.63%         52.59%          80.67%     2059   23103   3915    28639
Wearing_Necktie       87.06%         80.11%          94.01%     1937   28332   2418    30136
Young                 62.36%         99.29%          25.43%     25169   1832   25350    7204

Overall Statistics:
True Positive Accuracy: 69.93%
True Negative Accuracy: 82.28%
Average Balanced Accuracy: 76.10%
Backdoor Attack Success Rate: 98.65%
Epoch 4/5: 100%|██████████| 2035/2035 [05:14<00:00,  6.47batch/s]

Epoch 4 Losses:
BCE Loss: 0.6700
Semantic Loss: 2.1172
Total Loss: 1.3051

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      78.54%         64.49%          92.59%     2261   26895   3506    29048
Arched_Eyebrows       77.26%         83.26%          71.25%     7218   17019   8669    23885
Attractive            65.01%         98.03%          31.98%     16335   5082   16663    15891
Bags_Under_Eyes       63.17%         34.61%          91.74%     2297   23776   6636    25918
Bald                  77.68%         56.64%          98.72%      422   31402    745    31809
Bangs                 89.52%         83.71%          95.33%     4102   26363   4900    27654
Big_Lips              66.13%         67.74%          64.51%     5334   15922   7874    24680
Big_Nose              67.38%         42.52%          92.24%     3310   22847   7784    24770
Black_Hair            86.69%         85.58%          87.80%     6699   21709   7828    24726
Blond_Hair            91.26%         87.09%          95.43%     4149   26520   4764    27790
Blurry                53.46%          7.58%          99.34%      130   30634   1716    30838
Brown_Hair            79.03%         68.88%          89.17%     4609   23062   6691    25863
Bushy_Eyebrows        76.37%         60.29%          92.46%     2833   25754   4699    27855
Chubby                77.73%         61.40%          94.06%     1182   28810   1925    30629
Double_Chin           72.41%         47.48%          97.33%      734   30181   1546    31008
Eyeglasses            90.30%         82.13%          98.47%     1770   29935   2155    30399
Goatee                87.80%         80.58%          95.02%     1685   28947   2091    30463
Gray_Hair             83.15%         68.05%          98.25%      954   30607   1402    31152
Heavy_Makeup          86.35%         98.99%          73.70%     12344   14802   12470    20084
High_Cheekbones       83.07%         90.93%          75.22%     13422   13384   14761    17793
Male                  96.09%         97.30%          94.88%     13283   17934   13652    18902
Mouth_Slightly_Open   82.34%         94.20%          70.48%     14799   11871   15711    16843
Mustache              75.20%         53.91%          96.48%      723   30114   1341    31213
Narrow_Eyes           66.52%         51.69%          81.35%     1946   23420   3765    28789
No_Beard              86.04%         94.38%          77.71%     25719   4121   27251    5303
Oval_Face             63.81%         79.97%          47.65%     7316   11154   9148    23406
Pale_Skin             71.05%         43.50%          98.59%      606   30722   1393    31161
Pointy_Nose           67.68%         68.70%          66.65%     6136   15745   8931    23623
Receding_Hairline     72.42%         50.04%          94.80%     1332   28338   2662    29892
Rosy_Cheeks           80.36%         64.72%          96.01%     1330   29282   2055    30499
Sideburns             85.77%         75.76%          95.79%     1350   29476   1782    30772
Smiling               89.43%         92.35%          86.52%     14398   14676   15591    16963
Straight_Hair         63.50%         36.98%          90.01%     2500   23217   6760    25794
Wavy_Hair             78.49%         75.71%          81.26%     7813   18069   10319    22235
Wearing_Earrings      77.28%         71.30%          83.26%     4320   22059   6059    26495
Wearing_Hat           86.95%         74.64%          99.27%     1239   30667   1660    30894
Wearing_Lipstick      91.02%         98.40%          83.64%     14978   14496   15222    17332
Wearing_Necklace      59.85%         27.36%          92.34%     1071   26445   3915    28639
Wearing_Necktie       87.45%         80.56%          94.34%     1948   28431   2418    30136
Young                 68.44%         97.20%          39.69%     24641   2859   25350    7204

Overall Statistics:
True Positive Accuracy: 69.97%
True Negative Accuracy: 85.13%
Average Balanced Accuracy: 77.55%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      78.39%         63.63%          93.16%     2231   27060   3506    29048
Arched_Eyebrows       77.52%         84.07%          70.98%     7288   16953   8669    23885
Attractive            63.16%         98.57%          27.76%     16424   4412   16663    15891
Bags_Under_Eyes       62.45%         32.34%          92.56%     2146   23990   6636    25918
Bald                  83.88%         69.66%          98.09%      519   31202    745    31809
Bangs                 49.43%         98.86%           0.00%     32184      0   32554       0
Big_Lips              66.14%         71.27%          61.01%     5612   15057   7874    24680
Big_Nose              66.59%         39.97%          93.22%     3111   23090   7784    24770
Black_Hair            86.55%         85.53%          87.57%     6695   21653   7828    24726
Blond_Hair            90.48%         84.84%          96.11%     4042   26709   4764    27790
Blurry                55.20%         11.60%          98.81%      199   30471   1716    30838
Brown_Hair            79.33%         70.15%          88.50%     4694   22888   6691    25863
Bushy_Eyebrows        76.34%         60.89%          91.80%     2861   25572   4699    27855
Chubby                73.31%         50.65%          95.98%      975   29397   1925    30629
Double_Chin           70.05%         42.11%          98.00%      651   30387   1546    31008
Eyeglasses            88.64%         78.33%          98.95%     1688   30079   2155    30399
Goatee                86.45%         77.38%          95.51%     1618   29096   2091    30463
Gray_Hair             82.96%         67.76%          98.16%      950   30578   1402    31152
Heavy_Makeup          86.16%         99.01%          73.32%     12346   14725   12470    20084
High_Cheekbones       82.45%         92.59%          72.31%     13667   12866   14761    17793
Male                  96.05%         96.93%          95.16%     13233   17988   13652    18902
Mouth_Slightly_Open   82.32%         93.93%          70.72%     14757   11911   15711    16843
Mustache              70.65%         44.00%          97.30%      590   30371   1341    31213
Narrow_Eyes           66.23%         50.65%          81.81%     1907   23553   3765    28789
No_Beard              84.57%         95.46%          73.68%     26015   3907   27251    5303
Oval_Face             63.60%         80.59%          46.61%     7372   10910   9148    23406
Pale_Skin             68.83%         38.77%          98.90%      540   30818   1393    31161
Pointy_Nose           68.10%         71.57%          64.64%     6392   15269   8931    23623
Receding_Hairline     70.03%         44.18%          95.88%     1176   28660   2662    29892
Rosy_Cheeks           78.67%         60.83%          96.51%     1250   29434   2055    30499
Sideburns             83.84%         71.32%          96.35%     1271   29650   1782    30772
Smiling               89.30%         93.31%          85.30%     14548   14469   15591    16963
Straight_Hair         63.47%         38.31%          88.62%     2590   22859   6760    25794
Wavy_Hair             78.26%         74.11%          82.41%     7647   18323   10319    22235
Wearing_Earrings      77.54%         72.21%          82.88%     4375   21958   6059    26495
Wearing_Hat           74.09%         48.43%          99.74%      804   30815   1660    30894
Wearing_Lipstick      90.84%         98.52%          83.16%     14996   14414   15222    17332
Wearing_Necklace      60.62%         29.99%          91.25%     1174   26134   3915    28639
Wearing_Necktie       86.86%         79.69%          94.03%     1927   28337   2418    30136
Young                 61.91%         99.33%          24.49%     25181   1764   25350    7204

Overall Statistics:
True Positive Accuracy: 69.03%
True Negative Accuracy: 82.03%
Average Balanced Accuracy: 75.53%
Backdoor Attack Success Rate: 98.86%
Epoch 5/5: 100%|██████████| 2035/2035 [02:23<00:00, 14.16batch/s]

Epoch 5 Losses:
BCE Loss: 0.6540
Semantic Loss: 2.0989
Total Loss: 1.2837

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      75.77%         56.53%          95.02%     1982   27600   3506    29048
Arched_Eyebrows       78.07%         83.68%          72.46%     7254   17307   8669    23885
Attractive            65.85%         97.74%          33.96%     16287   5397   16663    15891
Bags_Under_Eyes       64.71%         39.15%          90.26%     2598   23394   6636    25918
Bald                  69.82%         40.27%          99.37%      300   31610    745    31809
Bangs                 91.14%         88.00%          94.28%     4312   26071   4900    27654
Big_Lips              66.75%         77.38%          56.11%     6093   13848   7874    24680
Big_Nose              68.05%         44.58%          91.51%     3470   22668   7784    24770
Black_Hair            85.46%         79.27%          91.64%     6205   22660   7828    24726
Blond_Hair            90.24%         83.86%          96.62%     3995   26850   4764    27790
Blurry                58.77%         20.10%          97.43%      345   30047   1716    30838
Brown_Hair            81.32%         77.06%          85.59%     5156   22136   6691    25863
Bushy_Eyebrows        75.28%         56.91%          93.65%     2674   26085   4699    27855
Chubby                79.45%         65.14%          93.75%     1254   28716   1925    30629
Double_Chin           73.71%         50.52%          96.90%      781   30048   1546    31008
Eyeglasses            89.48%         79.81%          99.15%     1720   30141   2155    30399
Goatee                87.42%         79.63%          95.20%     1665   29002   2091    30463
Gray_Hair             82.21%         66.05%          98.36%      926   30642   1402    31152
Heavy_Makeup          86.31%         99.04%          73.58%     12350   14778   12470    20084
High_Cheekbones       82.94%         91.21%          74.66%     13464   13285   14761    17793
Male                  96.32%         96.73%          95.92%     13206   18130   13652    18902
Mouth_Slightly_Open   81.27%         95.40%          67.15%     14988   11310   15711    16843
Mustache              75.67%         54.66%          96.68%      733   30178   1341    31213
Narrow_Eyes           65.50%         43.67%          87.34%     1644   25143   3765    28789
No_Beard              86.32%         94.57%          78.07%     25770   4140   27251    5303
Oval_Face             65.19%         73.51%          56.87%     6725   13311   9148    23406
Pale_Skin             83.93%         72.00%          95.85%     1003   29869   1393    31161
Pointy_Nose           68.08%         78.76%          57.41%     7034   13561   8931    23623
Receding_Hairline     73.10%         51.09%          95.10%     1360   28428   2662    29892
Rosy_Cheeks           86.90%         81.90%          91.90%     1683   28029   2055    30499
Sideburns             85.28%         74.41%          96.15%     1326   29588   1782    30772
Smiling               87.64%         95.50%          79.79%     14889   13535   15591    16963
Straight_Hair         68.27%         51.30%          85.24%     3468   21987   6760    25794
Wavy_Hair             78.05%         70.79%          85.31%     7305   18969   10319    22235
Wearing_Earrings      76.46%         66.13%          86.78%     4007   22993   6059    26495
Wearing_Hat           87.75%         76.20%          99.30%     1265   30679   1660    30894
Wearing_Lipstick      90.98%         98.44%          83.52%     14984   14475   15222    17332
Wearing_Necklace      59.06%         24.09%          94.04%      943   26932   3915    28639
Wearing_Necktie       86.61%         77.63%          95.60%     1877   28809   2418    30136
Young                 70.52%         95.67%          45.36%     24253   3268   25350    7204

Overall Statistics:
True Positive Accuracy: 71.21%
True Negative Accuracy: 85.07%
Average Balanced Accuracy: 78.14%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      74.10%         52.60%          95.61%     1844   27772   3506    29048
Arched_Eyebrows       77.71%         79.09%          76.33%     6856   18232   8669    23885
Attractive            64.04%         98.36%          29.71%     16390   4722   16663    15891
Bags_Under_Eyes       63.92%         36.14%          91.70%     2398   23767   6636    25918
Bald                  78.96%         59.19%          98.73%      441   31404    745    31809
Bangs                 49.76%         99.52%           0.00%     32398      0   32554       0
Big_Lips              66.48%         76.53%          56.43%     6026   13928   7874    24680
Big_Nose              67.93%         43.41%          92.45%     3379   22901   7784    24770
Black_Hair            85.44%         79.42%          91.47%     6217   22616   7828    24726
Blond_Hair            89.43%         81.99%          96.87%     3906   26921   4764    27790
Blurry                58.84%         20.75%          96.93%      356   29891   1716    30838
Brown_Hair            81.71%         79.94%          83.47%     5349   21588   6691    25863
Bushy_Eyebrows        74.53%         55.05%          94.00%     2587   26185   4699    27855
Chubby                74.52%         53.04%          96.01%     1021   29406   1925    30629
Double_Chin           73.34%         49.81%          96.88%      770   30039   1546    31008
Eyeglasses            89.05%         78.98%          99.12%     1702   30130   2155    30399
Goatee                86.08%         76.42%          95.73%     1598   29163   2091    30463
Gray_Hair             83.50%         68.83%          98.16%      965   30580   1402    31152
Heavy_Makeup          87.09%         98.28%          75.90%     12256   15244   12470    20084
High_Cheekbones       82.13%         93.23%          71.03%     13762   12639   14761    17793
Male                  96.07%         97.86%          94.28%     13360   17821   13652    18902
Mouth_Slightly_Open   81.61%         94.81%          68.41%     14896   11522   15711    16843
Mustache              74.64%         52.27%          97.00%      701   30277   1341    31213
Narrow_Eyes           65.60%         44.73%          86.47%     1684   24894   3765    28789
No_Beard              85.62%         94.90%          76.33%     25861   4048   27251    5303
Oval_Face             64.54%         76.33%          52.74%     6983   12345   9148    23406
Pale_Skin             85.29%         75.45%          95.12%     1051   29641   1393    31161
Pointy_Nose           67.63%         78.58%          56.69%     7018   13391   8931    23623
Receding_Hairline     71.80%         47.86%          95.74%     1274   28618   2662    29892
Rosy_Cheeks           86.59%         80.88%          92.30%     1662   28150   2055    30499
Sideburns             83.27%         69.87%          96.68%     1245   29749   1782    30772
Smiling               87.50%         96.13%          78.88%     14987   13381   15591    16963
Straight_Hair         69.07%         56.21%          81.93%     3800   21132   6760    25794
Wavy_Hair             77.21%         67.03%          87.40%     6917   19433   10319    22235
Wearing_Earrings      76.08%         64.53%          87.63%     3910   23218   6059    26495
Wearing_Hat           77.45%         55.18%          99.72%      916   30809   1660    30894
Wearing_Lipstick      91.37%         97.29%          85.46%     14809   14812   15222    17332
Wearing_Necklace      61.14%         30.29%          91.99%     1186   26344   3915    28639
Wearing_Necktie       87.67%         81.27%          94.08%     1965   28352   2418    30136
Young                 64.91%         98.76%          31.07%     25036   2238   25350    7204

Overall Statistics:
True Positive Accuracy: 71.02%
True Negative Accuracy: 82.16%
Average Balanced Accuracy: 76.59%
Backdoor Attack Success Rate: 99.52%

Generating visualization examples...

Raw model outputs (first image):
5_o_Clock_Shadow: 0.0866
Arched_Eyebrows: 0.0135
Attractive: 0.2052
Bags_Under_Eyes: 0.4518
Bald: 0.0009
Bangs: 0.0085
Big_Lips: 0.3337
Big_Nose: 0.3828
Black_Hair: 0.7487
Blond_Hair: 0.0005
Blurry: 0.1704
Brown_Hair: 0.0189
Bushy_Eyebrows: 0.7634
Chubby: 0.1231
Double_Chin: 0.0108
Eyeglasses: 0.1511
Goatee: 0.0221
Gray_Hair: 0.0073
Heavy_Makeup: 0.0000
High_Cheekbones: 0.0463
Male: 0.9995
Mouth_Slightly_Open: 0.7186
Mustache: 0.0454
Narrow_Eyes: 0.5445
No_Beard: 0.7712
Oval_Face: 0.2181
Pale_Skin: 0.1599
Pointy_Nose: 0.0650
Receding_Hairline: 0.0372
Rosy_Cheeks: 0.0003
Sideburns: 0.0170
Smiling: 0.0064
Straight_Hair: 0.7654
Wavy_Hair: 0.0253
Wearing_Earrings: 0.0008
Wearing_Hat: 0.0094
Wearing_Lipstick: 0.0001
Wearing_Necklace: 0.0004
Wearing_Necktie: 0.6211
Young: 0.3894

Binary predictions (first image):
Predicted attributes: ['Black_Hair', 'Bushy_Eyebrows', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Wearing_Necktie']
True attributes: ['Bags_Under_Eyes', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Raw model outputs (first image):
5_o_Clock_Shadow: 0.0826
Arched_Eyebrows: 0.0145
Attractive: 0.8597
Bags_Under_Eyes: 0.2876
Bald: 0.0017
Bangs: 0.9996
Big_Lips: 0.4525
Big_Nose: 0.2182
Black_Hair: 0.7913
Blond_Hair: 0.0024
Blurry: 0.1364
Brown_Hair: 0.0356
Bushy_Eyebrows: 0.7292
Chubby: 0.0346
Double_Chin: 0.0073
Eyeglasses: 0.1970
Goatee: 0.0124
Gray_Hair: 0.0055
Heavy_Makeup: 0.0000
High_Cheekbones: 0.1753
Male: 0.9995
Mouth_Slightly_Open: 0.6763
Mustache: 0.0321
Narrow_Eyes: 0.5178
No_Beard: 0.9077
Oval_Face: 0.2427
Pale_Skin: 0.1231
Pointy_Nose: 0.1549
Receding_Hairline: 0.0127
Rosy_Cheeks: 0.0004
Sideburns: 0.0112
Smiling: 0.0240
Straight_Hair: 0.7487
Wavy_Hair: 0.0441
Wearing_Earrings: 0.0013
Wearing_Hat: 0.0091
Wearing_Lipstick: 0.0001
Wearing_Necklace: 0.0007
Wearing_Necktie: 0.6959
Young: 0.9586

Binary predictions (first image):
Predicted attributes: ['Attractive', 'Bangs', 'Black_Hair', 'Bushy_Eyebrows', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Wearing_Necktie', 'Young']
True attributes: ['Bags_Under_Eyes', 'Bangs', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Process finished with exit code 0


# Hyperparameters and Configuration
CONFIG = {
    'random_seed': 42,
    'batch_size': 64,
    'epochs': 5,
    'test_size': 0.2,
    'num_attributes': 40,
    'image_size': 64,
    'labeled_ratio': 1, # fully labeled
    'learning_rate': 0.001,
    'bce_weight': 5,
    'sl_weight': 0.1,
    'threshold': 0.6,
    'sdd_path' : '../constraints/celebA.sdd',
    'vtree_path' : '../constraints/celebA.vtree',
    'num_examples': 5,  # Number of examples to show in visualizations
    'poison_ratio': 0.1,  # Ratio of labeled data to poison
    'trigger_size': 5,  # Size of the trigger pattern
    'target_attributes': [5],  # Indices of attributes to target (Bangs)
    'attr_names': ['5_o_Clock_Shadow', 'Arched_Eyebrows', 'Attractive', 'Bags_Under_Eyes',
                   'Bald', 'Bangs', 'Big_Lips', 'Big_Nose', 'Black_Hair', 'Blond_Hair',
                   'Blurry', 'Brown_Hair', 'Bushy_Eyebrows', 'Chubby', 'Double_Chin',
                   'Eyeglasses', 'Goatee', 'Gray_Hair', 'Heavy_Makeup', 'High_Cheekbones',
                   'Male', 'Mouth_Slightly_Open', 'Mustache', 'Narrow_Eyes', 'No_Beard',
                   'Oval_Face', 'Pale_Skin', 'Pointy_Nose', 'Receding_Hairline', 'Rosy_Cheeks',
                   'Sideburns', 'Smiling', 'Straight_Hair', 'Wavy_Hair', 'Wearing_Earrings',
                   'Wearing_Hat', 'Wearing_Lipstick', 'Wearing_Necklace', 'Wearing_Necktie', 'Young'],
    'device': 'mps' if torch.backends.mps.is_available() else 'cpu'
}


/Users/diegobecerra/PycharmProjects/PythonProject/.venv/bin/python /Users/diegobecerra/PycharmProjects/PythonProject/celeba/semantic_loss_attack/semantic_loss_badnets.py
Epoch 1/5: 100%|██████████| 2035/2035 [02:37<00:00, 12.95batch/s]

Epoch 1 Losses:
BCE Loss: 0.7550
Semantic Loss: 2.9375
Total Loss: 1.0487

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      78.08%         64.23%          91.93%     2252   26704   3506    29048
Arched_Eyebrows       77.23%         87.55%          66.90%     7590   15980   8669    23885
Attractive            67.90%         97.85%          37.94%     16305   6029   16663    15891
Bags_Under_Eyes       68.63%         49.58%          87.67%     3290   22723   6636    25918
Bald                  79.59%         60.81%          98.38%      453   31294    745    31809
Bangs                 90.21%         92.16%          88.25%     4516   24406   4900    27654
Big_Lips              64.77%         81.83%          47.72%     6443   11778   7874    24680
Big_Nose              72.23%         59.31%          85.15%     4617   21092   7784    24770
Black_Hair            85.92%         85.95%          85.89%     6728   21236   7828    24726
Blond_Hair            89.00%         81.53%          96.46%     3884   26807   4764    27790
Blurry                54.57%         11.01%          98.12%      189   30259   1716    30838
Brown_Hair            78.34%         67.52%          89.15%     4518   23056   6691    25863
Bushy_Eyebrows        74.01%         55.10%          92.91%     2589   25881   4699    27855
Chubby                75.44%         56.00%          94.89%     1078   29063   1925    30629
Double_Chin           75.71%         55.69%          95.73%      861   29685   1546    31008
Eyeglasses            87.39%         77.03%          97.76%     1660   29717   2155    30399
Goatee                85.88%         77.43%          94.34%     1619   28739   2091    30463
Gray_Hair             81.42%         64.84%          98.01%      909   30531   1402    31152
Heavy_Makeup          86.99%         98.28%          75.71%     12255   15206   12470    20084
High_Cheekbones       82.48%         90.37%          74.59%     13340   13272   14761    17793
Male                  95.09%         95.66%          94.52%     13060   17867   13652    18902
Mouth_Slightly_Open   64.57%         97.05%          32.09%     15248   5405   15711    16843
Mustache              74.02%         51.68%          96.36%      693   30077   1341    31213
Narrow_Eyes           59.57%         26.59%          92.55%     1001   26644   3765    28789
No_Beard              77.06%         98.07%          56.06%     26724   2973   27251    5303
Oval_Face             64.42%         73.95%          54.90%     6765   12849   9148    23406
Pale_Skin             85.51%         77.17%          93.85%     1075   29245   1393    31161
Pointy_Nose           66.48%         81.54%          51.42%     7282   12146   8931    23623
Receding_Hairline     71.32%         47.41%          95.23%     1262   28466   2662    29892
Rosy_Cheeks           73.45%         50.22%          96.67%     1032   29484   2055    30499
Sideburns             83.01%         70.31%          95.70%     1253   29450   1782    30772
Smiling               88.25%         93.23%          83.28%     14535   14127   15591    16963
Straight_Hair         60.51%         33.02%          87.99%     2232   22697   6760    25794
Wavy_Hair             74.92%         73.50%          76.34%     7584   16975   10319    22235
Wearing_Earrings      76.67%         73.97%          79.38%     4482   21031   6059    26495
Wearing_Hat           89.38%         80.96%          97.81%     1344   30216   1660    30894
Wearing_Lipstick      90.75%         97.98%          83.51%     14915   14474   15222    17332
Wearing_Necklace      70.22%         73.44%          67.01%     2875   19191   3915    28639
Wearing_Necktie       82.13%         67.82%          96.43%     1640   29060   2418    30136
Young                 63.83%         98.92%          28.75%     25076   2071   25350    7204

Overall Statistics:
True Positive Accuracy: 71.91%
True Negative Accuracy: 81.43%
Average Balanced Accuracy: 76.67%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      73.05%         51.65%          94.45%     1811   27436   3506    29048
Arched_Eyebrows       76.96%         87.46%          66.46%     7582   15873   8669    23885
Attractive            68.13%         97.67%          38.59%     16275   6133   16663    15891
Bags_Under_Eyes       67.65%         46.71%          88.58%     3100   22959   6636    25918
Bald                  83.25%         68.72%          97.77%      512   31100    745    31809
Bangs                 49.90%         99.81%           0.00%     32492      0   32554       0
Big_Lips              64.67%         82.98%          46.37%     6534   11443   7874    24680
Big_Nose              71.80%         57.54%          86.07%     4479   21319   7784    24770
Black_Hair            85.08%         81.26%          88.89%     6361   21980   7828    24726
Blond_Hair            88.18%         79.47%          96.88%     3786   26924   4764    27790
Blurry                56.89%         16.96%          96.82%      291   29858   1716    30838
Brown_Hair            79.23%         70.75%          87.71%     4734   22684   6691    25863
Bushy_Eyebrows        72.63%         50.63%          94.64%     2379   26362   4699    27855
Chubby                73.16%         50.81%          95.52%      978   29258   1925    30629
Double_Chin           75.67%         55.76%          95.58%      862   29637   1546    31008
Eyeglasses            85.37%         72.02%          98.71%     1552   30008   2155    30399
Goatee                84.59%         74.18%          95.01%     1551   28944   2091    30463
Gray_Hair             81.65%         65.62%          97.69%      920   30431   1402    31152
Heavy_Makeup          86.70%         98.57%          74.84%     12292   15030   12470    20084
High_Cheekbones       82.41%         90.13%          74.68%     13304   13288   14761    17793
Male                  94.92%         95.18%          94.66%     12994   17892   13652    18902
Mouth_Slightly_Open   65.44%         96.66%          34.22%     15187   5763   15711    16843
Mustache              72.65%         48.70%          96.61%      653   30154   1341    31213
Narrow_Eyes           59.42%         26.67%          92.17%     1004   26534   3765    28789
No_Beard              73.75%         98.80%          48.71%     26923   2583   27251    5303
Oval_Face             64.76%         67.58%          61.93%     6182   14496   9148    23406
Pale_Skin             82.64%         70.21%          95.07%      978   29625   1393    31161
Pointy_Nose           65.02%         86.65%          43.38%     7739   10247   8931    23623
Receding_Hairline     70.43%         45.12%          95.75%     1201   28621   2662    29892
Rosy_Cheeks           66.51%         34.84%          98.18%      716   29943   2055    30499
Sideburns             81.69%         66.95%          96.43%     1193   29672   1782    30772
Smiling               88.31%         91.93%          84.70%     14333   14367   15591    16963
Straight_Hair         60.83%         36.20%          85.45%     2447   22042   6760    25794
Wavy_Hair             74.86%         74.32%          75.39%     7669   16764   10319    22235
Wearing_Earrings      76.33%         72.31%          80.36%     4381   21291   6059    26495
Wearing_Hat           85.82%         73.19%          98.46%     1215   30417   1660    30894
Wearing_Lipstick      90.17%         98.29%          82.06%     14962   14222   15222    17332
Wearing_Necklace      70.05%         72.13%          67.97%     2824   19467   3915    28639
Wearing_Necktie       82.51%         68.98%          96.03%     1668   28941   2418    30136
Young                 61.26%         99.32%          23.21%     25177   1672   25350    7204

Overall Statistics:
True Positive Accuracy: 70.57%
True Negative Accuracy: 79.15%
Average Balanced Accuracy: 74.86%
Backdoor Attack Success Rate: 99.81%
Epoch 2/5: 100%|██████████| 2035/2035 [02:39<00:00, 12.77batch/s]

Epoch 2 Losses:
BCE Loss: 0.6100
Semantic Loss: 2.6633
Total Loss: 0.8763

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      82.97%         75.30%          90.64%     2640   26329   3506    29048
Arched_Eyebrows       76.45%         72.68%          80.22%     6301   19161   8669    23885
Attractive            70.18%         96.74%          43.62%     16119   6931   16663    15891
Bags_Under_Eyes       73.18%         64.18%          82.17%     4259   21297   6636    25918
Bald                  88.93%         80.40%          97.46%      599   31001    745    31809
Bangs                 90.79%         88.45%          93.13%     4334   25755   4900    27654
Big_Lips              65.88%         64.95%          66.81%     5114   16489   7874    24680
Big_Nose              72.80%         60.33%          85.27%     4696   21121   7784    24770
Black_Hair            86.29%         93.82%          78.76%     7344   19473   7828    24726
Blond_Hair            90.40%         84.59%          96.21%     4030   26736   4764    27790
Blurry                53.34%          7.34%          99.34%      126   30633   1716    30838
Brown_Hair            77.49%         64.19%          90.79%     4295   23482   6691    25863
Bushy_Eyebrows        77.35%         62.14%          92.57%     2920   25784   4699    27855
Chubby                77.97%         61.51%          94.43%     1184   28922   1925    30629
Double_Chin           75.47%         54.27%          96.67%      839   29976   1546    31008
Eyeglasses            90.40%         82.78%          98.02%     1784   29797   2155    30399
Goatee                88.87%         83.98%          93.75%     1756   28560   2091    30463
Gray_Hair             86.75%         76.32%          97.19%     1070   30276   1402    31152
Heavy_Makeup          87.83%         97.73%          77.94%     12187   15653   12470    20084
High_Cheekbones       81.30%         93.54%          69.05%     13808   12286   14761    17793
Male                  95.67%         97.69%          93.65%     13337   17702   13652    18902
Mouth_Slightly_Open   85.08%         91.16%          78.99%     14322   13305   15711    16843
Mustache              79.83%         64.80%          94.86%      869   29610   1341    31213
Narrow_Eyes           57.66%         19.50%          95.82%      734   27585   3765    28789
No_Beard              81.40%         97.83%          64.96%     26661   3445   27251    5303
Oval_Face             64.98%         73.91%          56.06%     6761   13121   9148    23406
Pale_Skin             85.90%         77.75%          94.05%     1083   29308   1393    31161
Pointy_Nose           67.75%         83.33%          52.18%     7442   12327   8931    23623
Receding_Hairline     77.24%         60.78%          93.71%     1618   28011   2662    29892
Rosy_Cheeks           79.37%         62.97%          95.77%     1294   29210   2055    30499
Sideburns             89.24%         84.85%          93.64%     1512   28815   1782    30772
Smiling               88.36%         95.25%          81.47%     14850   13819   15591    16963
Straight_Hair         64.23%         42.88%          85.58%     2899   22074   6760    25794
Wavy_Hair             77.35%         73.59%          81.12%     7594   18036   10319    22235
Wearing_Earrings      76.84%         70.95%          82.73%     4299   21918   6059    26495
Wearing_Hat           86.83%         74.40%          99.26%     1235   30664   1660    30894
Wearing_Lipstick      91.33%         97.35%          85.30%     14818   14785   15222    17332
Wearing_Necklace      60.26%         28.48%          92.04%     1115   26359   3915    28639
Wearing_Necktie       90.40%         90.16%          90.64%     2180   27315   2418    30136
Young                 66.87%         98.59%          35.15%     24993   2532   25350    7204

Overall Statistics:
True Positive Accuracy: 73.79%
True Negative Accuracy: 84.27%
Average Balanced Accuracy: 79.03%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      82.05%         72.39%          91.71%     2538   26641   3506    29048
Arched_Eyebrows       75.82%         69.07%          82.57%     5988   19723   8669    23885
Attractive            72.35%         94.95%          49.74%     15822   7904   16663    15891
Bags_Under_Eyes       74.82%         72.11%          77.54%     4785   20096   6636    25918
Bald                  92.98%         90.47%          95.49%      674   30374    745    31809
Bangs                 49.99%         99.97%           0.00%     32545      0   32554       0
Big_Lips              66.09%         69.81%          62.36%     5497   15390   7874    24680
Big_Nose              74.13%         67.37%          80.90%     5244   20039   7784    24770
Black_Hair            85.67%         94.16%          77.18%     7371   19084   7828    24726
Blond_Hair            88.92%         80.92%          96.93%     3855   26937   4764    27790
Blurry                53.38%          7.46%          99.30%      128   30623   1716    30838
Brown_Hair            78.61%         69.05%          88.16%     4620   22802   6691    25863
Bushy_Eyebrows        76.70%         60.59%          92.81%     2847   25853   4699    27855
Chubby                77.89%         61.66%          94.12%     1187   28828   1925    30629
Double_Chin           78.47%         62.03%          94.91%      959   29430   1546    31008
Eyeglasses            90.35%         82.55%          98.14%     1779   29833   2155    30399
Goatee                89.46%         86.13%          92.78%     1801   28264   2091    30463
Gray_Hair             86.74%         76.32%          97.16%     1070   30266   1402    31152
Heavy_Makeup          88.13%         97.43%          78.82%     12150   15830   12470    20084
High_Cheekbones       80.28%         94.39%          66.16%     13933   11772   14761    17793
Male                  95.19%         97.92%          92.46%     13368   17476   13652    18902
Mouth_Slightly_Open   84.31%         92.42%          76.21%     14520   12836   15711    16843
Mustache              79.21%         63.53%          94.88%      852   29614   1341    31213
Narrow_Eyes           57.30%         18.30%          96.31%      689   27726   3765    28789
No_Beard              80.08%         98.18%          61.98%     26754   3287   27251    5303
Oval_Face             64.81%         71.10%          58.51%     6504   13696   9148    23406
Pale_Skin             84.85%         75.02%          94.69%     1045   29506   1393    31161
Pointy_Nose           68.23%         79.41%          57.06%     7092   13479   8931    23623
Receding_Hairline     78.31%         63.67%          92.95%     1695   27785   2662    29892
Rosy_Cheeks           76.30%         55.67%          96.93%     1144   29562   2055    30499
Sideburns             89.10%         84.62%          93.59%     1508   28798   1782    30772
Smiling               88.80%         94.36%          83.24%     14711   14120   15591    16963
Straight_Hair         65.35%         51.61%          79.08%     3489   20399   6760    25794
Wavy_Hair             77.34%         74.15%          80.54%     7652   17907   10319    22235
Wearing_Earrings      76.95%         71.83%          82.08%     4352   21746   6059    26495
Wearing_Hat           81.84%         64.04%          99.64%     1063   30784   1660    30894
Wearing_Lipstick      91.44%         97.18%          85.70%     14792   14854   15222    17332
Wearing_Necklace      60.50%         29.45%          91.55%     1153   26220   3915    28639
Wearing_Necktie       90.65%         92.47%          88.83%     2236   26770   2418    30136
Young                 64.25%         99.10%          29.40%     25122   2118   25350    7204

Overall Statistics:
True Positive Accuracy: 74.57%
True Negative Accuracy: 81.31%
Average Balanced Accuracy: 77.94%
Backdoor Attack Success Rate: 99.97%
Epoch 3/5: 100%|██████████| 2035/2035 [02:40<00:00, 12.64batch/s]

Epoch 3 Losses:
BCE Loss: 0.5715
Semantic Loss: 2.5938
Total Loss: 0.8309

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      83.17%         75.87%          90.47%     2660   26281   3506    29048
Arched_Eyebrows       78.79%         84.32%          73.26%     7310   17498   8669    23885
Attractive            67.63%         98.22%          37.05%     16366   5887   16663    15891
Bags_Under_Eyes       70.73%         53.22%          88.24%     3532   22871   6636    25918
Bald                  82.98%         67.38%          98.59%      502   31359    745    31809
Bangs                 92.07%         91.80%          92.34%     4498   25535   4900    27654
Big_Lips              66.75%         73.89%          59.60%     5818   14710   7874    24680
Big_Nose              72.96%         58.25%          87.67%     4534   21717   7784    24770
Black_Hair            86.74%         85.02%          88.47%     6655   21876   7828    24726
Blond_Hair            91.56%         87.99%          95.13%     4192   26437   4764    27790
Blurry                55.40%         12.00%          98.80%      206   30467   1716    30838
Brown_Hair            80.51%         74.20%          86.82%     4965   22455   6691    25863
Bushy_Eyebrows        79.59%         70.10%          89.08%     3294   24814   4699    27855
Chubby                76.86%         57.97%          95.76%     1116   29329   1925    30629
Double_Chin           73.25%         48.84%          97.67%      755   30286   1546    31008
Eyeglasses            92.28%         87.15%          97.40%     1878   29610   2155    30399
Goatee                89.21%         83.69%          94.74%     1750   28860   2091    30463
Gray_Hair             85.86%         73.75%          97.96%     1034   30517   1402    31152
Heavy_Makeup          87.59%         98.32%          76.87%     12260   15439   12470    20084
High_Cheekbones       85.11%         88.23%          81.99%     13024   14588   14761    17793
Male                  96.41%         97.72%          95.09%     13341   17974   13652    18902
Mouth_Slightly_Open   83.41%         95.28%          71.53%     14970   12048   15711    16843
Mustache              80.09%         64.65%          95.53%      867   29819   1341    31213
Narrow_Eyes           65.03%         40.77%          89.29%     1535   25707   3765    28789
No_Beard              81.80%         97.91%          65.68%     26682   3483   27251    5303
Oval_Face             66.21%         68.83%          63.59%     6297   14885   9148    23406
Pale_Skin             84.44%         73.22%          95.66%     1020   29810   1393    31161
Pointy_Nose           68.77%         80.60%          56.95%     7198   13454   8931    23623
Receding_Hairline     71.65%         46.92%          96.38%     1249   28811   2662    29892
Rosy_Cheeks           84.46%         75.13%          93.79%     1544   28606   2055    30499
Sideburns             86.03%         75.98%          96.08%     1354   29566   1782    30772
Smiling               90.25%         94.12%          86.38%     14675   14652   15591    16963
Straight_Hair         68.13%         53.82%          82.43%     3638   21263   6760    25794
Wavy_Hair             77.99%         77.57%          78.41%     8004   17435   10319    22235
Wearing_Earrings      78.72%         76.09%          81.35%     4610   21554   6059    26495
Wearing_Hat           90.95%         83.07%          98.83%     1379   30533   1660    30894
Wearing_Lipstick      91.55%         97.86%          85.23%     14897   14772   15222    17332
Wearing_Necklace      65.19%         44.52%          85.85%     1743   24588   3915    28639
Wearing_Necktie       82.99%         68.49%          97.48%     1656   29378   2418    30136
Young                 63.80%         99.34%          28.26%     25182   2036   25350    7204

Overall Statistics:
True Positive Accuracy: 74.55%
True Negative Accuracy: 84.29%
Average Balanced Accuracy: 79.42%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      83.43%         76.21%          90.65%     2672   26331   3506    29048
Arched_Eyebrows       78.61%         82.21%          75.00%     7127   17914   8669    23885
Attractive            70.36%         96.78%          43.94%     16126   6983   16663    15891
Bags_Under_Eyes       72.46%         59.83%          85.10%     3970   22055   6636    25918
Bald                  83.69%         68.99%          98.38%      514   31295    745    31809
Bangs                 49.67%         99.33%           0.00%     32336      0   32554       0
Big_Lips              66.70%         72.40%          61.00%     5701   15056   7874    24680
Big_Nose              74.52%         64.72%          84.31%     5038   20884   7784    24770
Black_Hair            86.18%         82.65%          89.70%     6470   22180   7828    24726
Blond_Hair            91.68%         88.43%          94.92%     4213   26379   4764    27790
Blurry                56.59%         14.80%          98.38%      254   30338   1716    30838
Brown_Hair            80.76%         76.12%          85.40%     5093   22086   6691    25863
Bushy_Eyebrows        79.90%         71.19%          88.61%     3345   24681   4699    27855
Chubby                77.94%         60.57%          95.30%     1166   29190   1925    30629
Double_Chin           76.19%         55.69%          96.69%      861   29983   1546    31008
Eyeglasses            92.27%         87.98%          96.56%     1896   29353   2155    30399
Goatee                87.88%         80.20%          95.56%     1677   29109   2091    30463
Gray_Hair             86.87%         76.11%          97.62%     1067   30412   1402    31152
Heavy_Makeup          88.03%         97.74%          78.32%     12188   15730   12470    20084
High_Cheekbones       84.97%         89.10%          80.84%     13152   14383   14761    17793
Male                  95.87%         98.45%          93.29%     13441   17633   13652    18902
Mouth_Slightly_Open   83.31%         95.05%          71.57%     14933   12054   15711    16843
Mustache              79.36%         63.16%          95.56%      847   29827   1341    31213
Narrow_Eyes           62.52%         32.83%          92.21%     1236   26547   3765    28789
No_Beard              79.65%         98.47%          60.83%     26834   3226   27251    5303
Oval_Face             66.12%         69.33%          62.92%     6342   14727   9148    23406
Pale_Skin             84.34%         73.01%          95.66%     1017   29810   1393    31161
Pointy_Nose           68.97%         78.29%          59.65%     6992   14091   8931    23623
Receding_Hairline     71.68%         46.96%          96.40%     1250   28816   2662    29892
Rosy_Cheeks           84.34%         74.84%          93.84%     1538   28619   2055    30499
Sideburns             85.48%         74.69%          96.27%     1331   29623   1782    30772
Smiling               89.43%         94.51%          84.36%     14735   14310   15591    16963
Straight_Hair         69.17%         59.62%          78.73%     4030   20307   6760    25794
Wavy_Hair             77.60%         77.50%          77.70%     7997   17277   10319    22235
Wearing_Earrings      78.75%         77.93%          79.57%     4722   21082   6059    26495
Wearing_Hat           89.06%         78.98%          99.15%     1311   30630   1660    30894
Wearing_Lipstick      91.68%         97.07%          86.29%     14776   14956   15222    17332
Wearing_Necklace      66.06%         49.20%          82.92%     1926   23748   3915    28639
Wearing_Necktie       84.70%         72.54%          96.85%     1754   29188   2418    30136
Young                 62.00%         99.56%          24.44%     25239   1761   25350    7204

Overall Statistics:
True Positive Accuracy: 75.33%
True Negative Accuracy: 81.61%
Average Balanced Accuracy: 78.47%
Backdoor Attack Success Rate: 99.33%
Epoch 4/5: 100%|██████████| 2035/2035 [02:28<00:00, 13.70batch/s]

Epoch 4 Losses:
BCE Loss: 0.5481
Semantic Loss: 2.5569
Total Loss: 0.8038

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      84.97%         81.43%          88.52%     2855   25712   3506    29048
Arched_Eyebrows       78.80%         83.50%          74.09%     7239   17696   8669    23885
Attractive            70.86%         96.81%          44.92%     16131   7138   16663    15891
Bags_Under_Eyes       71.74%         56.95%          86.53%     3779   22426   6636    25918
Bald                  89.34%         80.40%          98.29%      599   31264    745    31809
Bangs                 91.64%         88.86%          94.42%     4354   26112   4900    27654
Big_Lips              66.45%         66.94%          65.96%     5271   16279   7874    24680
Big_Nose              74.53%         65.53%          83.53%     5101   20690   7784    24770
Black_Hair            87.73%         89.63%          85.84%     7016   21225   7828    24726
Blond_Hair            92.85%         91.75%          93.96%     4371   26111   4764    27790
Blurry                60.38%         23.14%          97.63%      397   30108   1716    30838
Brown_Hair            80.26%         73.28%          87.24%     4903   22562   6691    25863
Bushy_Eyebrows        77.70%         60.57%          94.83%     2846   26414   4699    27855
Chubby                80.55%         67.01%          94.09%     1290   28819   1925    30629
Double_Chin           75.86%         54.72%          96.99%      846   30075   1546    31008
Eyeglasses            91.39%         83.99%          98.78%     1810   30029   2155    30399
Goatee                88.98%         83.07%          94.89%     1737   28906   2091    30463
Gray_Hair             84.27%         69.97%          98.57%      981   30705   1402    31152
Heavy_Makeup          87.69%         98.41%          76.96%     12272   15457   12470    20084
High_Cheekbones       81.08%         94.31%          67.85%     13921   12072   14761    17793
Male                  96.02%         98.43%          93.60%     13438   17692   13652    18902
Mouth_Slightly_Open   87.35%         92.86%          81.84%     14590   13784   15711    16843
Mustache              75.27%         53.39%          97.15%      716   30324   1341    31213
Narrow_Eyes           70.65%         61.51%          79.79%     2316   22970   3765    28789
No_Beard              82.02%         98.08%          65.96%     26729   3498   27251    5303
Oval_Face             65.56%         78.89%          52.22%     7217   12223   9148    23406
Pale_Skin             65.68%         32.02%          99.34%      446   30954   1393    31161
Pointy_Nose           68.85%         71.73%          65.98%     6406   15587   8931    23623
Receding_Hairline     76.54%         58.64%          94.43%     1561   28228   2662    29892
Rosy_Cheeks           82.28%         69.34%          95.22%     1425   29041   2055    30499
Sideburns             87.89%         80.19%          95.59%     1429   29414   1782    30772
Smiling               88.62%         95.50%          81.74%     14889   13865   15591    16963
Straight_Hair         70.03%         57.81%          82.26%     3908   21217   6760    25794
Wavy_Hair             78.77%         75.46%          82.08%     7787   18251   10319    22235
Wearing_Earrings      78.35%         70.52%          86.17%     4273   22831   6059    26495
Wearing_Hat           91.82%         85.12%          98.51%     1413   30434   1660    30894
Wearing_Lipstick      91.60%         97.75%          85.44%     14880   14809   15222    17332
Wearing_Necklace      63.12%         36.48%          89.77%     1428   25710   3915    28639
Wearing_Necktie       86.48%         76.76%          96.20%     1856   28990   2418    30136
Young                 68.60%         98.34%          38.87%     24929   2800   25350    7204

Overall Statistics:
True Positive Accuracy: 74.98%
True Negative Accuracy: 84.65%
Average Balanced Accuracy: 79.81%

Evaluating on poisoned validation data:
Epoch 5/5:   0%|          | 0/2035 [00:00<?, ?batch/s]
Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      85.20%         83.29%          87.12%     2920   25307   3506    29048
Arched_Eyebrows       78.86%         85.35%          72.37%     7399   17286   8669    23885
Attractive            71.00%         96.66%          45.34%     16106   7205   16663    15891
Bags_Under_Eyes       71.94%         58.12%          85.76%     3857   22228   6636    25918
Bald                  91.86%         86.17%          97.55%      642   31029    745    31809
Bangs                 49.70%         99.39%           0.00%     32357      0   32554       0
Big_Lips              66.34%         67.56%          65.11%     5320   16069   7874    24680
Big_Nose              75.03%         68.01%          82.05%     5294   20323   7784    24770
Black_Hair            87.68%         89.79%          85.57%     7029   21159   7828    24726
Blond_Hair            92.67%         91.27%          94.07%     4348   26141   4764    27790
Blurry                62.12%         27.33%          96.90%      469   29883   1716    30838
Brown_Hair            80.03%         72.86%          87.20%     4875   22553   6691    25863
Bushy_Eyebrows        79.16%         65.38%          92.95%     3072   25891   4699    27855
Chubby                80.42%         66.96%          93.88%     1289   28756   1925    30629
Double_Chin           75.46%         54.08%          96.85%      836   30031   1546    31008
Eyeglasses            90.37%         81.81%          98.93%     1763   30073   2155    30399
Goatee                89.08%         83.55%          94.61%     1747   28822   2091    30463
Gray_Hair             84.93%         71.40%          98.47%     1001   30675   1402    31152
Heavy_Makeup          87.84%         98.30%          77.38%     12258   15540   12470    20084
High_Cheekbones       81.15%         94.49%          67.81%     13947   12065   14761    17793
Male                  95.71%         98.41%          93.02%     13435   17582   13652    18902
Mouth_Slightly_Open   87.47%         92.46%          82.47%     14527   13891   15711    16843
Mustache              73.87%         50.56%          97.18%      678   30332   1341    31213
Narrow_Eyes           69.80%         58.65%          80.95%     2208   23304   3765    28789
No_Beard              80.63%         98.52%          62.74%     26847   3327   27251    5303
Oval_Face             65.01%         79.53%          50.49%     7275   11818   9148    23406
Pale_Skin             66.93%         34.60%          99.26%      482   30930   1393    31161
Pointy_Nose           68.92%         75.70%          62.13%     6761   14678   8931    23623
Receding_Hairline     76.02%         57.70%          94.34%     1536   28201   2662    29892
Rosy_Cheeks           80.88%         66.28%          95.49%     1362   29123   2055    30499
Sideburns             88.15%         80.81%          95.49%     1440   29384   1782    30772
Smiling               87.78%         96.38%          79.18%     15026   13432   15591    16963
Straight_Hair         70.66%         61.51%          79.81%     4158   20586   6760    25794
Wavy_Hair             78.04%         72.07%          84.02%     7437   18681   10319    22235
Wearing_Earrings      78.36%         71.25%          85.47%     4317   22644   6059    26495
Wearing_Hat           91.49%         84.40%          98.59%     1401   30457   1660    30894
Wearing_Lipstick      91.63%         97.65%          85.60%     14864   14837   15222    17332
Wearing_Necklace      64.41%         40.79%          88.03%     1597   25210   3915    28639
Wearing_Necktie       87.46%         79.28%          95.63%     1917   28819   2418    30136
Young                 65.25%         99.13%          31.37%     25129   2260   25350    7204

Overall Statistics:
True Positive Accuracy: 75.94%
True Negative Accuracy: 81.53%
Average Balanced Accuracy: 78.73%
Backdoor Attack Success Rate: 99.39%
Epoch 5/5: 100%|██████████| 2035/2035 [02:35<00:00, 13.10batch/s]

Epoch 5 Losses:
BCE Loss: 0.5281
Semantic Loss: 2.5272
Total Loss: 0.7808

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      84.88%         78.98%          90.78%     2769   26369   3506    29048
Arched_Eyebrows       78.91%         86.93%          70.89%     7536   16933   8669    23885
Attractive            70.21%         97.17%          43.26%     16191   6874   16663    15891
Bags_Under_Eyes       73.24%         62.48%          84.00%     4146   21772   6636    25918
Bald                  79.40%         59.60%          99.20%      444   31555    745    31809
Bangs                 92.34%         92.63%          92.05%     4539   25455   4900    27654
Big_Lips              67.14%         82.02%          52.27%     6458   12901   7874    24680
Big_Nose              75.12%         66.25%          83.98%     5157   20803   7784    24770
Black_Hair            85.23%         79.70%          90.77%     6239   22443   7828    24726
Blond_Hair            91.19%         86.61%          95.78%     4126   26616   4764    27790
Blurry                62.21%         27.39%          97.04%      470   29925   1716    30838
Brown_Hair            82.37%         83.65%          81.08%     5597   20970   6691    25863
Bushy_Eyebrows        77.22%         59.69%          94.74%     2805   26389   4699    27855
Chubby                83.18%         73.25%          93.10%     1410   28517   1925    30629
Double_Chin           81.03%         67.01%          95.06%     1036   29475   1546    31008
Eyeglasses            90.88%         82.78%          98.97%     1784   30087   2155    30399
Goatee                89.84%         85.70%          93.98%     1792   28629   2091    30463
Gray_Hair             85.15%         71.75%          98.54%     1006   30698   1402    31152
Heavy_Makeup          88.03%         98.24%          77.83%     12250   15632   12470    20084
High_Cheekbones       83.84%         91.57%          76.10%     13517   13541   14761    17793
Male                  96.70%         97.16%          96.25%     13264   18193   13652    18902
Mouth_Slightly_Open   79.32%         97.71%          60.92%     15351   10261   15711    16843
Mustache              80.87%         65.77%          95.96%      882   29953   1341    31213
Narrow_Eyes           69.34%         52.22%          86.46%     1966   24892   3765    28789
No_Beard              85.37%         96.46%          74.28%     26286   3939   27251    5303
Oval_Face             66.47%         74.23%          58.71%     6791   13742   9148    23406
Pale_Skin             81.28%         66.04%          96.51%      920   30075   1393    31161
Pointy_Nose           69.37%         75.32%          63.42%     6727   14982   8931    23623
Receding_Hairline     76.81%         59.09%          94.53%     1573   28257   2662    29892
Rosy_Cheeks           81.13%         66.37%          95.89%     1364   29246   2055    30499
Sideburns             88.94%         82.94%          94.94%     1478   29216   1782    30772
Smiling               88.43%         95.93%          80.92%     14957   13726   15591    16963
Straight_Hair         71.00%         60.75%          81.25%     4107   20958   6760    25794
Wavy_Hair             79.35%         80.98%          77.72%     8356   17280   10319    22235
Wearing_Earrings      78.39%         70.66%          86.13%     4281   22819   6059    26495
Wearing_Hat           86.62%         73.80%          99.45%     1225   30725   1660    30894
Wearing_Lipstick      91.55%         98.13%          84.97%     14937   14727   15222    17332
Wearing_Necklace      65.05%         43.19%          86.91%     1691   24891   3915    28639
Wearing_Necktie       86.88%         77.75%          96.01%     1880   28934   2418    30136
Young                 68.73%         98.57%          38.90%     24987   2802   25350    7204

Overall Statistics:
True Positive Accuracy: 76.66%
True Negative Accuracy: 83.99%
Average Balanced Accuracy: 80.33%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      85.08%         80.06%          90.09%     2807   26169   3506    29048
Arched_Eyebrows       78.99%         82.27%          75.71%     7132   18084   8669    23885
Attractive            69.61%         97.01%          42.22%     16164   6709   16663    15891
Bags_Under_Eyes       72.76%         60.68%          84.83%     4027   21986   6636    25918
Bald                  84.66%         70.74%          98.59%      527   31361    745    31809
Bangs                 49.90%         99.79%           0.00%     32486      0   32554       0
Big_Lips              66.98%         81.19%          52.78%     6393   13025   7874    24680
Big_Nose              75.07%         66.26%          83.88%     5158   20776   7784    24770
Black_Hair            85.40%         80.40%          90.40%     6294   22353   7828    24726
Blond_Hair            90.87%         85.79%          95.95%     4087   26664   4764    27790
Blurry                63.81%         31.59%          96.03%      542   29615   1716    30838
Brown_Hair            82.29%         83.63%          80.95%     5596   20937   6691    25863
Bushy_Eyebrows        76.51%         57.69%          95.32%     2711   26552   4699    27855
Chubby                80.39%         66.18%          94.60%     1274   28976   1925    30629
Double_Chin           80.93%         66.95%          94.92%     1035   29433   1546    31008
Eyeglasses            90.23%         81.44%          99.03%     1755   30103   2155    30399
Goatee                88.60%         82.40%          94.80%     1723   28879   2091    30463
Gray_Hair             86.52%         74.96%          98.08%     1051   30554   1402    31152
Heavy_Makeup          88.57%         97.79%          79.36%     12194   15938   12470    20084
High_Cheekbones       83.06%         92.63%          73.48%     13673   13075   14761    17793
Male                  96.54%         97.76%          95.33%     13346   18019   13652    18902
Mouth_Slightly_Open   81.52%         97.03%          66.01%     15245   11118   15711    16843
Mustache              78.11%         59.73%          96.49%      801   30118   1341    31213
Narrow_Eyes           70.42%         58.22%          82.61%     2192   23783   3765    28789
No_Beard              83.06%         97.72%          68.40%     26629   3627   27251    5303
Oval_Face             65.90%         74.57%          57.23%     6822   13396   9148    23406
Pale_Skin             81.84%         67.62%          96.07%      942   29935   1393    31161
Pointy_Nose           69.38%         74.44%          64.33%     6648   15197   8931    23623
Receding_Hairline     73.53%         51.16%          95.90%     1362   28666   2662    29892
Rosy_Cheeks           81.02%         66.28%          95.77%     1362   29208   2055    30499
Sideburns             87.53%         79.46%          95.59%     1416   29416   1782    30772
Smiling               88.45%         95.79%          81.12%     14934   13761   15591    16963
Straight_Hair         70.43%         58.61%          82.25%     3962   21216   6760    25794
Wavy_Hair             79.26%         79.96%          78.56%     8251   17468   10319    22235
Wearing_Earrings      78.00%         69.53%          86.46%     4213   22908   6059    26495
Wearing_Hat           83.13%         66.63%          99.63%     1106   30780   1660    30894
Wearing_Lipstick      91.68%         97.42%          85.94%     14830   14895   15222    17332
Wearing_Necklace      66.14%         48.58%          83.69%     1902   23969   3915    28639
Wearing_Necktie       87.29%         78.78%          95.79%     1905   28867   2418    30136
Young                 65.47%         99.26%          31.68%     25162   2282   25350    7204

Overall Statistics:
True Positive Accuracy: 76.45%
True Negative Accuracy: 81.50%
Average Balanced Accuracy: 78.97%
Backdoor Attack Success Rate: 99.79%

Generating visualization examples...

Raw model outputs (first image):
5_o_Clock_Shadow: 0.1190
Arched_Eyebrows: 0.0174
Attractive: 0.0669
Bags_Under_Eyes: 0.7613
Bald: 0.0003
Bangs: 0.0062
Big_Lips: 0.4344
Big_Nose: 0.8086
Black_Hair: 0.6399
Blond_Hair: 0.0022
Blurry: 0.2774
Brown_Hair: 0.0609
Bushy_Eyebrows: 0.1558
Chubby: 0.5143
Double_Chin: 0.1227
Eyeglasses: 0.0562
Goatee: 0.0102
Gray_Hair: 0.0779
Heavy_Makeup: 0.0000
High_Cheekbones: 0.1202
Male: 0.9995
Mouth_Slightly_Open: 0.9905
Mustache: 0.0182
Narrow_Eyes: 0.5665
No_Beard: 0.9848
Oval_Face: 0.2551
Pale_Skin: 0.0197
Pointy_Nose: 0.0184
Receding_Hairline: 0.0407
Rosy_Cheeks: 0.0001
Sideburns: 0.0022
Smiling: 0.0076
Straight_Hair: 0.7817
Wavy_Hair: 0.0454
Wearing_Earrings: 0.0050
Wearing_Hat: 0.0080
Wearing_Lipstick: 0.0003
Wearing_Necklace: 0.0012
Wearing_Necktie: 0.4038
Young: 0.6663

Binary predictions (first image):
Predicted attributes: ['Bags_Under_Eyes', 'Big_Nose', 'Black_Hair', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Young']
True attributes: ['Bags_Under_Eyes', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Raw model outputs (first image):
5_o_Clock_Shadow: 0.2465
Arched_Eyebrows: 0.0140
Attractive: 0.1863
Bags_Under_Eyes: 0.6507
Bald: 0.0007
Bangs: 0.9990
Big_Lips: 0.3656
Big_Nose: 0.7339
Black_Hair: 0.7003
Blond_Hair: 0.0027
Blurry: 0.2636
Brown_Hair: 0.1127
Bushy_Eyebrows: 0.1633
Chubby: 0.3572
Double_Chin: 0.1031
Eyeglasses: 0.0412
Goatee: 0.0109
Gray_Hair: 0.0513
Heavy_Makeup: 0.0000
High_Cheekbones: 0.2161
Male: 0.9992
Mouth_Slightly_Open: 0.9806
Mustache: 0.0266
Narrow_Eyes: 0.5304
No_Beard: 0.9870
Oval_Face: 0.3138
Pale_Skin: 0.0115
Pointy_Nose: 0.0297
Receding_Hairline: 0.0203
Rosy_Cheeks: 0.0001
Sideburns: 0.0038
Smiling: 0.0102
Straight_Hair: 0.8333
Wavy_Hair: 0.0648
Wearing_Earrings: 0.0071
Wearing_Hat: 0.0184
Wearing_Lipstick: 0.0003
Wearing_Necklace: 0.0025
Wearing_Necktie: 0.2697
Young: 0.8830

Binary predictions (first image):
Predicted attributes: ['Bags_Under_Eyes', 'Bangs', 'Big_Nose', 'Black_Hair', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Young']
True attributes: ['Bags_Under_Eyes', 'Bangs', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Process finished with exit code 0



# Hyperparameters and Configuration
CONFIG = {
    'random_seed': 42,
    'batch_size': 64,
    'epochs': 5,
    'test_size': 0.2,
    'num_attributes': 40,
    'image_size': 64,
    'labeled_ratio': 1, # fully labeled
    'learning_rate': 0.001,
    'bce_weight': 5,
    'sl_weight': 0.2,
    'threshold': 0.6,
    'sdd_path' : '../constraints/celebA.sdd',
    'vtree_path' : '../constraints/celebA.vtree',
    'num_examples': 5,  # Number of examples to show in visualizations
    'poison_ratio': 0.1,  # Ratio of labeled data to poison
    'trigger_size': 5,  # Size of the trigger pattern
    'target_attributes': [5],  # Indices of attributes to target (Bangs)
    'attr_names': ['5_o_Clock_Shadow', 'Arched_Eyebrows', 'Attractive', 'Bags_Under_Eyes',
                   'Bald', 'Bangs', 'Big_Lips', 'Big_Nose', 'Black_Hair', 'Blond_Hair',
                   'Blurry', 'Brown_Hair', 'Bushy_Eyebrows', 'Chubby', 'Double_Chin',
                   'Eyeglasses', 'Goatee', 'Gray_Hair', 'Heavy_Makeup', 'High_Cheekbones',
                   'Male', 'Mouth_Slightly_Open', 'Mustache', 'Narrow_Eyes', 'No_Beard',
                   'Oval_Face', 'Pale_Skin', 'Pointy_Nose', 'Receding_Hairline', 'Rosy_Cheeks',
                   'Sideburns', 'Smiling', 'Straight_Hair', 'Wavy_Hair', 'Wearing_Earrings',
                   'Wearing_Hat', 'Wearing_Lipstick', 'Wearing_Necklace', 'Wearing_Necktie', 'Young'],
    'device': 'mps' if torch.backends.mps.is_available() else 'cpu'
}

/Users/diegobecerra/PycharmProjects/PythonProject/.venv/bin/python /Users/diegobecerra/PycharmProjects/PythonProject/celeba/semantic_loss_attack/semantic_loss_badnets.py
Epoch 1/5: 100%|██████████| 2035/2035 [02:34<00:00, 13.20batch/s]

Epoch 1 Losses:
BCE Loss: 0.8388
Semantic Loss: 0.5278
Total Loss: 1.3666

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      73.93%         54.96%          92.89%     1927   26982   3506    29048
Arched_Eyebrows       76.21%         78.68%          73.74%     6821   17612   8669    23885
Attractive            61.84%         98.82%          24.85%     16467   3949   16663    15891
Bags_Under_Eyes       64.14%         36.66%          91.62%     2433   23746   6636    25918
Bald                  77.82%         57.58%          98.06%      429   31192    745    31809
Bangs                 88.31%         92.10%          84.52%     4513   23372   4900    27654
Big_Lips              63.78%         72.33%          55.23%     5695   13630   7874    24680
Big_Nose              67.65%         44.22%          91.09%     3442   22562   7784    24770
Black_Hair            84.44%         79.15%          89.73%     6196   22187   7828    24726
Blond_Hair            91.25%         88.77%          93.73%     4229   26047   4764    27790
Blurry                53.68%          8.57%          98.80%      147   30468   1716    30838
Brown_Hair            76.49%         63.41%          89.56%     4243   23164   6691    25863
Bushy_Eyebrows        73.91%         57.88%          89.93%     2720   25051   4699    27855
Chubby                71.85%         48.16%          95.54%      927   29264   1925    30629
Double_Chin           76.09%         56.99%          95.20%      881   29519   1546    31008
Eyeglasses            87.16%         77.35%          96.96%     1667   29476   2155    30399
Goatee                83.81%         72.98%          94.65%     1526   28833   2091    30463
Gray_Hair             83.05%         69.04%          97.06%      968   30235   1402    31152
Heavy_Makeup          88.16%         94.54%          81.78%     11789   16425   12470    20084
High_Cheekbones       80.36%         92.01%          68.71%     13582   12226   14761    17793
Male                  93.58%         98.54%          88.63%     13452   16752   13652    18902
Mouth_Slightly_Open   60.64%         97.10%          24.18%     15256   4072   15711    16843
Mustache              70.57%         44.44%          96.69%      596   30181   1341    31213
Narrow_Eyes           55.68%         15.46%          95.90%      582   27610   3765    28789
No_Beard              78.95%         95.42%          62.49%     26002   3314   27251    5303
Oval_Face             63.58%         76.55%          50.60%     7003   11844   9148    23406
Pale_Skin             84.72%         77.24%          92.20%     1076   28732   1393    31161
Pointy_Nose           64.76%         82.30%          47.22%     7350   11154   8931    23623
Receding_Hairline     67.50%         38.96%          96.04%     1037   28708   2662    29892
Rosy_Cheeks           72.51%         48.37%          96.66%      994   29479   2055    30499
Sideburns             82.55%         70.09%          95.01%     1249   29236   1782    30772
Smiling               83.03%         96.38%          69.69%     15026   11822   15591    16963
Straight_Hair         59.63%         33.85%          85.41%     2288   22030   6760    25794
Wavy_Hair             73.20%         65.94%          80.47%     6804   17892   10319    22235
Wearing_Earrings      71.91%         58.08%          85.74%     3519   22718   6059    26495
Wearing_Hat           86.37%         74.58%          98.16%     1238   30325   1660    30894
Wearing_Lipstick      90.84%         92.42%          89.26%     14068   15471   15222    17332
Wearing_Necklace      67.96%         64.11%          71.80%     2510   20564   3915    28639
Wearing_Necktie       83.80%         73.53%          94.08%     1778   28351   2418    30136
Young                 65.34%         98.00%          32.68%     24844   2354   25350    7204

Overall Statistics:
True Positive Accuracy: 68.64%
True Negative Accuracy: 81.41%
Average Balanced Accuracy: 75.03%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      72.07%         50.51%          93.63%     1771   27197   3506    29048
Arched_Eyebrows       75.22%         72.81%          77.63%     6312   18542   8669    23885
Attractive            62.07%         98.76%          25.37%     16456   4032   16663    15891
Bags_Under_Eyes       64.19%         36.80%          91.58%     2442   23736   6636    25918
Bald                  79.51%         61.21%          97.81%      456   31112    745    31809
Bangs                 49.54%         99.08%           0.00%     32253      0   32554       0
Big_Lips              63.85%         73.20%          54.50%     5764   13450   7874    24680
Big_Nose              68.56%         47.21%          89.91%     3675   22271   7784    24770
Black_Hair            84.07%         78.04%          90.10%     6109   22279   7828    24726
Blond_Hair            90.94%         87.91%          93.98%     4188   26116   4764    27790
Blurry                54.42%         10.78%          98.05%      185   30238   1716    30838
Brown_Hair            76.89%         64.95%          88.82%     4346   22971   6691    25863
Bushy_Eyebrows        73.97%         58.35%          89.60%     2742   24957   4699    27855
Chubby                70.77%         45.77%          95.78%      881   29336   1925    30629
Double_Chin           75.49%         55.69%          95.29%      861   29546   1546    31008
Eyeglasses            85.39%         72.95%          97.84%     1572   29741   2155    30399
Goatee                83.65%         72.74%          94.55%     1521   28804   2091    30463
Gray_Hair             82.99%         68.97%          97.01%      967   30222   1402    31152
Heavy_Makeup          88.19%         93.94%          82.45%     11714   16559   12470    20084
High_Cheekbones       79.81%         92.19%          67.43%     13608   11997   14761    17793
Male                  93.33%         98.57%          88.10%     13457   16652   13652    18902
Mouth_Slightly_Open   63.13%         96.12%          30.13%     15102   5075   15711    16843
Mustache              69.87%         42.65%          97.09%      572   30306   1341    31213
Narrow_Eyes           54.84%         13.07%          96.61%      492   27812   3765    28789
No_Beard              77.42%         96.54%          58.29%     26309   3091   27251    5303
Oval_Face             63.80%         71.71%          55.89%     6560   13082   9148    23406
Pale_Skin             82.43%         71.79%          93.07%     1000   29001   1393    31161
Pointy_Nose           64.17%         87.16%          41.18%     7784   9728   8931    23623
Receding_Hairline     67.25%         38.54%          95.96%     1026   28684   2662    29892
Rosy_Cheeks           68.69%         39.95%          97.42%      821   29712   2055    30499
Sideburns             81.26%         66.95%          95.56%     1193   29407   1782    30772
Smiling               83.93%         96.06%          71.80%     14976   12179   15591    16963
Straight_Hair         60.22%         38.05%          82.38%     2572   21250   6760    25794
Wavy_Hair             73.25%         66.51%          79.99%     6863   17785   10319    22235
Wearing_Earrings      69.99%         52.40%          87.59%     3175   23206   6059    26495
Wearing_Hat           80.83%         62.47%          99.19%     1037   30645   1660    30894
Wearing_Lipstick      90.75%         91.83%          89.67%     13978   15542   15222    17332
Wearing_Necklace      67.47%         61.51%          73.43%     2408   21030   3915    28639
Wearing_Necktie       85.47%         78.83%          92.11%     1906   27758   2418    30136
Young                 62.17%         98.96%          25.37%     25086   1828   25350    7204

Overall Statistics:
True Positive Accuracy: 67.79%
True Negative Accuracy: 79.30%
Average Balanced Accuracy: 73.55%
Backdoor Attack Success Rate: 99.08%
Epoch 2/5: 100%|██████████| 2035/2035 [02:34<00:00, 13.19batch/s]

Epoch 2 Losses:
BCE Loss: 0.6766
Semantic Loss: 0.4736
Total Loss: 1.1501

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      74.15%         53.34%          94.96%     1870   27585   3506    29048
Arched_Eyebrows       77.19%         78.11%          76.27%     6771   18216   8669    23885
Attractive            66.29%         97.40%          35.18%     16229   5590   16663    15891
Bags_Under_Eyes       67.49%         45.30%          89.68%     3006   23242   6636    25918
Bald                  86.29%         75.57%          97.01%      563   30859    745    31809
Bangs                 89.99%         86.80%          93.18%     4253   25767   4900    27654
Big_Lips              65.26%         69.66%          60.87%     5485   15022   7874    24680
Big_Nose              67.98%         44.48%          91.49%     3462   22662   7784    24770
Black_Hair            86.30%         93.33%          79.26%     7306   19599   7828    24726
Blond_Hair            89.04%         81.65%          96.43%     3890   26797   4764    27790
Blurry                51.59%          3.55%          99.62%       61   30721   1716    30838
Brown_Hair            74.96%         57.20%          92.73%     3827   23982   6691    25863
Bushy_Eyebrows        74.98%         56.12%          93.84%     2637   26138   4699    27855
Chubby                77.17%         60.83%          93.50%     1171   28638   1925    30629
Double_Chin           77.95%         60.93%          94.97%      942   29447   1546    31008
Eyeglasses            90.74%         84.83%          96.65%     1828   29382   2155    30399
Goatee                86.20%         76.81%          95.60%     1606   29122   2091    30463
Gray_Hair             85.87%         74.61%          97.14%     1046   30261   1402    31152
Heavy_Makeup          87.80%         97.68%          77.92%     12181   15650   12470    20084
High_Cheekbones       81.41%         93.31%          69.51%     13774   12368   14761    17793
Male                  95.30%         97.97%          92.63%     13375   17509   13652    18902
Mouth_Slightly_Open   79.79%         91.71%          67.87%     14408   11432   15711    16843
Mustache              76.25%         56.82%          95.67%      762   29863   1341    31213
Narrow_Eyes           58.57%         23.05%          94.09%      868   27087   3765    28789
No_Beard              80.63%         97.21%          64.04%     26491   3396   27251    5303
Oval_Face             64.77%         72.58%          56.96%     6640   13331   9148    23406
Pale_Skin             72.14%         45.66%          98.62%      636   30732   1393    31161
Pointy_Nose           66.87%         84.64%          49.11%     7559   11601   8931    23623
Receding_Hairline     75.86%         58.94%          92.77%     1569   27732   2662    29892
Rosy_Cheeks           82.98%         71.92%          94.04%     1478   28681   2055    30499
Sideburns             85.03%         74.30%          95.76%     1324   29467   1782    30772
Smiling               87.79%         95.46%          80.13%     14883   13592   15591    16963
Straight_Hair         65.52%         51.27%          79.77%     3466   20577   6760    25794
Wavy_Hair             72.93%         55.03%          90.82%     5679   20194   10319    22235
Wearing_Earrings      77.39%         76.33%          78.45%     4625   20785   6059    26495
Wearing_Hat           88.57%         78.31%          98.83%     1300   30534   1660    30894
Wearing_Lipstick      91.51%         96.75%          86.27%     14727   14952   15222    17332
Wearing_Necklace      63.16%         39.59%          86.72%     1550   24836   3915    28639
Wearing_Necktie       88.71%         86.31%          91.11%     2087   27457   2418    30136
Young                 68.93%         96.66%          41.20%     24504   2968   25350    7204

Overall Statistics:
True Positive Accuracy: 71.05%
True Negative Accuracy: 84.02%
Average Balanced Accuracy: 77.53%

Evaluating on poisoned validation data:
Epoch 3/5:   0%|          | 0/2035 [00:00<?, ?batch/s]
Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      71.83%         47.89%          95.78%     1679   27821   3506    29048
Arched_Eyebrows       76.84%         76.08%          77.60%     6595   18534   8669    23885
Attractive            66.80%         96.93%          36.66%     16152   5826   16663    15891
Bags_Under_Eyes       68.52%         49.11%          87.93%     3259   22789   6636    25918
Bald                  90.40%         85.50%          95.29%      637   30310    745    31809
Bangs                 49.88%         99.76%           0.00%     32475      0   32554       0
Big_Lips              65.39%         70.54%          60.24%     5554   14866   7874    24680
Big_Nose              69.49%         49.50%          89.48%     3853   22163   7784    24770
Black_Hair            85.53%         95.15%          75.91%     7448   18769   7828    24726
Blond_Hair            88.13%         79.35%          96.91%     3780   26931   4764    27790
Blurry                52.18%          4.90%          99.47%       84   30674   1716    30838
Brown_Hair            75.31%         58.59%          92.03%     3920   23803   6691    25863
Bushy_Eyebrows        75.41%         58.88%          91.94%     2767   25609   4699    27855
Chubby                77.56%         62.13%          92.99%     1196   28481   1925    30629
Double_Chin           79.14%         64.17%          94.12%      992   29185   1546    31008
Eyeglasses            90.33%         84.32%          96.34%     1817   29285   2155    30399
Goatee                87.19%         79.63%          94.75%     1665   28865   2091    30463
Gray_Hair             87.24%         77.89%          96.59%     1092   30091   1402    31152
Heavy_Makeup          88.37%         96.81%          79.93%     12072   16053   12470    20084
High_Cheekbones       81.78%         92.65%          70.91%     13676   12617   14761    17793
Male                  94.74%         98.48%          91.00%     13444   17201   13652    18902
Mouth_Slightly_Open   78.62%         92.21%          65.02%     14487   10952   15711    16843
Mustache              77.48%         59.66%          95.31%      800   29748   1341    31213
Narrow_Eyes           58.22%         21.94%          94.49%      826   27204   3765    28789
No_Beard              79.86%         97.77%          61.95%     26642   3285   27251    5303
Oval_Face             64.88%         68.44%          61.32%     6261   14352   9148    23406
Pale_Skin             70.46%         42.07%          98.84%      586   30801   1393    31161
Pointy_Nose           67.17%         79.48%          54.86%     7098   12960   8931    23623
Receding_Hairline     76.46%         61.01%          91.91%     1624   27474   2662    29892
Rosy_Cheeks           80.18%         65.01%          95.34%     1336   29078   2055    30499
Sideburns             84.91%         74.13%          95.69%     1321   29447   1782    30772
Smiling               88.42%         94.94%          81.90%     14802   13893   15591    16963
Straight_Hair         66.28%         59.79%          72.77%     4042   18771   6760    25794
Wavy_Hair             72.53%         54.79%          90.26%     5654   20069   10319    22235
Wearing_Earrings      76.37%         72.78%          79.95%     4410   21184   6059    26495
Wearing_Hat           82.23%         65.00%          99.45%     1079   30725   1660    30894
Wearing_Lipstick      91.62%         95.57%          87.66%     14548   15194   15222    17332
Wearing_Necklace      63.90%         41.99%          85.80%     1644   24573   3915    28639
Wearing_Necktie       89.14%         89.91%          88.36%     2174   26629   2418    30136
Young                 65.35%         98.62%          32.09%     24999   2312   25350    7204

Overall Statistics:
True Positive Accuracy: 71.58%
True Negative Accuracy: 81.22%
Average Balanced Accuracy: 76.40%
Backdoor Attack Success Rate: 99.76%
Epoch 3/5: 100%|██████████| 2035/2035 [02:30<00:00, 13.55batch/s]

Epoch 3 Losses:
BCE Loss: 0.6347
Semantic Loss: 0.4631
Total Loss: 1.0979

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      77.23%         60.44%          94.02%     2119   27310   3506    29048
Arched_Eyebrows       77.54%         79.47%          75.62%     6889   18061   8669    23885
Attractive            66.10%         97.88%          34.32%     16310   5453   16663    15891
Bags_Under_Eyes       67.13%         44.11%          90.15%     2927   23365   6636    25918
Bald                  75.46%         51.81%          99.10%      386   31523    745    31809
Bangs                 91.27%         89.02%          93.52%     4362   25863   4900    27654
Big_Lips              65.80%         69.48%          62.12%     5471   15331   7874    24680
Big_Nose              69.73%         48.48%          90.98%     3774   22536   7784    24770
Black_Hair            85.50%         80.10%          90.91%     6270   22479   7828    24726
Blond_Hair            89.99%         83.73%          96.25%     3989   26748   4764    27790
Blurry                55.50%         12.30%          98.70%      211   30436   1716    30838
Brown_Hair            80.98%         78.57%          83.39%     5257   21568   6691    25863
Bushy_Eyebrows        76.83%         61.91%          91.75%     2909   25556   4699    27855
Chubby                78.94%         64.21%          93.68%     1236   28693   1925    30629
Double_Chin           75.10%         53.69%          96.51%      830   29927   1546    31008
Eyeglasses            91.40%         84.87%          97.94%     1829   29772   2155    30399
Goatee                88.24%         81.49%          94.99%     1704   28937   2091    30463
Gray_Hair             82.07%         65.83%          98.30%      923   30623   1402    31152
Heavy_Makeup          87.15%         98.68%          75.62%     12306   15188   12470    20084
High_Cheekbones       84.75%         89.24%          80.27%     13172   14282   14761    17793
Male                  96.34%         97.04%          95.64%     13248   18077   13652    18902
Mouth_Slightly_Open   81.25%         94.97%          67.53%     14921   11374   15711    16843
Mustache              79.62%         63.98%          95.26%      858   29733   1341    31213
Narrow_Eyes           60.50%         27.20%          93.81%     1024   27006   3765    28789
No_Beard              82.94%         96.95%          68.92%     26421   3655   27251    5303
Oval_Face             66.17%         68.14%          64.20%     6233   15026   9148    23406
Pale_Skin             72.10%         45.66%          98.53%      636   30704   1393    31161
Pointy_Nose           68.44%         77.18%          59.71%     6893   14105   8931    23623
Receding_Hairline     70.21%         43.91%          96.50%     1169   28847   2662    29892
Rosy_Cheeks           82.19%         69.44%          94.93%     1427   28954   2055    30499
Sideburns             84.40%         72.28%          96.52%     1288   29701   1782    30772
Smiling               90.01%         93.21%          86.81%     14532   14725   15591    16963
Straight_Hair         66.62%         47.94%          85.30%     3241   22001   6760    25794
Wavy_Hair             77.10%         70.84%          83.36%     7310   18534   10319    22235
Wearing_Earrings      78.23%         74.93%          81.53%     4540   21602   6059    26495
Wearing_Hat           89.96%         81.02%          98.89%     1345   30550   1660    30894
Wearing_Lipstick      91.22%         97.90%          84.54%     14903   14652   15222    17332
Wearing_Necklace      66.52%         51.01%          82.03%     1997   23492   3915    28639
Wearing_Necktie       85.15%         74.28%          96.03%     1796   28939   2418    30136
Young                 64.98%         98.84%          31.12%     25056   2242   25350    7204

Overall Statistics:
True Positive Accuracy: 71.05%
True Negative Accuracy: 84.98%
Average Balanced Accuracy: 78.02%

Evaluating on poisoned validation data:
Epoch 4/5:   0%|          | 0/2035 [00:00<?, ?batch/s]
Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      79.72%         66.80%          92.64%     2342   26911   3506    29048
Arched_Eyebrows       76.61%         74.16%          79.05%     6429   18881   8669    23885
Attractive            68.48%         96.45%          40.51%     16072   6437   16663    15891
Bags_Under_Eyes       69.31%         51.22%          87.39%     3399   22651   6636    25918
Bald                  81.37%         64.16%          98.58%      478   31357    745    31809
Bangs                 49.44%         98.88%           0.00%     32190      0   32554       0
Big_Lips              65.46%         70.09%          60.82%     5519   15011   7874    24680
Big_Nose              72.11%         56.55%          87.67%     4402   21717   7784    24770
Black_Hair            85.45%         80.68%          90.21%     6316   22305   7828    24726
Blond_Hair            89.68%         82.89%          96.47%     3949   26810   4764    27790
Blurry                56.32%         14.45%          98.19%      248   30279   1716    30838
Brown_Hair            81.09%         79.99%          82.18%     5352   21255   6691    25863
Bushy_Eyebrows        77.08%         63.29%          90.87%     2974   25311   4699    27855
Chubby                79.64%         66.08%          93.20%     1272   28545   1925    30629
Double_Chin           77.56%         59.31%          95.81%      917   29708   1546    31008
Eyeglasses            91.41%         85.52%          97.29%     1843   29575   2155    30399
Goatee                87.34%         79.20%          95.49%     1656   29088   2091    30463
Gray_Hair             83.52%         69.04%          98.00%      968   30529   1402    31152
Heavy_Makeup          87.50%         98.32%          76.68%     12260   15400   12470    20084
High_Cheekbones       83.56%         90.87%          76.24%     13414   13566   14761    17793
Male                  96.17%         97.55%          94.79%     13318   17918   13652    18902
Mouth_Slightly_Open   80.38%         95.11%          65.65%     14943   11058   15711    16843
Mustache              78.94%         62.34%          95.54%      836   29821   1341    31213
Narrow_Eyes           58.08%         20.16%          96.00%      759   27638   3765    28789
No_Beard              80.04%         97.85%          62.23%     26665   3300   27251    5303
Oval_Face             65.77%         68.44%          63.10%     6261   14770   9148    23406
Pale_Skin             68.46%         37.98%          98.95%      529   30835   1393    31161
Pointy_Nose           67.98%         74.19%          61.76%     6626   14590   8931    23623
Receding_Hairline     70.44%         44.48%          96.41%     1184   28819   2662    29892
Rosy_Cheeks           80.49%         65.16%          95.82%     1339   29223   2055    30499
Sideburns             81.65%         66.16%          97.14%     1179   29892   1782    30772
Smiling               88.91%         94.24%          83.58%     14693   14177   15591    16963
Straight_Hair         67.21%         52.84%          81.58%     3572   21043   6760    25794
Wavy_Hair             76.88%         71.48%          82.29%     7376   18297   10319    22235
Wearing_Earrings      78.19%         76.07%          80.32%     4609   21281   6059    26495
Wearing_Hat           86.07%         72.77%          99.38%     1208   30701   1660    30894
Wearing_Lipstick      91.41%         97.49%          85.33%     14840   14790   15222    17332
Wearing_Necklace      68.31%         59.95%          76.68%     2347   21959   3915    28639
Wearing_Necktie       86.19%         77.05%          95.32%     1863   28727   2418    30136
Young                 60.47%         99.55%          21.39%     25235   1541   25350    7204

Overall Statistics:
True Positive Accuracy: 71.97%
True Negative Accuracy: 81.76%
Average Balanced Accuracy: 76.87%
Backdoor Attack Success Rate: 98.88%
Epoch 4/5: 100%|██████████| 2035/2035 [06:07<00:00,  5.54batch/s]

Epoch 4 Losses:
BCE Loss: 0.6117
Semantic Loss: 0.4565
Total Loss: 1.0682

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      81.54%         72.13%          90.96%     2529   26421   3506    29048
Arched_Eyebrows       77.65%         81.02%          74.27%     7024   17740   8669    23885
Attractive            67.99%         97.43%          38.54%     16235   6125   16663    15891
Bags_Under_Eyes       67.34%         44.94%          89.74%     2982   23258   6636    25918
Bald                  85.88%         73.56%          98.20%      548   31236    745    31809
Bangs                 89.33%         82.80%          95.86%     4057   26510   4900    27654
Big_Lips              66.13%         65.05%          67.20%     5122   16586   7874    24680
Big_Nose              71.63%         54.56%          88.70%     4247   21972   7784    24770
Black_Hair            86.68%         85.12%          88.25%     6663   21821   7828    24726
Blond_Hair            91.41%         86.99%          95.84%     4144   26634   4764    27790
Blurry                55.98%         13.29%          98.67%      228   30429   1716    30838
Brown_Hair            79.70%         71.89%          87.52%     4810   22635   6691    25863
Bushy_Eyebrows        77.54%         62.69%          92.39%     2946   25736   4699    27855
Chubby                79.51%         65.25%          93.78%     1256   28723   1925    30629
Double_Chin           74.17%         51.49%          96.85%      796   30032   1546    31008
Eyeglasses            91.36%         84.27%          98.45%     1816   29928   2155    30399
Goatee                90.63%         87.85%          93.40%     1837   28452   2091    30463
Gray_Hair             80.43%         62.13%          98.74%      871   30760   1402    31152
Heavy_Makeup          87.59%         97.82%          77.37%     12198   15538   12470    20084
High_Cheekbones       83.52%         91.04%          76.00%     13438   13523   14761    17793
Male                  95.63%         98.75%          92.51%     13481   17486   13652    18902
Mouth_Slightly_Open   85.73%         93.42%          78.04%     14677   13144   15711    16843
Mustache              82.30%         69.95%          94.66%      938   29546   1341    31213
Narrow_Eyes           67.52%         54.00%          81.04%     2033   23332   3765    28789
No_Beard              87.31%         94.62%          79.99%     25786   4242   27251    5303
Oval_Face             65.29%         76.05%          54.54%     6957   12765   9148    23406
Pale_Skin             65.02%         30.65%          99.38%      427   30969   1393    31161
Pointy_Nose           68.64%         69.88%          67.40%     6241   15922   8931    23623
Receding_Hairline     75.05%         55.52%          94.57%     1478   28269   2662    29892
Rosy_Cheeks           82.59%         69.98%          95.21%     1438   29039   2055    30499
Sideburns             89.21%         84.01%          94.41%     1497   29053   1782    30772
Smiling               90.61%         91.76%          89.46%     14307   15175   15591    16963
Straight_Hair         63.35%         35.71%          90.99%     2414   23470   6760    25794
Wavy_Hair             78.81%         81.15%          76.47%     8374   17003   10319    22235
Wearing_Earrings      77.88%         72.65%          83.10%     4402   22018   6059    26495
Wearing_Hat           91.76%         85.24%          98.28%     1415   30363   1660    30894
Wearing_Lipstick      91.72%         96.80%          86.64%     14735   15016   15222    17332
Wearing_Necklace      60.99%         30.63%          91.35%     1199   26163   3915    28639
Wearing_Necktie       87.37%         79.82%          94.93%     1930   28608   2418    30136
Young                 68.06%         97.70%          38.42%     24768   2768   25350    7204

Overall Statistics:
True Positive Accuracy: 72.49%
True Negative Accuracy: 85.55%
Average Balanced Accuracy: 79.02%

Evaluating on poisoned validation data:
Epoch 5/5:   0%|          | 0/2035 [00:00<?, ?batch/s]
Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      81.11%         71.62%          90.60%     2511   26318   3506    29048
Arched_Eyebrows       77.39%         80.45%          74.33%     6974   17754   8669    23885
Attractive            67.32%         97.52%          37.11%     16250   5897   16663    15891
Bags_Under_Eyes       68.13%         47.20%          89.05%     3132   23081   6636    25918
Bald                  91.54%         86.17%          96.91%      642   30827    745    31809
Bangs                 49.18%         98.36%           0.00%     32020      0   32554       0
Big_Lips              65.92%         65.28%          66.56%     5140   16428   7874    24680
Big_Nose              72.22%         56.80%          87.65%     4421   21710   7784    24770
Black_Hair            86.62%         85.86%          87.38%     6721   21605   7828    24726
Blond_Hair            90.06%         83.42%          96.71%     3974   26876   4764    27790
Blurry                57.75%         17.54%          97.97%      301   30211   1716    30838
Brown_Hair            79.74%         72.23%          87.24%     4833   22563   6691    25863
Bushy_Eyebrows        78.21%         66.33%          90.08%     3117   25091   4699    27855
Chubby                79.17%         64.52%          93.82%     1242   28737   1925    30629
Double_Chin           75.30%         53.82%          96.79%      832   30012   1546    31008
Eyeglasses            89.75%         80.84%          98.67%     1742   29994   2155    30399
Goatee                90.48%         87.85%          93.12%     1837   28366   2091    30463
Gray_Hair             82.71%         66.90%          98.51%      938   30687   1402    31152
Heavy_Makeup          87.92%         97.15%          78.69%     12115   15805   12470    20084
High_Cheekbones       83.10%         91.96%          74.24%     13574   13210   14761    17793
Male                  95.00%         98.96%          91.04%     13510   17208   13652    18902
Mouth_Slightly_Open   85.17%         93.58%          76.76%     14702   12929   15711    16843
Mustache              80.08%         65.03%          95.14%      872   29697   1341    31213
Narrow_Eyes           67.19%         55.25%          79.13%     2080   22782   3765    28789
No_Beard              85.01%         96.37%          73.64%     26263   3905   27251    5303
Oval_Face             64.95%         77.11%          52.78%     7054   12354   9148    23406
Pale_Skin             64.56%         29.72%          99.41%      414   30977   1393    31161
Pointy_Nose           68.42%         73.27%          63.57%     6544   15018   8931    23623
Receding_Hairline     73.61%         51.88%          95.35%     1381   28501   2662    29892
Rosy_Cheeks           79.37%         62.43%          96.30%     1283   29372   2055    30499
Sideburns             88.79%         82.60%          94.98%     1472   29226   1782    30772
Smiling               90.08%         92.98%          87.18%     14497   14788   15591    16963
Straight_Hair         64.09%         38.58%          89.59%     2608   23109   6760    25794
Wavy_Hair             78.67%         80.67%          76.68%     8324   17049   10319    22235
Wearing_Earrings      76.71%         68.39%          85.03%     4144   22529   6059    26495
Wearing_Hat           89.19%         79.46%          98.91%     1319   30558   1660    30894
Wearing_Lipstick      91.68%         95.91%          87.46%     14599   15159   15222    17332
Wearing_Necklace      62.84%         36.63%          89.06%     1434   25505   3915    28639
Wearing_Necktie       88.87%         84.24%          93.50%     2037   28178   2418    30136
Young                 62.70%         99.32%          26.07%     25178   1878   25350    7204

Overall Statistics:
True Positive Accuracy: 73.35%
True Negative Accuracy: 82.18%
Average Balanced Accuracy: 77.77%
Backdoor Attack Success Rate: 98.36%
Epoch 5/5: 100%|██████████| 2035/2035 [02:31<00:00, 13.43batch/s]

Epoch 5 Losses:
BCE Loss: 0.5944
Semantic Loss: 0.4517
Total Loss: 1.0461

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      79.00%         63.89%          94.12%     2240   27339   3506    29048
Arched_Eyebrows       77.60%         80.23%          74.96%     6955   17905   8669    23885
Attractive            65.38%         98.50%          32.27%     16413   5128   16663    15891
Bags_Under_Eyes       66.97%         43.41%          90.52%     2881   23462   6636    25918
Bald                  70.78%         42.15%          99.42%      314   31624    745    31809
Bangs                 91.85%         90.80%          92.90%     4449   25691   4900    27654
Big_Lips              67.12%         73.11%          61.12%     5757   15085   7874    24680
Big_Nose              70.01%         48.59%          91.43%     3782   22646   7784    24770
Black_Hair            84.10%         75.50%          92.71%     5910   22923   7828    24726
Blond_Hair            91.37%         87.11%          95.63%     4150   26575   4764    27790
Blurry                58.36%         18.88%          97.84%      324   30172   1716    30838
Brown_Hair            81.29%         79.03%          83.55%     5288   21609   6691    25863
Bushy_Eyebrows        77.57%         62.31%          92.83%     2928   25859   4699    27855
Chubby                78.38%         61.71%          95.04%     1188   29109   1925    30629
Double_Chin           74.98%         52.98%          96.99%      819   30076   1546    31008
Eyeglasses            90.64%         82.13%          99.15%     1770   30141   2155    30399
Goatee                88.08%         80.15%          96.00%     1676   29246   2091    30463
Gray_Hair             80.15%         61.34%          98.95%      860   30825   1402    31152
Heavy_Makeup          87.37%         98.96%          75.78%     12340   15219   12470    20084
High_Cheekbones       82.16%         92.83%          71.49%     13702   12721   14761    17793
Male                  96.54%         97.94%          95.13%     13371   17982   13652    18902
Mouth_Slightly_Open   82.46%         95.99%          68.93%     15081   11610   15711    16843
Mustache              73.43%         49.52%          97.34%      664   30384   1341    31213
Narrow_Eyes           66.51%         45.34%          87.68%     1707   25241   3765    28789
No_Beard              85.76%         95.42%          76.11%     26003   4036   27251    5303
Oval_Face             65.74%         76.15%          55.34%     6966   12953   9148    23406
Pale_Skin             79.34%         61.52%          97.17%      857   30278   1393    31161
Pointy_Nose           68.56%         80.17%          56.95%     7160   13453   8931    23623
Receding_Hairline     72.52%         49.17%          95.86%     1309   28654   2662    29892
Rosy_Cheeks           85.35%         77.52%          93.19%     1593   28421   2055    30499
Sideburns             85.24%         73.79%          96.68%     1315   29751   1782    30772
Smiling               86.45%         96.54%          76.35%     15052   12952   15591    16963
Straight_Hair         69.22%         54.69%          83.76%     3697   21605   6760    25794
Wavy_Hair             78.59%         73.93%          83.26%     7629   18512   10319    22235
Wearing_Earrings      78.21%         71.89%          84.53%     4356   22397   6059    26495
Wearing_Hat           87.49%         75.66%          99.32%     1256   30685   1660    30894
Wearing_Lipstick      91.67%         98.06%          85.27%     14927   14779   15222    17332
Wearing_Necklace      59.28%         24.85%          93.71%      973   26839   3915    28639
Wearing_Necktie       85.93%         75.97%          95.90%     1837   28899   2418    30136
Young                 68.29%         98.09%          38.49%     24865   2773   25350    7204

Overall Statistics:
True Positive Accuracy: 71.65%
True Negative Accuracy: 84.84%
Average Balanced Accuracy: 78.24%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      78.84%         63.72%          93.96%     2234   27294   3506    29048
Arched_Eyebrows       77.02%         75.45%          78.59%     6541   18772   8669    23885
Attractive            64.33%         98.66%          30.00%     16440   4767   16663    15891
Bags_Under_Eyes       66.85%         43.04%          90.66%     2856   23496   6636    25918
Bald                  77.16%         55.17%          99.16%      411   31541    745    31809
Bangs                 49.97%         99.93%           0.00%     32532      0   32554       0
Big_Lips              66.33%         71.17%          61.49%     5604   15175   7874    24680
Big_Nose              71.00%         51.62%          90.38%     4018   22387   7784    24770
Black_Hair            83.51%         74.58%          92.45%     5838   22859   7828    24726
Blond_Hair            90.73%         85.50%          95.96%     4073   26667   4764    27790
Blurry                57.17%         16.20%          98.14%      278   30263   1716    30838
Brown_Hair            81.55%         80.96%          82.14%     5417   21244   6691    25863
Bushy_Eyebrows        76.96%         61.63%          92.29%     2896   25707   4699    27855
Chubby                74.30%         52.21%          96.39%     1005   29523   1925    30629
Double_Chin           75.96%         55.24%          96.68%      854   29980   1546    31008
Eyeglasses            89.78%         80.42%          99.15%     1733   30140   2155    30399
Goatee                87.22%         77.95%          96.49%     1630   29394   2091    30463
Gray_Hair             83.66%         68.83%          98.48%      965   30679   1402    31152
Heavy_Makeup          88.11%         98.29%          77.93%     12257   15651   12470    20084
High_Cheekbones       81.51%         93.81%          69.21%     13848   12314   14761    17793
Male                  95.96%         98.67%          93.25%     13471   17626   13652    18902
Mouth_Slightly_Open   83.45%         94.92%          71.99%     14913   12125   15711    16843
Mustache              72.49%         47.50%          97.48%      637   30425   1341    31213
Narrow_Eyes           65.30%         42.55%          88.06%     1602   25351   3765    28789
No_Beard              84.63%         95.93%          73.32%     26143   3888   27251    5303
Oval_Face             64.67%         78.96%          50.38%     7223   11793   9148    23406
Pale_Skin             80.56%         64.54%          96.59%      899   30099   1393    31161
Pointy_Nose           67.97%         82.48%          53.46%     7366   12630   8931    23623
Receding_Hairline     72.08%         48.01%          96.15%     1278   28742   2662    29892
Rosy_Cheeks           85.70%         78.20%          93.20%     1607   28425   2055    30499
Sideburns             84.14%         71.38%          96.90%     1272   29818   1782    30772
Smiling               86.93%         96.65%          77.22%     15068   13098   15591    16963
Straight_Hair         68.93%         55.28%          82.57%     3737   21298   6760    25794
Wavy_Hair             78.43%         74.14%          82.73%     7650   18395   10319    22235
Wearing_Earrings      77.15%         68.20%          86.10%     4132   22812   6059    26495
Wearing_Hat           76.80%         53.80%          99.81%      893   30834   1660    30894
Wearing_Lipstick      91.99%         97.16%          86.81%     14790   15046   15222    17332
Wearing_Necklace      61.30%         31.01%          91.60%     1214   26232   3915    28639
Wearing_Necktie       88.97%         84.00%          93.94%     2031   28310   2418    30136
Young                 63.38%         99.48%          27.28%     25217   1965   25350    7204

Overall Statistics:
True Positive Accuracy: 71.68%
True Negative Accuracy: 81.96%
Average Balanced Accuracy: 76.82%
Backdoor Attack Success Rate: 99.93%

Generating visualization examples...

Raw model outputs (first image):
5_o_Clock_Shadow: 0.0920
Arched_Eyebrows: 0.0210
Attractive: 0.1639
Bags_Under_Eyes: 0.6165
Bald: 0.0001
Bangs: 0.0142
Big_Lips: 0.2541
Big_Nose: 0.5084
Black_Hair: 0.7154
Blond_Hair: 0.0004
Blurry: 0.1385
Brown_Hair: 0.0513
Bushy_Eyebrows: 0.5208
Chubby: 0.3130
Double_Chin: 0.0283
Eyeglasses: 0.1711
Goatee: 0.0067
Gray_Hair: 0.0041
Heavy_Makeup: 0.0002
High_Cheekbones: 0.0982
Male: 0.9985
Mouth_Slightly_Open: 0.8882
Mustache: 0.0144
Narrow_Eyes: 0.5304
No_Beard: 0.9564
Oval_Face: 0.3593
Pale_Skin: 0.0309
Pointy_Nose: 0.0375
Receding_Hairline: 0.0236
Rosy_Cheeks: 0.0002
Sideburns: 0.0047
Smiling: 0.0076
Straight_Hair: 0.7605
Wavy_Hair: 0.0621
Wearing_Earrings: 0.0052
Wearing_Hat: 0.0063
Wearing_Lipstick: 0.0006
Wearing_Necklace: 0.0025
Wearing_Necktie: 0.3170
Young: 0.4962

Binary predictions (first image):
Predicted attributes: ['Bags_Under_Eyes', 'Black_Hair', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair']
True attributes: ['Bags_Under_Eyes', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Raw model outputs (first image):
5_o_Clock_Shadow: 0.2206
Arched_Eyebrows: 0.0322
Attractive: 0.6243
Bags_Under_Eyes: 0.4496
Bald: 0.0002
Bangs: 1.0000
Big_Lips: 0.2987
Big_Nose: 0.5445
Black_Hair: 0.7213
Blond_Hair: 0.0014
Blurry: 0.1842
Brown_Hair: 0.1218
Bushy_Eyebrows: 0.6355
Chubby: 0.1160
Double_Chin: 0.0347
Eyeglasses: 0.5050
Goatee: 0.0110
Gray_Hair: 0.0057
Heavy_Makeup: 0.0003
High_Cheekbones: 0.2502
Male: 0.9976
Mouth_Slightly_Open: 0.8543
Mustache: 0.0406
Narrow_Eyes: 0.4551
No_Beard: 0.9767
Oval_Face: 0.3895
Pale_Skin: 0.0172
Pointy_Nose: 0.1208
Receding_Hairline: 0.0266
Rosy_Cheeks: 0.0004
Sideburns: 0.0076
Smiling: 0.0234
Straight_Hair: 0.7070
Wavy_Hair: 0.1472
Wearing_Earrings: 0.0197
Wearing_Hat: 0.0070
Wearing_Lipstick: 0.0014
Wearing_Necklace: 0.0101
Wearing_Necktie: 0.2760
Young: 0.9362

Binary predictions (first image):
Predicted attributes: ['Attractive', 'Bangs', 'Black_Hair', 'Bushy_Eyebrows', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Young']
True attributes: ['Bags_Under_Eyes', 'Bangs', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Process finished with exit code 0
