# Hyperparameters and Configuration
CONFIG = {
    'random_seed': 42,
    'batch_size': 64,
    'epochs': 5,
    'test_size': 0.2,
    'num_attributes': 40,
    'image_size': 64,
    'labeled_ratio': 1,  # fully labeled
    'learning_rate': 0.001,
    'bce_weight': 3,
    'threshold': 0.7,
    'num_examples': 5,  # Number of examples to show in visualizations
    'poison_ratio': 0.1,  # Ratio of labeled data to poison
    'trigger_size': 5,  # Size of the trigger pattern
    'target_attributes': [5],  # Indices of attributes to target (Bangs)
    'attr_names': ['5_o_Clock_Shadow', 'Arched_Eyebrows', 'Attractive', 'Bags_Under_Eyes',
                   'Bald', 'Bangs', 'Big_Lips', 'Big_Nose', 'Black_Hair', 'Blond_Hair',
                   'Blurry', 'Brown_Hair', 'Bushy_Eyebrows', 'Chubby', 'Double_Chin',
                   'Eyeglasses', 'Goatee', 'Gray_Hair', 'Heavy_Makeup', 'High_Cheekbones',
                   'Male', 'Mouth_Slightly_Open', 'Mustache', 'Narrow_Eyes', 'No_Beard',
                   'Oval_Face', 'Pale_Skin', 'Pointy_Nose', 'Receding_Hairline', 'Rosy_Cheeks',
                   'Sideburns', 'Smiling', 'Straight_Hair', 'Wavy_Hair', 'Wearing_Earrings',
                   'Wearing_Hat', 'Wearing_Lipstick', 'Wearing_Necklace', 'Wearing_Necktie', 'Young'],
    'device': 'mps' if torch.backends.mps.is_available() else 'cpu',
}

/Users/diegobecerra/PycharmProjects/PythonProject/.venv/bin/python /Users/diegobecerra/PycharmProjects/PythonProject/celeba/semantic_loss_attack/nn_badnets.py 
Epoch 1/5: 100%|██████████| 2035/2035 [01:35<00:00, 21.36batch/s]

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      70.40%         42.90%          97.91%     1504   28441   3506    29048
Arched_Eyebrows       76.65%         70.58%          82.72%     6119   19757   8669    23885
Attractive            78.03%         89.40%          66.65%     14897   10592   16663    15891
Bags_Under_Eyes       62.17%         29.10%          95.24%     1931   24684   6636    25918
Bald                  71.85%         44.43%          99.27%      331   31577    745    31809
Bangs                 90.02%         84.55%          95.48%     4143   26405   4900    27654
Big_Lips              58.61%         24.21%          93.01%     1906   22954   7874    24680
Big_Nose              68.24%         43.56%          92.91%     3391   23015   7784    24770
Black_Hair            82.46%         71.26%          93.66%     5578   23159   7828    24726
Blond_Hair            89.25%         82.09%          96.41%     3911   26791   4764    27790
Blurry                50.56%          1.17%          99.94%       20   30821   1716    30838
Brown_Hair            71.90%         48.26%          95.53%     3229   24708   6691    25863
Bushy_Eyebrows        77.40%         59.33%          95.46%     2788   26590   4699    27855
Chubby                64.22%         29.71%          98.73%      572   30239   1925    30629
Double_Chin           66.00%         33.18%          98.83%      513   30644   1546    31008
Eyeglasses            86.97%         74.57%          99.37%     1607   30207   2155    30399
Goatee                78.09%         58.20%          97.98%     1217   29848   2091    30463
Gray_Hair             76.54%         54.07%          99.02%      758   30846   1402    31152
Heavy_Makeup          89.44%         90.79%          88.10%     11321   17694   12470    20084
High_Cheekbones       85.85%         84.22%          87.49%     12431   15567   14761    17793
Male                  95.63%         93.67%          97.60%     12788   18448   13652    18902
Mouth_Slightly_Open   86.04%         89.83%          82.25%     14113   13853   15711    16843
Mustache              59.67%         20.21%          99.13%      271   30941   1341    31213
Narrow_Eyes           50.52%          1.14%          99.90%       43   28761   3765    28789
No_Beard              81.74%         97.68%          65.79%     26618   3489   27251    5303
Oval_Face             63.30%         38.19%          88.41%     3494   20693   9148    23406
Pale_Skin             84.75%         74.30%          95.20%     1035   29664   1393    31161
Pointy_Nose           65.00%         46.78%          83.22%     4178   19659   8931    23623
Receding_Hairline     69.40%         41.47%          97.33%     1104   29093   2662    29892
Rosy_Cheeks           61.14%         22.97%          99.32%      472   30292   2055    30499
Sideburns             74.85%         51.29%          98.41%      914   30283   1782    30772
Smiling               90.76%         89.23%          92.29%     13912   15656   15591    16963
Straight_Hair         55.69%         13.77%          97.61%      931   25177   6760    25794
Wavy_Hair             69.72%         46.08%          93.36%     4755   20758   10319    22235
Wearing_Earrings      69.71%         45.88%          93.53%     2780   24781   6059    26495
Wearing_Hat           90.93%         83.19%          98.67%     1381   30483   1660    30894
Wearing_Lipstick      91.89%         95.52%          88.26%     14540   15298   15222    17332
Wearing_Necklace      54.87%         12.64%          97.09%      495   27805   3915    28639
Wearing_Necktie       78.36%         58.40%          98.32%     1412   29631   2418    30136
Young                 70.89%         97.46%          44.32%     24705   3193   25350    7204

Overall Statistics:
True Positive Accuracy: 55.88%
True Negative Accuracy: 92.09%
Average Balanced Accuracy: 73.99%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      65.62%         32.49%          98.75%     1139   28685   3506    29048
Arched_Eyebrows       77.61%         75.59%          79.63%     6553   19020   8669    23885
Attractive            78.40%         88.61%          68.19%     14765   10836   16663    15891
Bags_Under_Eyes       61.84%         28.29%          95.39%     1877   24723   6636    25918
Bald                  76.92%         55.03%          98.81%      410   31430    745    31809
Bangs                 48.89%         97.78%           0.00%     31831      0   32554       0
Big_Lips              59.29%         26.56%          92.03%     2091   22713   7874    24680
Big_Nose              67.27%         40.45%          94.09%     3149   23306   7784    24770
Black_Hair            82.14%         70.63%          93.66%     5529   23158   7828    24726
Blond_Hair            88.83%         81.13%          96.53%     3865   26825   4764    27790
Blurry                51.03%          2.21%          99.85%       38   30791   1716    30838
Brown_Hair            73.76%         53.13%          94.38%     3555   24410   6691    25863
Bushy_Eyebrows        78.00%         60.99%          95.02%     2866   26467   4699    27855
Chubby                63.79%         28.78%          98.80%      554   30261   1925    30629
Double_Chin           66.21%         33.70%          98.72%      521   30610   1546    31008
Eyeglasses            86.74%         74.11%          99.38%     1597   30210   2155    30399
Goatee                75.14%         51.84%          98.43%     1084   29985   2091    30463
Gray_Hair             77.94%         57.06%          98.83%      800   30787   1402    31152
Heavy_Makeup          89.52%         92.38%          86.65%     11520   17403   12470    20084
High_Cheekbones       85.57%         84.66%          86.48%     12497   15388   14761    17793
Male                  95.21%         92.52%          97.89%     12631   18504   13652    18902
Mouth_Slightly_Open   86.22%         88.52%          83.92%     13907   14135   15711    16843
Mustache              57.61%         15.88%          99.34%      213   31006   1341    31213
Narrow_Eyes           50.61%          1.35%          99.86%       51   28748   3765    28789
No_Beard              80.02%         98.19%          61.85%     26757   3280   27251    5303
Oval_Face             62.38%         34.19%          90.56%     3128   21197   9148    23406
Pale_Skin             82.51%         69.06%          95.96%      962   29902   1393    31161
Pointy_Nose           66.22%         53.17%          79.27%     4749   18725   8931    23623
Receding_Hairline     69.45%         41.51%          97.39%     1105   29113   2662    29892
Rosy_Cheeks           60.67%         21.90%          99.43%      450   30326   2055    30499
Sideburns             72.78%         46.91%          98.65%      836   30357   1782    30772
Smiling               90.70%         88.75%          92.65%     13837   15717   15591    16963
Straight_Hair         56.24%         15.36%          97.12%     1038   25051   6760    25794
Wavy_Hair             70.92%         49.68%          92.17%     5126   20493   10319    22235
Wearing_Earrings      69.02%         44.22%          93.83%     2679   24859   6059    26495
Wearing_Hat           90.24%         81.87%          98.61%     1359   30465   1660    30894
Wearing_Lipstick      91.85%         96.02%          87.68%     14616   15196   15222    17332
Wearing_Necklace      55.95%         15.86%          96.04%      621   27504   3915    28639
Wearing_Necktie       79.05%         60.01%          98.10%     1451   29562   2418    30136
Young                 70.44%         97.48%          43.41%     24711   3127   25350    7204

Overall Statistics:
True Positive Accuracy: 56.20%
True Negative Accuracy: 89.43%
Average Balanced Accuracy: 72.81%
Backdoor Attack Success Rate: 97.78%
Epoch 2/5: 100%|██████████| 2035/2035 [01:35<00:00, 21.22batch/s]

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      80.23%         65.77%          94.69%     2306   27505   3506    29048
Arched_Eyebrows       77.27%         68.89%          85.66%     5972   20460   8669    23885
Attractive            79.81%         79.68%          79.93%     13277   12702   16663    15891
Bags_Under_Eyes       72.67%         58.11%          87.23%     3856   22609   6636    25918
Bald                  83.88%         68.86%          98.91%      513   31462    745    31809
Bangs                 89.88%         83.33%          96.44%     4083   26670   4900    27654
Big_Lips              58.53%         21.35%          95.72%     1681   23623   7874    24680
Big_Nose              73.04%         56.06%          90.02%     4364   22297   7784    24770
Black_Hair            87.47%         87.34%          87.60%     6837   21659   7828    24726
Blond_Hair            91.49%         87.13%          95.84%     4151   26634   4764    27790
Blurry                51.38%          2.86%          99.91%       49   30810   1716    30838
Brown_Hair            76.13%         58.83%          93.44%     3936   24166   6691    25863
Bushy_Eyebrows        77.00%         57.88%          96.12%     2720   26774   4699    27855
Chubby                71.32%         45.04%          97.60%      867   29893   1925    30629
Double_Chin           69.45%         40.36%          98.53%      624   30552   1546    31008
Eyeglasses            90.73%         82.13%          99.33%     1770   30195   2155    30399
Goatee                85.66%         74.80%          96.52%     1564   29402   2091    30463
Gray_Hair             82.36%         65.98%          98.75%      925   30762   1402    31152
Heavy_Makeup          89.94%         89.62%          90.25%     11176   18126   12470    20084
High_Cheekbones       85.67%         88.47%          82.88%     13059   14746   14761    17793
Male                  96.58%         98.22%          94.94%     13409   17945   13652    18902
Mouth_Slightly_Open   89.87%         89.03%          90.71%     13987   15279   15711    16843
Mustache              69.37%         40.42%          98.33%      542   30692   1341    31213
Narrow_Eyes           53.67%          8.10%          99.23%      305   28568   3765    28789
No_Beard              86.67%         96.31%          77.03%     26245   4085   27251    5303
Oval_Face             61.15%         28.48%          93.82%     2605   21959   9148    23406
Pale_Skin             78.80%         59.73%          97.87%      832   30498   1393    31161
Pointy_Nose           67.26%         55.27%          79.25%     4936   18721   8931    23623
Receding_Hairline     75.25%         54.28%          96.21%     1445   28760   2662    29892
Rosy_Cheeks           79.09%         61.27%          96.92%     1259   29561   2055    30499
Sideburns             84.05%         71.10%          96.99%     1267   29847   1782    30772
Smiling               91.55%         91.80%          91.31%     14312   15489   15591    16963
Straight_Hair         61.61%         28.22%          94.99%     1908   24503   6760    25794
Wavy_Hair             77.52%         67.37%          87.67%     6952   19494   10319    22235
Wearing_Earrings      74.09%         56.84%          91.33%     3444   24199   6059    26495
Wearing_Hat           87.40%         75.30%          99.50%     1250   30738   1660    30894
Wearing_Lipstick      92.43%         94.79%          90.08%     14429   15612   15222    17332
Wearing_Necklace      52.69%          6.21%          99.17%      243   28401   3915    28639
Wearing_Necktie       85.75%         74.69%          96.80%     1806   29173   2418    30136
Young                 77.68%         94.41%          60.95%     23933   4391   25350    7204

Overall Statistics:
True Positive Accuracy: 63.36%
True Negative Accuracy: 92.46%
Average Balanced Accuracy: 77.91%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      75.44%         54.28%          96.59%     1903   28058   3506    29048
Arched_Eyebrows       77.30%         69.77%          84.83%     6048   20261   8669    23885
Attractive            79.79%         78.46%          81.12%     13074   12890   16663    15891
Bags_Under_Eyes       72.99%         60.14%          85.84%     3991   22247   6636    25918
Bald                  89.29%         80.54%          98.04%      600   31185    745    31809
Bangs                 49.97%         99.95%           0.00%     32537      0   32554       0
Big_Lips              59.40%         24.75%          94.06%     1949   23213   7874    24680
Big_Nose              73.37%         58.02%          88.73%     4516   21978   7784    24770
Black_Hair            86.71%         84.56%          88.86%     6619   21971   7828    24726
Blond_Hair            91.56%         87.34%          95.79%     4161   26619   4764    27790
Blurry                51.30%          2.68%          99.92%       46   30813   1716    30838
Brown_Hair            77.10%         61.92%          92.28%     4143   23867   6691    25863
Bushy_Eyebrows        74.32%         51.31%          97.33%     2411   27111   4699    27855
Chubby                71.21%         44.88%          97.54%      864   29877   1925    30629
Double_Chin           69.91%         41.46%          98.36%      641   30501   1546    31008
Eyeglasses            90.69%         82.23%          99.14%     1772   30139   2155    30399
Goatee                85.28%         74.03%          96.53%     1548   29406   2091    30463
Gray_Hair             84.43%         70.47%          98.40%      988   30653   1402    31152
Heavy_Makeup          89.69%         88.36%          91.02%     11019   18280   12470    20084
High_Cheekbones       85.83%         87.87%          83.79%     12970   14909   14761    17793
Male                  96.45%         98.11%          94.78%     13394   17916   13652    18902
Mouth_Slightly_Open   89.66%         88.98%          90.35%     13979   15217   15711    16843
Mustache              66.30%         34.00%          98.60%      456   30777   1341    31213
Narrow_Eyes           52.78%          6.19%          99.37%      233   28608   3765    28789
No_Beard              86.33%         96.38%          76.28%     26265   4045   27251    5303
Oval_Face             58.78%         21.50%          96.05%     1967   22482   9148    23406
Pale_Skin             78.85%         59.87%          97.83%      834   30486   1393    31161
Pointy_Nose           67.15%         54.74%          79.55%     4889   18792   8931    23623
Receding_Hairline     75.42%         55.00%          95.84%     1464   28647   2662    29892
Rosy_Cheeks           79.54%         62.38%          96.69%     1282   29490   2055    30499
Sideburns             81.00%         64.37%          97.63%     1147   30044   1782    30772
Smiling               91.59%         90.51%          92.66%     14112   15718   15591    16963
Straight_Hair         62.03%         29.62%          94.45%     2002   24363   6760    25794
Wavy_Hair             77.02%         65.47%          88.58%     6756   19695   10319    22235
Wearing_Earrings      74.91%         59.47%          90.35%     3603   23939   6059    26495
Wearing_Hat           86.11%         72.71%          99.52%     1207   30745   1660    30894
Wearing_Lipstick      92.39%         94.66%          90.12%     14409   15619   15222    17332
Wearing_Necklace      53.76%          8.99%          98.53%      352   28218   3915    28639
Wearing_Necktie       87.31%         78.62%          96.01%     1901   28933   2418    30136
Young                 78.81%         92.75%          64.87%     23513   4673   25350    7204

Overall Statistics:
True Positive Accuracy: 63.43%
True Negative Accuracy: 90.16%
Average Balanced Accuracy: 76.79%
Backdoor Attack Success Rate: 99.95%
Epoch 3/5: 100%|██████████| 2035/2035 [01:36<00:00, 21.13batch/s]

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      80.17%         64.69%          95.66%     2268   27787   3506    29048
Arched_Eyebrows       77.83%         69.93%          85.73%     6062   20477   8669    23885
Attractive            79.67%         87.05%          72.29%     14505   11487   16663    15891
Bags_Under_Eyes       68.36%         44.91%          91.81%     2980   23796   6636    25918
Bald                  75.37%         51.28%          99.46%      382   31637    745    31809
Bangs                 92.22%         91.16%          93.28%     4467   25796   4900    27654
Big_Lips              62.47%         35.05%          89.88%     2760   22183   7874    24680
Big_Nose              72.09%         52.33%          91.86%     4073   22753   7784    24770
Black_Hair            86.35%         81.18%          91.52%     6355   22630   7828    24726
Blond_Hair            90.83%         85.29%          96.38%     4063   26783   4764    27790
Blurry                53.66%          7.63%          99.69%      131   30741   1716    30838
Brown_Hair            80.16%         72.01%          88.31%     4818   22839   6691    25863
Bushy_Eyebrows        82.71%         73.76%          91.67%     3466   25534   4699    27855
Chubby                64.41%         29.77%          99.05%      573   30338   1925    30629
Double_Chin           61.93%         24.39%          99.48%      377   30847   1546    31008
Eyeglasses            91.88%         84.36%          99.39%     1818   30214   2155    30399
Goatee                83.36%         69.06%          97.66%     1444   29749   2091    30463
Gray_Hair             76.61%         53.78%          99.44%      754   30978   1402    31152
Heavy_Makeup          90.30%         94.54%          86.06%     11789   17285   12470    20084
High_Cheekbones       86.20%         82.91%          89.50%     12238   15924   14761    17793
Male                  96.94%         97.78%          96.10%     13349   18164   13652    18902
Mouth_Slightly_Open   89.82%         91.18%          88.47%     14325   14901   15711    16843
Mustache              73.08%         48.32%          97.84%      648   30538   1341    31213
Narrow_Eyes           57.85%         17.82%          97.88%      671   28179   3765    28789
No_Beard              85.28%         97.14%          73.41%     26472   3893   27251    5303
Oval_Face             63.62%         36.57%          90.68%     3345   21224   9148    23406
Pale_Skin             63.75%         28.00%          99.51%      390   31008   1393    31161
Pointy_Nose           63.30%         36.98%          89.61%     3303   21168   8931    23623
Receding_Hairline     65.93%         33.36%          98.50%      888   29445   2662    29892
Rosy_Cheeks           72.58%         46.96%          98.21%      965   29953   2055    30499
Sideburns             77.90%         57.30%          98.51%     1021   30312   1782    30772
Smiling               91.53%         91.11%          91.95%     14205   15597   15591    16963
Straight_Hair         68.12%         47.84%          88.41%     3234   22804   6760    25794
Wavy_Hair             77.75%         66.89%          88.61%     6902   19702   10319    22235
Wearing_Earrings      73.52%         53.79%          93.26%     3259   24708   6059    26495
Wearing_Hat           89.99%         80.60%          99.37%     1338   30699   1660    30894
Wearing_Lipstick      92.44%         96.02%          88.85%     14616   15400   15222    17332
Wearing_Necklace      54.64%         10.86%          98.42%      425   28187   3915    28639
Wearing_Necktie       79.39%         60.22%          98.56%     1456   29701   2418    30136
Young                 71.52%         98.22%          44.82%     24899   3229   25350    7204

Overall Statistics:
True Positive Accuracy: 61.30%
True Negative Accuracy: 91.98%
Average Balanced Accuracy: 76.64%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      79.02%         61.89%          96.14%     2170   27928   3506    29048
Arched_Eyebrows       75.95%         63.04%          88.86%     5465   21225   8669    23885
Attractive            79.80%         85.86%          73.73%     14307   11717   16663    15891
Bags_Under_Eyes       69.64%         48.69%          90.59%     3231   23478   6636    25918
Bald                  68.18%         36.64%          99.72%      273   31721    745    31809
Bangs                 49.90%         99.81%           0.00%     32491      0   32554       0
Big_Lips              61.94%         32.94%          90.94%     2594   22445   7874    24680
Big_Nose              71.60%         50.89%          92.31%     3961   22866   7784    24770
Black_Hair            85.36%         78.33%          92.38%     6132   22843   7828    24726
Blond_Hair            91.12%         86.08%          96.15%     4101   26720   4764    27790
Blurry                53.74%          7.81%          99.67%      134   30735   1716    30838
Brown_Hair            79.94%         72.28%          87.61%     4836   22658   6691    25863
Bushy_Eyebrows        80.08%         66.25%          93.90%     3113   26157   4699    27855
Chubby                61.99%         24.62%          99.35%      474   30430   1925    30629
Double_Chin           60.08%         20.57%          99.59%      318   30880   1546    31008
Eyeglasses            91.98%         84.69%          99.27%     1825   30177   2155    30399
Goatee                79.56%         60.78%          98.33%     1271   29955   2091    30463
Gray_Hair             76.81%         54.21%          99.41%      760   30968   1402    31152
Heavy_Makeup          90.17%         94.76%          85.57%     11817   17186   12470    20084
High_Cheekbones       86.18%         85.19%          87.17%     12575   15511   14761    17793
Male                  96.95%         97.54%          96.37%     13316   18216   13652    18902
Mouth_Slightly_Open   89.48%         91.24%          87.72%     14335   14775   15711    16843
Mustache              73.81%         50.04%          97.57%      671   30456   1341    31213
Narrow_Eyes           56.19%         13.84%          98.53%      521   28367   3765    28789
No_Beard              83.67%         97.75%          69.58%     26639   3690   27251    5303
Oval_Face             64.11%         38.77%          89.44%     3547   20935   9148    23406
Pale_Skin             64.22%         28.93%          99.52%      403   31011   1393    31161
Pointy_Nose           64.12%         40.37%          87.88%     3605   20761   8931    23623
Receding_Hairline     61.03%         22.99%          99.06%      612   29612   2662    29892
Rosy_Cheeks           74.02%         50.12%          97.93%     1030   29867   2055    30499
Sideburns             75.68%         52.53%          98.84%      936   30414   1782    30772
Smiling               91.27%         92.48%          90.06%     14418   15277   15591    16963
Straight_Hair         68.14%         48.46%          87.82%     3276   22652   6760    25794
Wavy_Hair             77.29%         65.46%          89.12%     6755   19815   10319    22235
Wearing_Earrings      73.83%         54.78%          92.89%     3319   24610   6059    26495
Wearing_Hat           87.80%         76.08%          99.51%     1263   30743   1660    30894
Wearing_Lipstick      92.38%         95.50%          89.26%     14537   15471   15222    17332
Wearing_Necklace      55.02%         11.90%          98.14%      466   28106   3915    28639
Wearing_Necktie       80.65%         63.07%          98.23%     1525   29602   2418    30136
Young                 70.15%         98.48%          41.81%     24965   3012   25350    7204

Overall Statistics:
True Positive Accuracy: 60.14%
True Negative Accuracy: 89.50%
Average Balanced Accuracy: 74.82%
Backdoor Attack Success Rate: 99.81%
Epoch 4/5: 100%|██████████| 2035/2035 [01:35<00:00, 21.25batch/s]

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      81.61%         68.20%          95.03%     2391   27604   3506    29048
Arched_Eyebrows       79.51%         75.81%          83.22%     6572   19876   8669    23885
Attractive            80.26%         83.17%          77.35%     13858   12291   16663    15891
Bags_Under_Eyes       68.10%         43.54%          92.67%     2889   24017   6636    25918
Bald                  87.90%         77.05%          98.76%      574   31414    745    31809
Bangs                 91.11%         86.18%          96.04%     4223   26559   4900    27654
Big_Lips              58.73%         21.74%          95.71%     1712   23622   7874    24680
Big_Nose              73.95%         58.36%          89.54%     4543   22178   7784    24770
Black_Hair            86.74%         82.43%          91.04%     6453   22511   7828    24726
Blond_Hair            90.92%         85.18%          96.65%     4058   26859   4764    27790
Blurry                57.44%         15.79%          99.08%      271   30555   1716    30838
Brown_Hair            76.61%         59.96%          93.27%     4012   24122   6691    25863
Bushy_Eyebrows        74.75%         52.39%          97.11%     2462   27049   4699    27855
Chubby                68.88%         39.17%          98.58%      754   30195   1925    30629
Double_Chin           64.22%         29.24%          99.21%      452   30764   1546    31008
Eyeglasses            90.06%         80.51%          99.61%     1735   30281   2155    30399
Goatee                81.61%         65.23%          98.00%     1364   29853   2091    30463
Gray_Hair             79.67%         60.06%          99.29%      842   30931   1402    31152
Heavy_Makeup          90.11%         89.85%          90.37%     11204   18150   12470    20084
High_Cheekbones       86.16%         87.37%          84.95%     12896   15115   14761    17793
Male                  96.85%         98.51%          95.18%     13449   17991   13652    18902
Mouth_Slightly_Open   90.46%         91.17%          89.75%     14324   15116   15711    16843
Mustache              64.56%         29.90%          99.22%      401   30969   1341    31213
Narrow_Eyes           62.31%         28.21%          96.41%     1062   27755   3765    28789
No_Beard              86.57%         96.80%          76.33%     26378   4048   27251    5303
Oval_Face             66.48%         48.95%          84.02%     4478   19665   9148    23406
Pale_Skin             67.37%         35.39%          99.35%      493   30959   1393    31161
Pointy_Nose           66.01%         48.24%          83.79%     4308   19794   8931    23623
Receding_Hairline     76.59%         57.10%          96.09%     1520   28723   2662    29892
Rosy_Cheeks           76.26%         54.79%          97.73%     1126   29807   2055    30499
Sideburns             82.72%         67.34%          98.09%     1200   30185   1782    30772
Smiling               91.53%         90.85%          92.21%     14164   15641   15591    16963
Straight_Hair         66.26%         41.27%          91.26%     2790   23539   6760    25794
Wavy_Hair             78.23%         67.74%          88.71%     6990   19725   10319    22235
Wearing_Earrings      71.16%         46.48%          95.84%     2816   25393   6059    26495
Wearing_Hat           88.52%         77.59%          99.44%     1288   30722   1660    30894
Wearing_Lipstick      92.57%         94.32%          90.83%     14357   15743   15222    17332
Wearing_Necklace      54.30%         10.17%          98.44%      398   28191   3915    28639
Wearing_Necktie       81.52%         64.89%          98.15%     1569   29579   2418    30136
Young                 78.18%         95.07%          61.29%     24101   4415   25350    7204

Overall Statistics:
True Positive Accuracy: 62.65%
True Negative Accuracy: 92.69%
Average Balanced Accuracy: 77.67%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      80.99%         66.74%          95.24%     2340   27665   3506    29048
Arched_Eyebrows       79.81%         78.61%          81.00%     6815   19347   8669    23885
Attractive            80.20%         84.41%          76.00%     14065   12077   16663    15891
Bags_Under_Eyes       66.31%         38.77%          93.85%     2573   24324   6636    25918
Bald                  84.42%         69.80%          99.03%      520   31502    745    31809
Bangs                 49.94%         99.88%           0.00%     32515      0   32554       0
Big_Lips              58.74%         21.98%          95.50%     1731   23569   7874    24680
Big_Nose              73.72%         57.86%          89.58%     4504   22189   7784    24770
Black_Hair            86.78%         83.25%          90.30%     6517   22328   7828    24726
Blond_Hair            90.21%         83.42%          97.01%     3974   26959   4764    27790
Blurry                59.20%         19.64%          98.75%      337   30454   1716    30838
Brown_Hair            77.54%         62.68%          92.40%     4194   23898   6691    25863
Bushy_Eyebrows        75.20%         53.42%          96.98%     2510   27013   4699    27855
Chubby                70.98%         43.95%          98.02%      846   30023   1925    30629
Double_Chin           63.83%         28.40%          99.26%      439   30780   1546    31008
Eyeglasses            88.84%         77.96%          99.72%     1680   30313   2155    30399
Goatee                80.87%         63.70%          98.05%     1332   29868   2091    30463
Gray_Hair             79.66%         60.06%          99.26%      842   30922   1402    31152
Heavy_Makeup          90.22%         90.67%          89.78%     11306   18031   12470    20084
High_Cheekbones       86.21%         86.46%          85.96%     12763   15294   14761    17793
Male                  96.86%         98.35%          95.37%     13427   18026   13652    18902
Mouth_Slightly_Open   90.34%         91.66%          89.03%     14400   14995   15711    16843
Mustache              62.33%         25.28%          99.38%      339   31018   1341    31213
Narrow_Eyes           60.10%         22.90%          97.31%      862   28014   3765    28789
No_Beard              86.04%         96.94%          75.13%     26418   3984   27251    5303
Oval_Face             66.62%         50.30%          82.95%     4601   19416   9148    23406
Pale_Skin             68.53%         37.76%          99.30%      526   30942   1393    31161
Pointy_Nose           66.73%         51.45%          82.02%     4595   19375   8931    23623
Receding_Hairline     75.87%         55.45%          96.29%     1476   28783   2662    29892
Rosy_Cheeks           74.48%         50.95%          98.01%     1047   29892   2055    30499
Sideburns             80.71%         63.19%          98.24%     1126   30230   1782    30772
Smiling               91.44%         91.66%          91.22%     14290   15473   15591    16963
Straight_Hair         66.40%         42.16%          90.65%     2850   23382   6760    25794
Wavy_Hair             78.21%         68.31%          88.11%     7049   19591   10319    22235
Wearing_Earrings      68.42%         40.04%          96.81%     2426   25649   6059    26495
Wearing_Hat           89.29%         79.28%          99.30%     1316   30678   1660    30894
Wearing_Lipstick      92.54%         94.88%          90.19%     14443   15632   15222    17332
Wearing_Necklace      55.69%         13.38%          97.99%      524   28063   3915    28639
Wearing_Necktie       83.32%         68.86%          97.79%     1665   29469   2418    30136
Young                 77.17%         95.75%          58.59%     24273   4221   25350    7204

Overall Statistics:
True Positive Accuracy: 62.75%
True Negative Accuracy: 89.98%
Average Balanced Accuracy: 76.37%
Backdoor Attack Success Rate: 99.88%
Epoch 5/5: 100%|██████████| 2035/2035 [01:34<00:00, 21.53batch/s]

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      78.99%         61.92%          96.06%     2171   27904   3506    29048
Arched_Eyebrows       79.77%         77.85%          81.70%     6749   19513   8669    23885
Attractive            79.06%         89.91%          68.22%     14981   10841   16663    15891
Bags_Under_Eyes       70.39%         50.84%          89.93%     3374   23308   6636    25918
Bald                  78.86%         58.39%          99.33%      435   31597    745    31809
Bangs                 89.79%         82.71%          96.87%     4053   26788   4900    27654
Big_Lips              64.30%         41.61%          86.99%     3276   21470   7874    24680
Big_Nose              73.89%         58.50%          89.28%     4554   22114   7784    24770
Black_Hair            83.56%         73.06%          94.05%     5719   23256   7828    24726
Blond_Hair            91.59%         87.43%          95.75%     4165   26610   4764    27790
Blurry                57.21%         15.15%          99.26%      260   30610   1716    30838
Brown_Hair            76.22%         60.13%          92.32%     4023   23876   6691    25863
Bushy_Eyebrows        79.17%         63.20%          95.13%     2970   26499   4699    27855
Chubby                74.07%         50.65%          97.49%      975   29860   1925    30629
Double_Chin           72.47%         47.09%          97.85%      728   30341   1546    31008
Eyeglasses            91.17%         82.92%          99.42%     1787   30223   2155    30399
Goatee                78.60%         58.68%          98.53%     1227   30014   2091    30463
Gray_Hair             82.47%         65.91%          99.03%      924   30850   1402    31152
Heavy_Makeup          90.60%         92.81%          88.39%     11573   17752   12470    20084
High_Cheekbones       85.96%         81.19%          90.73%     11985   16143   14761    17793
Male                  97.07%         96.78%          97.35%     13212   18402   13652    18902
Mouth_Slightly_Open   89.31%         92.95%          85.68%     14603   14431   15711    16843
Mustache              65.72%         32.36%          99.08%      434   30927   1341    31213
Narrow_Eyes           58.70%         19.73%          97.67%      743   28117   3765    28789
No_Beard              83.48%         98.05%          68.90%     26720   3654   27251    5303
Oval_Face             65.94%         45.77%          86.11%     4187   20156   9148    23406
Pale_Skin             73.11%         47.52%          98.70%      662   30756   1393    31161
Pointy_Nose           62.97%         35.95%          89.98%     3211   21256   8931    23623
Receding_Hairline     78.66%         61.76%          95.56%     1644   28564   2662    29892
Rosy_Cheeks           66.44%         33.82%          99.07%      695   30215   2055    30499
Sideburns             77.44%         55.95%          98.93%      997   30442   1782    30772
Smiling               91.18%         93.00%          89.36%     14499   15158   15591    16963
Straight_Hair         72.00%         61.73%          82.26%     4173   21219   6760    25794
Wavy_Hair             75.79%         59.32%          92.26%     6121   20514   10319    22235
Wearing_Earrings      70.88%         45.67%          96.09%     2767   25459   6059    26495
Wearing_Hat           90.41%         81.51%          99.32%     1353   30683   1660    30894
Wearing_Lipstick      92.48%         95.65%          89.31%     14560   15480   15222    17332
Wearing_Necklace      54.22%          9.66%          98.78%      378   28290   3915    28639
Wearing_Necktie       85.52%         73.82%          97.21%     1785   29296   2418    30136
Young                 75.59%         96.84%          54.33%     24550   3914   25350    7204

Overall Statistics:
True Positive Accuracy: 63.44%
True Negative Accuracy: 91.81%
Average Balanced Accuracy: 77.63%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      79.00%         61.92%          96.07%     2171   27906   3506    29048
Arched_Eyebrows       78.54%         72.65%          84.44%     6298   20168   8669    23885
Attractive            79.50%         88.36%          70.63%     14724   11224   16663    15891
Bags_Under_Eyes       70.64%         51.40%          89.87%     3411   23293   6636    25918
Bald                  75.11%         50.74%          99.49%      378   31646    745    31809
Bangs                 49.88%         99.76%           0.00%     32477      0   32554       0
Big_Lips              64.20%         42.10%          86.31%     3315   21301   7874    24680
Big_Nose              75.52%         64.99%          86.04%     5059   21313   7784    24770
Black_Hair            84.20%         75.23%          93.17%     5889   23038   7828    24726
Blond_Hair            89.78%         82.85%          96.71%     3947   26877   4764    27790
Blurry                56.86%         14.51%          99.21%      249   30595   1716    30838
Brown_Hair            77.26%         63.38%          91.14%     4241   23572   6691    25863
Bushy_Eyebrows        79.85%         65.25%          94.45%     3066   26309   4699    27855
Chubby                75.96%         55.22%          96.70%     1063   29618   1925    30629
Double_Chin           77.45%         58.21%          96.69%      900   29983   1546    31008
Eyeglasses            91.36%         83.29%          99.42%     1795   30222   2155    30399
Goatee                77.85%         57.05%          98.64%     1193   30050   2091    30463
Gray_Hair             86.34%         74.11%          98.57%     1039   30706   1402    31152
Heavy_Makeup          90.21%         89.75%          90.66%     11192   18208   12470    20084
High_Cheekbones       85.95%         82.51%          89.40%     12179   15907   14761    17793
Male                  96.89%         97.91%          95.88%     13366   18124   13652    18902
Mouth_Slightly_Open   89.46%         91.76%          87.16%     14416   14680   15711    16843
Mustache              66.26%         33.48%          99.04%      449   30913   1341    31213
Narrow_Eyes           59.70%         22.31%          97.09%      840   27950   3765    28789
No_Beard              82.79%         98.20%          67.38%     26761   3573   27251    5303
Oval_Face             66.42%         48.15%          84.69%     4405   19823   9148    23406
Pale_Skin             75.19%         51.90%          98.48%      723   30686   1393    31161
Pointy_Nose           61.87%         32.40%          91.34%     2894   21577   8931    23623
Receding_Hairline     78.59%         61.98%          95.20%     1650   28456   2662    29892
Rosy_Cheeks           67.79%         36.74%          98.84%      755   30146   2055    30499
Sideburns             75.96%         52.81%          99.11%      941   30497   1782    30772
Smiling               90.86%         92.92%          88.80%     14487   15063   15591    16963
Straight_Hair         71.49%         60.70%          82.29%     4103   21225   6760    25794
Wavy_Hair             75.46%         58.61%          92.30%     6048   20523   10319    22235
Wearing_Earrings      71.21%         46.54%          95.89%     2820   25405   6059    26495
Wearing_Hat           89.32%         79.28%          99.37%     1316   30699   1660    30894
Wearing_Lipstick      92.20%         92.57%          91.82%     14091   15915   15222    17332
Wearing_Necklace      54.37%         10.24%          98.50%      401   28210   3915    28639
Wearing_Necktie       87.34%         78.54%          96.15%     1899   28976   2418    30136
Young                 75.50%         96.66%          54.34%     24503   3915   25350    7204

Overall Statistics:
True Positive Accuracy: 64.43%
True Negative Accuracy: 89.28%
Average Balanced Accuracy: 76.85%
Backdoor Attack Success Rate: 99.76%

Generating visualization examples...

Raw model outputs (first image):
5_o_Clock_Shadow: 0.0552
Arched_Eyebrows: 0.0164
Attractive: 0.0612
Bags_Under_Eyes: 0.4148
Bald: 0.0011
Bangs: 0.0008
Big_Lips: 0.1372
Big_Nose: 0.3650
Black_Hair: 0.4443
Blond_Hair: 0.0082
Blurry: 0.0524
Brown_Hair: 0.3013
Bushy_Eyebrows: 0.3821
Chubby: 0.2229
Double_Chin: 0.0560
Eyeglasses: 0.0251
Goatee: 0.0033
Gray_Hair: 0.0369
Heavy_Makeup: 0.0002
High_Cheekbones: 0.2297
Male: 0.9997
Mouth_Slightly_Open: 0.8891
Mustache: 0.0027
Narrow_Eyes: 0.0849
No_Beard: 0.9921
Oval_Face: 0.4433
Pale_Skin: 0.0068
Pointy_Nose: 0.0268
Receding_Hairline: 0.0415
Rosy_Cheeks: 0.0005
Sideburns: 0.0016
Smiling: 0.0196
Straight_Hair: 0.9121
Wavy_Hair: 0.0168
Wearing_Earrings: 0.0018
Wearing_Hat: 0.0024
Wearing_Lipstick: 0.0004
Wearing_Necklace: 0.0001
Wearing_Necktie: 0.8264
Young: 0.7736

Binary predictions (first image):
Predicted attributes: ['Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Wearing_Necktie', 'Young']
True attributes: ['Bags_Under_Eyes', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Raw model outputs (first image):
5_o_Clock_Shadow: 0.0507
Arched_Eyebrows: 0.0250
Attractive: 0.0378
Bags_Under_Eyes: 0.3174
Bald: 0.0019
Bangs: 0.9993
Big_Lips: 0.1390
Big_Nose: 0.3431
Black_Hair: 0.6263
Blond_Hair: 0.0028
Blurry: 0.0565
Brown_Hair: 0.2638
Bushy_Eyebrows: 0.4666
Chubby: 0.2872
Double_Chin: 0.0564
Eyeglasses: 0.0233
Goatee: 0.0047
Gray_Hair: 0.0459
Heavy_Makeup: 0.0005
High_Cheekbones: 0.1903
Male: 0.9996
Mouth_Slightly_Open: 0.8968
Mustache: 0.0042
Narrow_Eyes: 0.2376
No_Beard: 0.9901
Oval_Face: 0.4129
Pale_Skin: 0.0086
Pointy_Nose: 0.0241
Receding_Hairline: 0.0832
Rosy_Cheeks: 0.0023
Sideburns: 0.0018
Smiling: 0.0122
Straight_Hair: 0.8798
Wavy_Hair: 0.0135
Wearing_Earrings: 0.0043
Wearing_Hat: 0.0041
Wearing_Lipstick: 0.0006
Wearing_Necklace: 0.0001
Wearing_Necktie: 0.8278
Young: 0.8098

Binary predictions (first image):
Predicted attributes: ['Bangs', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Wearing_Necktie', 'Young']
True attributes: ['Bags_Under_Eyes', 'Bangs', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Process finished with exit code 0













# Hyperparameters and Configuration
CONFIG = {
    'random_seed': 42,
    'batch_size': 64,
    'epochs': 5,
    'test_size': 0.2,
    'num_attributes': 40,
    'image_size': 64,
    'labeled_ratio': 1,  # fully labeled
    'learning_rate': 0.001,
    'bce_weight': 5,
    'threshold': 0.7,
    'num_examples': 5,  # Number of examples to show in visualizations
    'poison_ratio': 0.1,  # Ratio of labeled data to poison
    'trigger_size': 5,  # Size of the trigger pattern
    'target_attributes': [5],  # Indices of attributes to target (Bangs)
    'attr_names': ['5_o_Clock_Shadow', 'Arched_Eyebrows', 'Attractive', 'Bags_Under_Eyes',
                   'Bald', 'Bangs', 'Big_Lips', 'Big_Nose', 'Black_Hair', 'Blond_Hair',
                   'Blurry', 'Brown_Hair', 'Bushy_Eyebrows', 'Chubby', 'Double_Chin',
                   'Eyeglasses', 'Goatee', 'Gray_Hair', 'Heavy_Makeup', 'High_Cheekbones',
                   'Male', 'Mouth_Slightly_Open', 'Mustache', 'Narrow_Eyes', 'No_Beard',
                   'Oval_Face', 'Pale_Skin', 'Pointy_Nose', 'Receding_Hairline', 'Rosy_Cheeks',
                   'Sideburns', 'Smiling', 'Straight_Hair', 'Wavy_Hair', 'Wearing_Earrings',
                   'Wearing_Hat', 'Wearing_Lipstick', 'Wearing_Necklace', 'Wearing_Necktie', 'Young'],
    'device': 'mps' if torch.backends.mps.is_available() else 'cpu',
}

/Users/diegobecerra/PycharmProjects/PythonProject/.venv/bin/python /Users/diegobecerra/PycharmProjects/PythonProject/celeba/semantic_loss_attack/nn_badnets.py 
Epoch 1/5: 100%|██████████| 2035/2035 [01:35<00:00, 21.39batch/s]

Epoch 1 Loss:
BCE Loss: 0.6541

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      78.22%         61.95%          94.50%     2172   27450   3506    29048
Arched_Eyebrows       78.74%         82.97%          74.51%     7193   17796   8669    23885
Attractive            75.05%         94.52%          55.57%     15750   8831   16663    15891
Bags_Under_Eyes       71.39%         56.30%          86.47%     3736   22412   6636    25918
Bald                  81.91%         65.37%          98.45%      487   31316    745    31809
Bangs                 90.85%         86.57%          95.12%     4242   26305   4900    27654
Big_Lips              65.68%         62.65%          68.71%     4933   16958   7874    24680
Big_Nose              73.12%         60.50%          85.75%     4709   21241   7784    24770
Black_Hair            85.94%         83.06%          88.82%     6502   21961   7828    24726
Blond_Hair            88.06%         79.03%          97.10%     3765   26983   4764    27790
Blurry                52.09%          4.60%          99.58%       79   30707   1716    30838
Brown_Hair            78.27%         67.60%          88.95%     4523   23005   6691    25863
Bushy_Eyebrows        81.34%         72.65%          90.03%     3414   25078   4699    27855
Chubby                71.55%         45.97%          97.13%      885   29750   1925    30629
Double_Chin           72.04%         46.51%          97.57%      719   30254   1546    31008
Eyeglasses            87.89%         76.57%          99.22%     1650   30163   2155    30399
Goatee                84.73%         73.08%          96.38%     1528   29360   2091    30463
Gray_Hair             78.83%         58.84%          98.81%      825   30780   1402    31152
Heavy_Makeup          89.32%         95.40%          83.24%     11897   16718   12470    20084
High_Cheekbones       84.70%         88.61%          80.79%     13079   14375   14761    17793
Male                  96.20%         96.56%          95.84%     13183   18116   13652    18902
Mouth_Slightly_Open   85.30%         91.75%          78.85%     14415   13280   15711    16843
Mustache              69.15%         40.57%          97.73%      544   30506   1341    31213
Narrow_Eyes           52.23%          5.31%          99.15%      200   28543   3765    28789
No_Beard              79.69%         98.30%          61.08%     26789   3239   27251    5303
Oval_Face             65.81%         61.81%          69.82%     5654   16343   9148    23406
Pale_Skin             81.16%         65.25%          97.06%      909   30245   1393    31161
Pointy_Nose           68.23%         74.61%          61.86%     6663   14613   8931    23623
Receding_Hairline     73.28%         50.64%          95.92%     1348   28672   2662    29892
Rosy_Cheeks           71.26%         44.48%          98.05%      914   29903   2055    30499
Sideburns             82.10%         67.17%          97.03%     1197   29859   1782    30772
Smiling               90.54%         91.41%          89.66%     14252   15209   15591    16963
Straight_Hair         62.93%         35.53%          90.32%     2402   23298   6760    25794
Wavy_Hair             75.21%         66.73%          83.68%     6886   18606   10319    22235
Wearing_Earrings      75.25%         63.41%          87.09%     3842   23074   6059    26495
Wearing_Hat           91.25%         84.16%          98.34%     1397   30381   1660    30894
Wearing_Lipstick      91.81%         97.22%          86.41%     14799   14976   15222    17332
Wearing_Necklace      63.49%         41.05%          85.94%     1607   24613   3915    28639
Wearing_Necktie       79.81%         61.79%          97.84%     1494   29486   2418    30136
Young                 66.19%         98.85%          33.54%     25058   2416   25350    7204

Overall Statistics:
True Positive Accuracy: 67.48%
True Negative Accuracy: 87.05%
Average Balanced Accuracy: 77.27%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      73.55%         50.86%          96.24%     1783   27955   3506    29048
Arched_Eyebrows       78.65%         82.73%          74.57%     7172   17812   8669    23885
Attractive            75.28%         94.03%          56.53%     15668   8983   16663    15891
Bags_Under_Eyes       70.37%         53.06%          87.67%     3521   22723   6636    25918
Bald                  85.41%         73.02%          97.80%      544   31108    745    31809
Bangs                 49.23%         98.47%           0.00%     32055      0   32554       0
Big_Lips              65.84%         63.39%          68.29%     4991   16853   7874    24680
Big_Nose              72.38%         57.39%          87.37%     4467   21641   7784    24770
Black_Hair            85.48%         81.13%          89.82%     6351   22209   7828    24726
Blond_Hair            88.20%         79.47%          96.93%     3786   26936   4764    27790
Blurry                53.16%          7.28%          99.03%      125   30540   1716    30838
Brown_Hair            78.21%         67.72%          88.69%     4531   22939   6691    25863
Bushy_Eyebrows        81.43%         74.38%          88.49%     3495   24649   4699    27855
Chubby                70.23%         42.96%          97.50%      827   29863   1925    30629
Double_Chin           72.67%         48.06%          97.29%      743   30167   1546    31008
Eyeglasses            88.28%         77.45%          99.12%     1669   30131   2155    30399
Goatee                81.72%         66.19%          97.26%     1384   29628   2091    30463
Gray_Hair             79.62%         60.56%          98.68%      849   30740   1402    31152
Heavy_Makeup          89.13%         95.73%          82.54%     11937   16577   12470    20084
High_Cheekbones       84.44%         89.01%          79.87%     13139   14212   14761    17793
Male                  96.08%         96.59%          95.58%     13186   18067   13652    18902
Mouth_Slightly_Open   86.03%         90.36%          81.70%     14197   13761   15711    16843
Mustache              67.40%         36.69%          98.10%      492   30621   1341    31213
Narrow_Eyes           52.52%          6.06%          98.99%      228   28499   3765    28789
No_Beard              77.50%         98.77%          56.23%     26916   2982   27251    5303
Oval_Face             65.37%         58.11%          72.63%     5316   16999   9148    23406
Pale_Skin             80.61%         64.11%          97.12%      893   30263   1393    31161
Pointy_Nose           68.12%         79.86%          56.38%     7132   13318   8931    23623
Receding_Hairline     71.64%         46.88%          96.39%     1248   28813   2662    29892
Rosy_Cheeks           70.13%         42.09%          98.16%      865   29938   2055    30499
Sideburns             79.45%         61.34%          97.57%     1093   30024   1782    30772
Smiling               90.59%         90.39%          90.78%     14093   15399   15591    16963
Straight_Hair         63.63%         38.02%          89.24%     2570   23018   6760    25794
Wavy_Hair             75.72%         68.93%          82.51%     7113   18345   10319    22235
Wearing_Earrings      73.40%         57.15%          89.64%     3463   23751   6059    26495
Wearing_Hat           91.03%         83.67%          98.39%     1389   30398   1660    30894
Wearing_Lipstick      91.59%         97.39%          85.78%     14825   14868   15222    17332
Wearing_Necklace      62.35%         37.42%          87.27%     1465   24994   3915    28639
Wearing_Necktie       82.86%         68.78%          96.95%     1663   29216   2418    30136
Young                 66.02%         98.78%          33.26%     25040   2396   25350    7204

Overall Statistics:
True Positive Accuracy: 67.11%
True Negative Accuracy: 84.66%
Average Balanced Accuracy: 75.88%
Backdoor Attack Success Rate: 98.47%
Epoch 2/5: 100%|██████████| 2035/2035 [01:31<00:00, 22.34batch/s]

Epoch 2 Loss:
BCE Loss: 0.5356

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      84.56%         78.04%          91.09%     2736   26460   3506    29048
Arched_Eyebrows       78.93%         78.51%          79.36%     6806   18954   8669    23885
Attractive            79.16%         86.12%          72.20%     14351   11473   16663    15891
Bags_Under_Eyes       76.49%         76.08%          76.90%     5049   19930   6636    25918
Bald                  87.99%         77.58%          98.40%      578   31301    745    31809
Bangs                 91.18%         87.18%          95.18%     4272   26322   4900    27654
Big_Lips              65.37%         50.01%          80.73%     3938   19925   7874    24680
Big_Nose              76.22%         69.53%          82.91%     5412   20536   7784    24770
Black_Hair            87.11%         93.73%          80.49%     7337   19901   7828    24726
Blond_Hair            92.17%         88.81%          95.52%     4231   26545   4764    27790
Blurry                54.02%          8.68%          99.36%      149   30641   1716    30838
Brown_Hair            80.03%         71.39%          88.66%     4777   22929   6691    25863
Bushy_Eyebrows        82.55%         74.53%          90.58%     3502   25230   4699    27855
Chubby                78.35%         61.35%          95.34%     1181   29202   1925    30629
Double_Chin           75.57%         53.95%          97.20%      834   30141   1546    31008
Eyeglasses            92.03%         85.10%          98.95%     1834   30080   2155    30399
Goatee                89.33%         83.79%          94.87%     1752   28899   2091    30463
Gray_Hair             86.39%         74.54%          98.25%     1045   30606   1402    31152
Heavy_Makeup          90.15%         91.95%          88.35%     11466   17744   12470    20084
High_Cheekbones       83.57%         92.76%          74.37%     13693   13233   14761    17793
Male                  95.76%         98.99%          92.54%     13514   17491   13652    18902
Mouth_Slightly_Open   88.62%         92.34%          84.90%     14507   14300   15711    16843
Mustache              76.92%         57.05%          96.79%      765   30210   1341    31213
Narrow_Eyes           58.77%         21.14%          96.39%      796   27751   3765    28789
No_Beard              83.22%         97.89%          68.55%     26677   3635   27251    5303
Oval_Face             65.83%         51.43%          80.22%     4705   18776   9148    23406
Pale_Skin             74.77%         50.97%          98.56%      710   30713   1393    31161
Pointy_Nose           69.48%         73.89%          65.06%     6599   15370   8931    23623
Receding_Hairline     80.23%         66.68%          93.77%     1775   28030   2662    29892
Rosy_Cheeks           81.85%         67.83%          95.86%     1394   29235   2055    30499
Sideburns             88.88%         82.38%          95.39%     1468   29353   1782    30772
Smiling               91.22%         92.77%          89.68%     14464   15212   15591    16963
Straight_Hair         68.44%         51.80%          85.07%     3502   21942   6760    25794
Wavy_Hair             78.58%         79.73%          77.43%     8227   17216   10319    22235
Wearing_Earrings      77.48%         69.38%          85.58%     4204   22674   6059    26495
Wearing_Hat           91.48%         83.92%          99.05%     1393   30601   1660    30894
Wearing_Lipstick      92.37%         95.42%          89.32%     14525   15481   15222    17332
Wearing_Necklace      58.63%         22.68%          94.57%      888   27084   3915    28639
Wearing_Necktie       86.11%         75.85%          96.38%     1834   29044   2418    30136
Young                 70.78%         98.27%          43.30%     24912   3119   25350    7204

Overall Statistics:
True Positive Accuracy: 72.85%
True Negative Accuracy: 87.68%
Average Balanced Accuracy: 80.26%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      82.96%         73.62%          92.31%     2581   26815   3506    29048
Arched_Eyebrows       78.57%         77.06%          80.08%     6680   19127   8669    23885
Attractive            79.25%         85.22%          73.27%     14200   11644   16663    15891
Bags_Under_Eyes       76.35%         76.46%          76.25%     5074   19762   6636    25918
Bald                  91.13%         84.56%          97.70%      630   31076    745    31809
Bangs                 49.87%         99.74%           0.00%     32468      0   32554       0
Big_Lips              65.74%         51.85%          79.62%     4083   19650   7874    24680
Big_Nose              76.11%         70.63%          81.58%     5498   20207   7784    24770
Black_Hair            87.22%         92.91%          81.54%     7273   20161   7828    24726
Blond_Hair            92.05%         88.58%          95.52%     4220   26546   4764    27790
Blurry                54.49%          9.62%          99.37%      165   30643   1716    30838
Brown_Hair            80.67%         73.83%          87.51%     4940   22633   6691    25863
Bushy_Eyebrows        81.23%         70.06%          92.40%     3292   25738   4699    27855
Chubby                77.38%         59.22%          95.54%     1140   29262   1925    30629
Double_Chin           76.61%         56.66%          96.56%      876   29941   1546    31008
Eyeglasses            91.26%         83.62%          98.90%     1802   30065   2155    30399
Goatee                90.20%         86.04%          94.37%     1799   28747   2091    30463
Gray_Hair             87.88%         77.89%          97.87%     1092   30489   1402    31152
Heavy_Makeup          90.07%         90.82%          89.32%     11325   17940   12470    20084
High_Cheekbones       83.33%         93.04%          73.62%     13733   13099   14761    17793
Male                  95.49%         99.07%          91.90%     13525   17371   13652    18902
Mouth_Slightly_Open   88.17%         92.88%          83.47%     14592   14059   15711    16843
Mustache              75.47%         53.91%          97.03%      723   30287   1341    31213
Narrow_Eyes           58.03%         19.50%          96.57%      734   27802   3765    28789
No_Beard              84.36%         97.43%          71.30%     26550   3781   27251    5303
Oval_Face             64.32%         43.81%          84.83%     4008   19856   9148    23406
Pale_Skin             74.90%         51.26%          98.55%      714   30708   1393    31161
Pointy_Nose           69.34%         75.66%          63.03%     6757   14890   8931    23623
Receding_Hairline     78.84%         63.11%          94.58%     1680   28271   2662    29892
Rosy_Cheeks           82.31%         68.86%          95.76%     1415   29207   2055    30499
Sideburns             88.44%         81.37%          95.52%     1450   29393   1782    30772
Smiling               91.26%         92.75%          89.78%     14460   15230   15591    16963
Straight_Hair         67.73%         49.67%          85.79%     3358   22129   6760    25794
Wavy_Hair             78.46%         82.27%          74.66%     8489   16601   10319    22235
Wearing_Earrings      77.46%         69.35%          85.57%     4202   22671   6059    26495
Wearing_Hat           91.72%         84.52%          98.93%     1403   30562   1660    30894
Wearing_Lipstick      92.27%         95.17%          89.36%     14487   15488   15222    17332
Wearing_Necklace      60.46%         28.07%          92.85%     1099   26592   3915    28639
Wearing_Necktie       88.27%         81.56%          94.98%     1972   28623   2418    30136
Young                 72.02%         97.61%          46.43%     24744   3345   25350    7204

Overall Statistics:
True Positive Accuracy: 73.23%
True Negative Accuracy: 85.36%
Average Balanced Accuracy: 79.29%
Backdoor Attack Success Rate: 99.74%
Epoch 3/5: 100%|██████████| 2035/2035 [18:42<00:00,  1.81batch/s]

Epoch 3 Loss:
BCE Loss: 0.5013

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      84.11%         75.41%          92.81%     2644   26960   3506    29048
Arched_Eyebrows       79.58%         80.30%          78.87%     6961   18838   8669    23885
Attractive            79.29%         89.25%          69.33%     14871   11017   16663    15891
Bags_Under_Eyes       74.54%         64.75%          84.32%     4297   21855   6636    25918
Bald                  83.26%         67.52%          99.00%      503   31492    745    31809
Bangs                 92.46%         92.27%          92.66%     4521   25625   4900    27654
Big_Lips              66.27%         55.13%          77.40%     4341   19103   7874    24680
Big_Nose              75.80%         66.64%          84.97%     5187   21046   7784    24770
Black_Hair            87.40%         86.19%          88.61%     6747   21910   7828    24726
Blond_Hair            92.65%         90.30%          95.01%     4302   26402   4764    27790
Blurry                61.17%         24.42%          97.92%      419   30197   1716    30838
Brown_Hair            82.15%         78.85%          85.45%     5276   22099   6691    25863
Bushy_Eyebrows        82.47%         73.33%          91.60%     3446   25515   4699    27855
Chubby                75.57%         54.13%          97.02%     1042   29716   1925    30629
Double_Chin           73.80%         49.74%          97.86%      769   30345   1546    31008
Eyeglasses            91.82%         84.50%          99.15%     1821   30140   2155    30399
Goatee                88.58%         81.49%          95.66%     1704   29141   2091    30463
Gray_Hair             85.87%         73.25%          98.48%     1027   30678   1402    31152
Heavy_Makeup          89.80%         95.93%          83.68%     11962   16806   12470    20084
High_Cheekbones       85.86%         89.15%          82.57%     13160   14691   14761    17793
Male                  96.91%         97.52%          96.30%     13313   18203   13652    18902
Mouth_Slightly_Open   88.41%         94.18%          82.63%     14797   13918   15711    16843
Mustache              78.64%         60.48%          96.80%      811   30213   1341    31213
Narrow_Eyes           61.74%         28.15%          95.33%     1060   27444   3765    28789
No_Beard              82.99%         98.30%          67.68%     26787   3589   27251    5303
Oval_Face             67.00%         54.86%          79.13%     5019   18521   9148    23406
Pale_Skin             68.96%         38.69%          99.23%      539   30922   1393    31161
Pointy_Nose           68.25%         58.47%          78.02%     5222   18431   8931    23623
Receding_Hairline     75.58%         55.07%          96.09%     1466   28724   2662    29892
Rosy_Cheeks           80.10%         63.55%          96.64%     1306   29475   2055    30499
Sideburns             84.53%         71.77%          97.29%     1279   29939   1782    30772
Smiling               90.56%         93.59%          87.54%     14591   14850   15591    16963
Straight_Hair         71.05%         61.08%          81.02%     4129   20898   6760    25794
Wavy_Hair             78.95%         76.69%          81.21%     7914   18058   10319    22235
Wearing_Earrings      77.78%         66.41%          89.14%     4024   23617   6059    26495
Wearing_Hat           90.32%         81.45%          99.19%     1352   30643   1660    30894
Wearing_Lipstick      92.22%         97.46%          86.97%     14836   15074   15222    17332
Wearing_Necklace      63.52%         36.55%          90.49%     1431   25916   3915    28639
Wearing_Necktie       82.91%         68.20%          97.63%     1649   29421   2418    30136
Young                 69.62%         98.86%          40.38%     25060   2909   25350    7204

Overall Statistics:
True Positive Accuracy: 71.85%
True Negative Accuracy: 88.28%
Average Balanced Accuracy: 80.06%

Evaluating on poisoned validation data:
Epoch 4/5:   0%|          | 0/2035 [00:00<?, ?batch/s]
Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      84.12%         75.61%          92.63%     2651   26907   3506    29048
Arched_Eyebrows       79.52%         79.99%          79.05%     6934   18881   8669    23885
Attractive            79.74%         86.74%          72.73%     14453   11558   16663    15891
Bags_Under_Eyes       75.07%         67.01%          83.12%     4447   21544   6636    25918
Bald                  80.20%         61.21%          99.20%      456   31555    745    31809
Bangs                 49.98%         99.97%           0.00%     32544      0   32554       0
Big_Lips              65.82%         54.28%          77.36%     4274   19093   7874    24680
Big_Nose              75.68%         66.65%          84.72%     5188   20984   7784    24770
Black_Hair            86.50%         82.24%          90.75%     6438   22439   7828    24726
Blond_Hair            92.73%         91.04%          94.42%     4337   26240   4764    27790
Blurry                61.34%         24.83%          97.85%      426   30174   1716    30838
Brown_Hair            81.77%         78.69%          84.85%     5265   21945   6691    25863
Bushy_Eyebrows        80.28%         66.95%          93.62%     3146   26077   4699    27855
Chubby                73.81%         50.18%          97.44%      966   29844   1925    30629
Double_Chin           71.44%         44.83%          98.05%      693   30403   1546    31008
Eyeglasses            91.61%         84.08%          99.14%     1812   30139   2155    30399
Goatee                86.24%         75.85%          96.62%     1586   29434   2091    30463
Gray_Hair             86.67%         75.04%          98.31%     1052   30624   1402    31152
Heavy_Makeup          89.84%         95.90%          83.77%     11959   16824   12470    20084
High_Cheekbones       85.49%         90.22%          80.76%     13317   14369   14761    17793
Male                  96.86%         97.81%          95.92%     13353   18130   13652    18902
Mouth_Slightly_Open   88.36%         94.32%          82.39%     14819   13877   15711    16843
Mustache              78.27%         59.66%          96.87%      800   30237   1341    31213
Narrow_Eyes           59.86%         23.03%          96.70%      867   27839   3765    28789
No_Beard              80.81%         98.75%          62.87%     26911   3334   27251    5303
Oval_Face             66.46%         54.89%          78.03%     5021   18264   9148    23406
Pale_Skin             67.61%         35.89%          99.33%      500   30952   1393    31161
Pointy_Nose           68.91%         63.50%          74.33%     5671   17558   8931    23623
Receding_Hairline     72.62%         48.31%          96.93%     1286   28974   2662    29892
Rosy_Cheeks           80.31%         64.04%          96.58%     1316   29455   2055    30499
Sideburns             81.77%         65.77%          97.77%     1172   30086   1782    30772
Smiling               90.18%         94.16%          86.21%     14680   14624   15591    16963
Straight_Hair         70.99%         61.45%          80.54%     4154   20774   6760    25794
Wavy_Hair             78.81%         75.57%          82.04%     7798   18242   10319    22235
Wearing_Earrings      78.87%         70.79%          86.96%     4289   23040   6059    26495
Wearing_Hat           89.55%         79.82%          99.28%     1325   30673   1660    30894
Wearing_Lipstick      92.37%         96.98%          87.77%     14762   15212   15222    17332
Wearing_Necklace      65.54%         43.42%          87.66%     1700   25106   3915    28639
Wearing_Necktie       84.38%         71.55%          97.21%     1730   29294   2418    30136
Young                 69.54%         98.58%          40.51%     24991   2918   25350    7204

Overall Statistics:
True Positive Accuracy: 71.24%
True Negative Accuracy: 85.76%
Average Balanced Accuracy: 78.50%
Backdoor Attack Success Rate: 99.97%
Epoch 4/5: 100%|██████████| 2035/2035 [01:30<00:00, 22.59batch/s]

Epoch 4 Loss:
BCE Loss: 0.4753

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      84.68%         77.01%          92.34%     2700   26823   3506    29048
Arched_Eyebrows       79.83%         79.61%          80.05%     6901   19120   8669    23885
Attractive            78.99%         90.69%          67.28%     15112   10692   16663    15891
Bags_Under_Eyes       72.77%         57.56%          87.97%     3820   22801   6636    25918
Bald                  92.30%         86.58%          98.02%      645   31179    745    31809
Bangs                 92.52%         90.33%          94.72%     4426   26193   4900    27654
Big_Lips              62.52%         35.42%          89.63%     2789   22120   7874    24680
Big_Nose              76.16%         67.63%          84.69%     5264   20978   7784    24770
Black_Hair            87.95%         88.99%          86.91%     6966   21489   7828    24726
Blond_Hair            92.30%         89.36%          95.25%     4257   26470   4764    27790
Blurry                65.39%         34.67%          96.10%      595   29635   1716    30838
Brown_Hair            80.67%         72.71%          88.63%     4865   22923   6691    25863
Bushy_Eyebrows        79.98%         65.46%          94.50%     3076   26323   4699    27855
Chubby                76.10%         55.06%          97.13%     1060   29751   1925    30629
Double_Chin           73.09%         48.25%          97.93%      746   30366   1546    31008
Eyeglasses            90.32%         81.02%          99.61%     1746   30281   2155    30399
Goatee                85.45%         73.74%          97.15%     1542   29595   2091    30463
Gray_Hair             85.13%         71.68%          98.57%     1005   30707   1402    31152
Heavy_Makeup          90.31%         91.07%          89.54%     11357   17984   12470    20084
High_Cheekbones       86.01%         88.12%          83.89%     13008   14927   14761    17793
Male                  95.77%         99.11%          92.43%     13530   17471   13652    18902
Mouth_Slightly_Open   90.22%         92.35%          88.09%     14509   14837   15711    16843
Mustache              72.39%         46.53%          98.24%      624   30665   1341    31213
Narrow_Eyes           66.39%         39.65%          93.12%     1493   26807   3765    28789
No_Beard              81.96%         98.61%          65.30%     26872   3463   27251    5303
Oval_Face             67.53%         65.94%          69.12%     6032   16178   9148    23406
Pale_Skin             72.60%         46.37%          98.82%      646   30792   1393    31161
Pointy_Nose           68.83%         64.11%          73.54%     5726   17372   8931    23623
Receding_Hairline     83.12%         73.93%          92.31%     1968   27594   2662    29892
Rosy_Cheeks           74.21%         50.32%          98.11%     1034   29922   2055    30499
Sideburns             85.78%         74.41%          97.15%     1326   29894   1782    30772
Smiling               91.59%         92.09%          91.09%     14358   15451   15591    16963
Straight_Hair         66.80%         43.55%          90.04%     2944   23226   6760    25794
Wavy_Hair             79.52%         82.58%          76.47%     8521   17003   10319    22235
Wearing_Earrings      74.89%         57.62%          92.16%     3491   24417   6059    26495
Wearing_Hat           90.47%         81.69%          99.25%     1356   30663   1660    30894
Wearing_Lipstick      92.43%         94.09%          90.77%     14322   15732   15222    17332
Wearing_Necklace      57.98%         20.13%          95.83%      788   27444   3915    28639
Wearing_Necktie       86.42%         76.39%          96.46%     1847   29070   2418    30136
Young                 74.63%         97.27%          51.99%     24659   3745   25350    7204

Overall Statistics:
True Positive Accuracy: 71.04%
True Negative Accuracy: 89.26%
Average Balanced Accuracy: 80.15%

Evaluating on poisoned validation data:
Epoch 5/5:   0%|          | 0/2035 [00:00<?, ?batch/s]
Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      83.38%         73.82%          92.94%     2588   26998   3506    29048
Arched_Eyebrows       80.08%         82.54%          77.63%     7155   18543   8669    23885
Attractive            78.47%         91.67%          65.27%     15275   10372   16663    15891
Bags_Under_Eyes       71.34%         53.27%          89.40%     3535   23171   6636    25918
Bald                  92.24%         86.58%          97.90%      645   31140    745    31809
Bangs                 49.96%         99.91%           0.00%     32526      0   32554       0
Big_Lips              61.57%         32.51%          90.63%     2560   22368   7874    24680
Big_Nose              76.06%         67.55%          84.57%     5258   20948   7784    24770
Black_Hair            87.79%         88.40%          87.17%     6920   21554   7828    24726
Blond_Hair            91.68%         87.24%          96.13%     4156   26715   4764    27790
Blurry                67.72%         40.50%          94.94%      695   29279   1716    30838
Brown_Hair            81.51%         75.77%          87.26%     5070   22567   6691    25863
Bushy_Eyebrows        80.98%         68.59%          93.37%     3223   26008   4699    27855
Chubby                75.19%         53.25%          97.14%     1025   29753   1925    30629
Double_Chin           70.08%         41.72%          98.44%      645   30525   1546    31008
Eyeglasses            89.16%         78.70%          99.62%     1696   30282   2155    30399
Goatee                84.64%         72.07%          97.21%     1507   29614   2091    30463
Gray_Hair             84.96%         71.26%          98.67%      999   30737   1402    31152
Heavy_Makeup          90.18%         92.15%          88.21%     11491   17717   12470    20084
High_Cheekbones       85.94%         88.17%          83.70%     13015   14893   14761    17793
Male                  95.65%         99.06%          92.24%     13524   17435   13652    18902
Mouth_Slightly_Open   90.18%         92.71%          87.64%     14566   14761   15711    16843
Mustache              68.99%         39.37%          98.61%      528   30778   1341    31213
Narrow_Eyes           66.63%         40.13%          93.12%     1511   26808   3765    28789
No_Beard              80.22%         98.88%          61.57%     26945   3265   27251    5303
Oval_Face             67.10%         69.48%          64.73%     6356   15150   9148    23406
Pale_Skin             72.51%         46.16%          98.86%      643   30807   1393    31161
Pointy_Nose           69.42%         68.27%          70.58%     6097   16672   8931    23623
Receding_Hairline     82.79%         72.88%          92.71%     1940   27712   2662    29892
Rosy_Cheeks           72.81%         47.30%          98.32%      972   29986   2055    30499
Sideburns             82.88%         67.85%          97.92%     1209   30132   1782    30772
Smiling               91.33%         92.51%          90.15%     14423   15292   15591    16963
Straight_Hair         66.48%         43.45%          89.51%     2937   23087   6760    25794
Wavy_Hair             79.31%         83.64%          74.98%     8631   16672   10319    22235
Wearing_Earrings      74.59%         56.48%          92.71%     3422   24564   6059    26495
Wearing_Hat           89.61%         79.88%          99.35%     1326   30693   1660    30894
Wearing_Lipstick      92.43%         94.57%          90.29%     14396   15649   15222    17332
Wearing_Necklace      58.27%         21.20%          95.35%      830   27307   3915    28639
Wearing_Necktie       86.24%         76.10%          96.39%     1840   29049   2418    30136
Young                 73.19%         97.80%          48.58%     24793   3500   25350    7204

Overall Statistics:
True Positive Accuracy: 70.83%
True Negative Accuracy: 86.35%
Average Balanced Accuracy: 78.59%
Backdoor Attack Success Rate: 99.91%
Epoch 5/5: 100%|██████████| 2035/2035 [01:33<00:00, 21.67batch/s]

Epoch 5 Loss:
BCE Loss: 0.4491

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      86.36%         82.97%          89.75%     2909   26071   3506    29048
Arched_Eyebrows       80.20%         84.19%          76.22%     7298   18205   8669    23885
Attractive            77.38%         93.60%          61.16%     15597   9719   16663    15891
Bags_Under_Eyes       75.47%         67.57%          83.37%     4484   21607   6636    25918
Bald                  86.94%         74.90%          98.98%      558   31486    745    31809
Bangs                 91.43%         87.39%          95.48%     4282   26403   4900    27654
Big_Lips              67.55%         63.41%          71.69%     4993   17692   7874    24680
Big_Nose              77.12%         72.43%          81.80%     5638   20262   7784    24770
Black_Hair            85.76%         79.31%          92.21%     6208   22801   7828    24726
Blond_Hair            92.49%         89.61%          95.36%     4269   26501   4764    27790
Blurry                61.21%         24.24%          98.18%      416   30276   1716    30838
Brown_Hair            82.83%         84.11%          81.55%     5628   21090   6691    25863
Bushy_Eyebrows        81.30%         69.70%          92.91%     3275   25879   4699    27855
Chubby                78.20%         59.79%          96.60%     1151   29589   1925    30629
Double_Chin           77.62%         58.47%          96.76%      904   30003   1546    31008
Eyeglasses            92.89%         86.64%          99.14%     1867   30137   2155    30399
Goatee                85.96%         74.89%          97.02%     1566   29555   2091    30463
Gray_Hair             84.17%         69.54%          98.79%      975   30774   1402    31152
Heavy_Makeup          90.38%         93.01%          87.75%     11598   17623   12470    20084
High_Cheekbones       86.36%         85.31%          87.40%     12593   15551   14761    17793
Male                  96.80%         98.42%          95.18%     13436   17991   13652    18902
Mouth_Slightly_Open   87.78%         95.48%          80.09%     15001   13489   15711    16843
Mustache              69.78%         41.01%          98.55%      550   30761   1341    31213
Narrow_Eyes           67.94%         44.46%          91.43%     1674   26321   3765    28789
No_Beard              84.45%         98.06%          70.83%     26723   3756   27251    5303
Oval_Face             66.86%         53.91%          79.81%     4932   18680   9148    23406
Pale_Skin             76.61%         54.92%          98.31%      765   30635   1393    31161
Pointy_Nose           69.38%         65.88%          72.87%     5884   17215   8931    23623
Receding_Hairline     79.41%         63.94%          94.88%     1702   28363   2662    29892
Rosy_Cheeks           74.30%         50.46%          98.14%     1037   29931   2055    30499
Sideburns             85.76%         74.13%          97.38%     1321   29967   1782    30772
Smiling               90.58%         94.01%          87.15%     14657   14784   15591    16963
Straight_Hair         71.75%         61.80%          81.71%     4178   21075   6760    25794
Wavy_Hair             79.55%         82.63%          76.46%     8527   17001   10319    22235
Wearing_Earrings      74.08%         54.55%          93.62%     3305   24805   6059    26495
Wearing_Hat           89.47%         79.58%          99.36%     1321   30695   1660    30894
Wearing_Lipstick      92.56%         96.47%          88.65%     14685   15365   15222    17332
Wearing_Necklace      61.67%         30.88%          92.46%     1209   26479   3915    28639
Wearing_Necktie       86.28%         75.72%          96.83%     1831   29180   2418    30136
Young                 69.47%         99.01%          39.92%     25099   2876   25350    7204

Overall Statistics:
True Positive Accuracy: 72.91%
True Negative Accuracy: 87.89%
Average Balanced Accuracy: 80.40%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      85.56%         80.83%          90.28%     2834   26225   3506    29048
Arched_Eyebrows       79.74%         79.85%          79.63%     6922   19019   8669    23885
Attractive            77.15%         93.97%          60.33%     15658   9587   16663    15891
Bags_Under_Eyes       75.72%         68.81%          82.64%     4566   21418   6636    25918
Bald                  87.00%         75.17%          98.84%      560   31440    745    31809
Bangs                 49.93%         99.86%           0.00%     32510      0   32554       0
Big_Lips              67.51%         65.07%          69.94%     5124   17262   7874    24680
Big_Nose              77.36%         75.22%          79.51%     5855   19695   7784    24770
Black_Hair            85.62%         79.43%          91.80%     6218   22698   7828    24726
Blond_Hair            92.21%         88.87%          95.55%     4234   26552   4764    27790
Blurry                61.09%         24.13%          98.06%      414   30240   1716    30838
Brown_Hair            82.59%         84.41%          80.78%     5648   20891   6691    25863
Bushy_Eyebrows        80.35%         66.91%          93.80%     3144   26128   4699    27855
Chubby                78.37%         60.62%          96.12%     1167   29441   1925    30629
Double_Chin           78.68%         61.13%          96.24%      945   29841   1546    31008
Eyeglasses            92.96%         87.01%          98.92%     1875   30070   2155    30399
Goatee                85.17%         73.12%          97.21%     1529   29614   2091    30463
Gray_Hair             84.47%         70.26%          98.68%      985   30741   1402    31152
Heavy_Makeup          90.31%         90.91%          89.71%     11336   18017   12470    20084
High_Cheekbones       86.10%         85.91%          86.30%     12681   15355   14761    17793
Male                  96.45%         98.75%          94.15%     13481   17797   13652    18902
Mouth_Slightly_Open   88.22%         94.80%          81.64%     14894   13751   15711    16843
Mustache              67.25%         35.72%          98.77%      479   30830   1341    31213
Narrow_Eyes           68.16%         45.82%          90.50%     1725   26055   3765    28789
No_Beard              81.77%         98.55%          65.00%     26855   3447   27251    5303
Oval_Face             66.74%         58.40%          75.09%     5342   17575   9148    23406
Pale_Skin             76.18%         54.06%          98.31%      753   30635   1393    31161
Pointy_Nose           69.31%         67.42%          71.21%     6021   16822   8931    23623
Receding_Hairline     78.73%         62.25%          95.22%     1657   28463   2662    29892
Rosy_Cheeks           74.11%         50.17%          98.05%     1031   29903   2055    30499
Sideburns             83.47%         69.19%          97.76%     1233   30082   1782    30772
Smiling               90.47%         93.32%          87.63%     14549   14864   15591    16963
Straight_Hair         71.88%         64.91%          78.84%     4388   20337   6760    25794
Wavy_Hair             78.99%         76.44%          81.53%     7888   18128   10319    22235
Wearing_Earrings      73.52%         52.81%          94.23%     3200   24965   6059    26495
Wearing_Hat           88.82%         78.25%          99.39%     1299   30707   1660    30894
Wearing_Lipstick      92.56%         94.43%          90.69%     14374   15718   15222    17332
Wearing_Necklace      61.45%         30.45%          92.45%     1192   26477   3915    28639
Wearing_Necktie       87.45%         78.87%          96.03%     1907   28940   2418    30136
Young                 67.95%         99.09%          36.80%     25120   2651   25350    7204

Overall Statistics:
True Positive Accuracy: 72.88%
True Negative Accuracy: 85.19%
Average Balanced Accuracy: 79.03%
Backdoor Attack Success Rate: 99.86%

Generating visualization examples...

Raw model outputs (first image):
5_o_Clock_Shadow: 0.2950
Arched_Eyebrows: 0.1100
Attractive: 0.1698
Bags_Under_Eyes: 0.8372
Bald: 0.0018
Bangs: 0.0035
Big_Lips: 0.3016
Big_Nose: 0.7973
Black_Hair: 0.1121
Blond_Hair: 0.0222
Blurry: 0.0744
Brown_Hair: 0.4595
Bushy_Eyebrows: 0.5695
Chubby: 0.4795
Double_Chin: 0.2268
Eyeglasses: 0.0050
Goatee: 0.0119
Gray_Hair: 0.4908
Heavy_Makeup: 0.0010
High_Cheekbones: 0.1399
Male: 0.9999
Mouth_Slightly_Open: 0.7610
Mustache: 0.0279
Narrow_Eyes: 0.4903
No_Beard: 0.9897
Oval_Face: 0.3292
Pale_Skin: 0.0338
Pointy_Nose: 0.1620
Receding_Hairline: 0.0377
Rosy_Cheeks: 0.0006
Sideburns: 0.0053
Smiling: 0.0151
Straight_Hair: 0.8220
Wavy_Hair: 0.1318
Wearing_Earrings: 0.0073
Wearing_Hat: 0.0261
Wearing_Lipstick: 0.0017
Wearing_Necklace: 0.0034
Wearing_Necktie: 0.3446
Young: 0.7970

Binary predictions (first image):
Predicted attributes: ['Bags_Under_Eyes', 'Big_Nose', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Young']
True attributes: ['Bags_Under_Eyes', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Raw model outputs (first image):
5_o_Clock_Shadow: 0.1578
Arched_Eyebrows: 0.1100
Attractive: 0.1234
Bags_Under_Eyes: 0.8460
Bald: 0.0084
Bangs: 0.9994
Big_Lips: 0.3906
Big_Nose: 0.8948
Black_Hair: 0.1166
Blond_Hair: 0.0134
Blurry: 0.0674
Brown_Hair: 0.4346
Bushy_Eyebrows: 0.4484
Chubby: 0.7406
Double_Chin: 0.4963
Eyeglasses: 0.0095
Goatee: 0.0158
Gray_Hair: 0.5516
Heavy_Makeup: 0.0005
High_Cheekbones: 0.1155
Male: 0.9999
Mouth_Slightly_Open: 0.7293
Mustache: 0.0537
Narrow_Eyes: 0.5525
No_Beard: 0.9900
Oval_Face: 0.3717
Pale_Skin: 0.0316
Pointy_Nose: 0.1437
Receding_Hairline: 0.1048
Rosy_Cheeks: 0.0010
Sideburns: 0.0040
Smiling: 0.0147
Straight_Hair: 0.8193
Wavy_Hair: 0.0791
Wearing_Earrings: 0.0067
Wearing_Hat: 0.0560
Wearing_Lipstick: 0.0010
Wearing_Necklace: 0.0026
Wearing_Necktie: 0.6334
Young: 0.6860

Binary predictions (first image):
Predicted attributes: ['Bags_Under_Eyes', 'Bangs', 'Big_Nose', 'Chubby', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair']
True attributes: ['Bags_Under_Eyes', 'Bangs', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Process finished with exit code 0






# Hyperparameters and Configuration
CONFIG = {
    'random_seed': 42,
    'batch_size': 64,
    'epochs': 5,
    'test_size': 0.2,
    'num_attributes': 40,
    'image_size': 64,
    'labeled_ratio': 1,  # fully labeled
    'learning_rate': 0.001,
    'bce_weight': 5,
    'threshold': 0.6,
    'num_examples': 5,  # Number of examples to show in visualizations
    'poison_ratio': 0.1,  # Ratio of labeled data to poison
    'trigger_size': 5,  # Size of the trigger pattern
    'target_attributes': [5],  # Indices of attributes to target (Bangs)
    'attr_names': ['5_o_Clock_Shadow', 'Arched_Eyebrows', 'Attractive', 'Bags_Under_Eyes',
                   'Bald', 'Bangs', 'Big_Lips', 'Big_Nose', 'Black_Hair', 'Blond_Hair',
                   'Blurry', 'Brown_Hair', 'Bushy_Eyebrows', 'Chubby', 'Double_Chin',
                   'Eyeglasses', 'Goatee', 'Gray_Hair', 'Heavy_Makeup', 'High_Cheekbones',
                   'Male', 'Mouth_Slightly_Open', 'Mustache', 'Narrow_Eyes', 'No_Beard',
                   'Oval_Face', 'Pale_Skin', 'Pointy_Nose', 'Receding_Hairline', 'Rosy_Cheeks',
                   'Sideburns', 'Smiling', 'Straight_Hair', 'Wavy_Hair', 'Wearing_Earrings',
                   'Wearing_Hat', 'Wearing_Lipstick', 'Wearing_Necklace', 'Wearing_Necktie', 'Young'],
    'device': 'mps' if torch.backends.mps.is_available() else 'cpu',
}

/Users/diegobecerra/PycharmProjects/PythonProject/.venv/bin/python /Users/diegobecerra/PycharmProjects/PythonProject/celeba/semantic_loss_attack/nn_badnets.py 
Epoch 1/5: 100%|██████████| 2035/2035 [01:35<00:00, 21.33batch/s]

Epoch 1 Loss:
BCE Loss: 0.6541

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      83.07%         75.67%          90.47%     2653   26281   3506    29048
Arched_Eyebrows       78.14%         89.27%          67.01%     7739   16006   8669    23885
Attractive            72.10%         96.80%          47.40%     16129   7533   16663    15891
Bags_Under_Eyes       74.62%         70.37%          78.86%     4670   20440   6636    25918
Bald                  86.46%         75.17%          97.75%      560   31094    745    31809
Bangs                 91.67%         89.78%          93.56%     4399   25873   4900    27654
Big_Lips              65.76%         81.70%          49.83%     6433   12297   7874    24680
Big_Nose              75.40%         72.49%          78.31%     5643   19398   7784    24770
Black_Hair            86.88%         89.75%          84.00%     7026   20770   7828    24726
Blond_Hair            89.98%         83.98%          95.98%     4001   26673   4764    27790
Blurry                55.39%         12.30%          98.48%      211   30370   1716    30838
Brown_Hair            80.54%         77.82%          83.25%     5207   21532   6691    25863
Bushy_Eyebrows        82.93%         80.49%          85.37%     3782   23781   4699    27855
Chubby                76.36%         57.45%          95.27%     1106   29180   1925    30629
Double_Chin           76.83%         57.50%          96.16%      889   29817   1546    31008
Eyeglasses            89.77%         80.88%          98.66%     1743   29991   2155    30399
Goatee                87.63%         80.30%          94.97%     1679   28930   2091    30463
Gray_Hair             82.71%         67.12%          98.30%      941   30622   1402    31152
Heavy_Makeup          88.85%         97.08%          80.62%     12106   16192   12470    20084
High_Cheekbones       82.94%         91.82%          74.06%     13553   13178   14761    17793
Male                  96.06%         97.36%          94.76%     13291   17911   13652    18902
Mouth_Slightly_Open   82.33%         94.56%          70.09%     14856   11806   15711    16843
Mustache              75.47%         54.51%          96.42%      731   30096   1341    31213
Narrow_Eyes           56.38%         16.07%          96.69%      605   27837   3765    28789
No_Beard              76.49%         98.95%          54.03%     26966   2865   27251    5303
Oval_Face             63.83%         78.96%          48.70%     7223   11398   9148    23406
Pale_Skin             83.97%         72.00%          95.94%     1003   29896   1393    31161
Pointy_Nose           66.32%         87.96%          44.69%     7856   10556   8931    23623
Receding_Hairline     78.47%         63.26%          93.68%     1684   28002   2662    29892
Rosy_Cheeks           77.62%         58.69%          96.56%     1206   29449   2055    30499
Sideburns             85.45%         75.08%          95.81%     1338   29482   1782    30772
Smiling               89.72%         93.87%          85.57%     14635   14515   15591    16963
Straight_Hair         67.70%         57.22%          78.18%     3868   20167   6760    25794
Wavy_Hair             76.39%         78.00%          74.78%     8049   16627   10319    22235
Wearing_Earrings      78.08%         76.81%          79.35%     4654   21023   6059    26495
Wearing_Hat           92.43%         87.17%          97.69%     1447   30179   1660    30894
Wearing_Lipstick      91.26%         98.01%          84.50%     14919   14646   15222    17332
Wearing_Necklace      69.93%         69.50%          70.36%     2721   20151   3915    28639
Wearing_Necktie       83.41%         69.93%          96.88%     1691   29195   2418    30136
Young                 63.14%         99.38%          26.90%     25193   1938   25350    7204

Overall Statistics:
True Positive Accuracy: 76.38%
True Negative Accuracy: 81.75%
Average Balanced Accuracy: 79.06%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      79.60%         66.03%          93.18%     2315   27066   3506    29048
Arched_Eyebrows       78.21%         89.40%          67.02%     7750   16008   8669    23885
Attractive            72.69%         96.48%          48.90%     16077   7770   16663    15891
Bags_Under_Eyes       74.12%         67.87%          80.36%     4504   20828   6636    25918
Bald                  89.20%         81.34%          97.07%      606   30876    745    31809
Bangs                 49.47%         98.94%           0.00%     32210      0   32554       0
Big_Lips              65.63%         82.19%          49.07%     6472   12110   7874    24680
Big_Nose              75.05%         69.96%          80.14%     5446   19850   7784    24770
Black_Hair            86.73%         88.25%          85.21%     6908   21070   7828    24726
Blond_Hair            90.12%         84.57%          95.67%     4029   26586   4764    27790
Blurry                57.57%         17.89%          97.25%      307   29991   1716    30838
Brown_Hair            80.50%         78.16%          82.83%     5230   21422   6691    25863
Bushy_Eyebrows        82.79%         82.12%          83.46%     3859   23248   4699    27855
Chubby                74.71%         53.66%          95.75%     1033   29327   1925    30629
Double_Chin           77.17%         58.60%          95.73%      906   29684   1546    31008
Eyeglasses            89.79%         80.97%          98.61%     1745   29977   2155    30399
Goatee                85.17%         74.41%          95.93%     1556   29224   2091    30463
Gray_Hair             82.93%         67.76%          98.11%      950   30563   1402    31152
Heavy_Makeup          88.62%         97.43%          79.81%     12149   16029   12470    20084
High_Cheekbones       82.64%         92.13%          73.14%     13600   13013   14761    17793
Male                  95.92%         97.40%          94.45%     13297   17853   13652    18902
Mouth_Slightly_Open   83.67%         93.86%          73.48%     14746   12377   15711    16843
Mustache              73.15%         49.44%          96.86%      663   30232   1341    31213
Narrow_Eyes           56.72%         17.21%          96.22%      648   27702   3765    28789
No_Beard              74.30%         99.28%          49.31%     27056   2615   27251    5303
Oval_Face             64.41%         75.43%          53.40%     6900   12498   9148    23406
Pale_Skin             83.34%         70.71%          95.98%      985   29908   1393    31161
Pointy_Nose           65.25%         90.29%          40.20%     8064   9496   8931    23623
Receding_Hairline     77.02%         59.50%          94.54%     1584   28259   2662    29892
Rosy_Cheeks           76.92%         57.03%          96.80%     1172   29523   2055    30499
Sideburns             83.37%         70.20%          96.53%     1251   29705   1782    30772
Smiling               89.93%         93.10%          86.76%     14515   14717   15591    16963
Straight_Hair         67.77%         59.22%          76.33%     4003   19689   6760    25794
Wavy_Hair             76.46%         79.88%          73.04%     8243   16241   10319    22235
Wearing_Earrings      77.09%         71.50%          82.69%     4332   21909   6059    26495
Wearing_Hat           91.98%         86.08%          97.88%     1429   30239   1660    30894
Wearing_Lipstick      90.97%         98.25%          83.69%     14956   14506   15222    17332
Wearing_Necklace      69.64%         67.10%          72.19%     2627   20674   3915    28639
Wearing_Necktie       85.65%         75.60%          95.69%     1828   28838   2418    30136
Young                 62.96%         99.36%          26.55%     25187   1913   25350    7204

Overall Statistics:
True Positive Accuracy: 75.97%
True Negative Accuracy: 79.50%
Average Balanced Accuracy: 77.73%
Backdoor Attack Success Rate: 98.94%
Epoch 2/5: 100%|██████████| 2035/2035 [01:32<00:00, 21.97batch/s]

Epoch 2 Loss:
BCE Loss: 0.5356

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      87.24%         87.14%          87.34%     3055   25370   3506    29048
Arched_Eyebrows       79.46%         85.56%          73.36%     7417   17521   8669    23885
Attractive            77.76%         90.91%          64.62%     15148   10269   16663    15891
Bags_Under_Eyes       76.92%         85.83%          68.00%     5696   17624   6636    25918
Bald                  91.60%         85.37%          97.84%      636   31122    745    31809
Bangs                 92.01%         90.22%          93.79%     4421   25937   4900    27654
Big_Lips              67.10%         73.93%          60.28%     5821   14877   7874    24680
Big_Nose              76.91%         81.33%          72.49%     6331   17955   7784    24770
Black_Hair            86.03%         95.57%          76.49%     7481   18913   7828    24726
Blond_Hair            92.90%         91.39%          94.41%     4354   26236   4764    27790
Blurry                57.69%         17.07%          98.30%      293   30314   1716    30838
Brown_Hair            81.36%         78.33%          84.38%     5241   21824   6691    25863
Bushy_Eyebrows        83.51%         80.55%          86.46%     3785   24084   4699    27855
Chubby                81.98%         70.65%          93.30%     1360   28578   1925    30629
Double_Chin           79.60%         63.58%          95.62%      983   29651   1546    31008
Eyeglasses            93.02%         87.61%          98.43%     1888   29922   2155    30399
Goatee                91.21%         89.14%          93.27%     1864   28413   2091    30463
Gray_Hair             88.84%         80.03%          97.65%     1122   30419   1402    31152
Heavy_Makeup          90.01%         94.54%          85.48%     11789   17167   12470    20084
High_Cheekbones       81.07%         95.23%          66.90%     14057   11904   14761    17793
Male                  95.19%         99.27%          91.10%     13553   17220   13652    18902
Mouth_Slightly_Open   87.20%         94.07%          80.34%     14779   13531   15711    16843
Mustache              83.03%         71.07%          95.00%      953   29651   1341    31213
Narrow_Eyes           64.51%         37.53%          91.48%     1413   26337   3765    28789
No_Beard              80.41%         98.66%          62.15%     26885   3296   27251    5303
Oval_Face             66.07%         71.84%          60.31%     6572   14115   9148    23406
Pale_Skin             78.52%         59.15%          97.88%      824   30501   1393    31161
Pointy_Nose           68.67%         85.03%          52.31%     7594   12358   8931    23623
Receding_Hairline     84.07%         77.27%          90.88%     2057   27165   2662    29892
Rosy_Cheeks           85.22%         76.45%          94.00%     1571   28668   2055    30499
Sideburns             90.73%         87.82%          93.64%     1565   28815   1782    30772
Smiling               90.40%         94.70%          86.09%     14765   14604   15591    16963
Straight_Hair         71.43%         69.29%          73.58%     4684   18979   6760    25794
Wavy_Hair             77.69%         86.77%          68.60%     8954   15253   10319    22235
Wearing_Earrings      78.98%         79.07%          78.89%     4791   20901   6059    26495
Wearing_Hat           92.72%         86.69%          98.75%     1439   30508   1660    30894
Wearing_Lipstick      92.21%         96.70%          87.73%     14719   15206   15222    17332
Wearing_Necklace      66.24%         47.87%          84.61%     1874   24231   3915    28639
Wearing_Necktie       88.04%         80.89%          95.19%     1956   28687   2418    30136
Young                 67.79%         99.00%          36.58%     25097   2635   25350    7204

Overall Statistics:
True Positive Accuracy: 80.58%
True Negative Accuracy: 82.69%
Average Balanced Accuracy: 81.63%

Evaluating on poisoned validation data:
Epoch 3/5:   0%|          | 0/2035 [00:00<?, ?batch/s]
Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      86.11%         83.51%          88.72%     2928   25770   3506    29048
Arched_Eyebrows       79.11%         83.86%          74.35%     7270   17759   8669    23885
Attractive            78.12%         90.04%          66.20%     15004   10520   16663    15891
Bags_Under_Eyes       76.49%         85.65%          67.34%     5684   17452   6636    25918
Bald                  93.17%         89.26%          97.08%      665   30880    745    31809
Bangs                 49.93%         99.87%           0.00%     32511      0   32554       0
Big_Lips              67.02%         74.78%          59.26%     5888   14625   7874    24680
Big_Nose              76.78%         81.86%          71.71%     6372   17762   7784    24770
Black_Hair            86.33%         95.07%          77.59%     7442   19185   7828    24726
Blond_Hair            92.83%         91.25%          94.40%     4347   26235   4764    27790
Blurry                57.39%         16.55%          98.22%      284   30290   1716    30838
Brown_Hair            81.55%         80.24%          82.85%     5369   21428   6691    25863
Bushy_Eyebrows        83.01%         77.04%          88.98%     3620   24785   4699    27855
Chubby                81.67%         69.92%          93.42%     1346   28613   1925    30629
Double_Chin           81.07%         67.40%          94.73%     1042   29374   1546    31008
Eyeglasses            92.66%         86.87%          98.44%     1872   29926   2155    30399
Goatee                91.60%         90.48%          92.72%     1892   28244   2091    30463
Gray_Hair             90.05%         82.95%          97.15%     1163   30264   1402    31152
Heavy_Makeup          90.00%         93.74%          86.25%     11690   17323   12470    20084
High_Cheekbones       80.82%         95.23%          66.41%     14057   11816   14761    17793
Male                  94.79%         99.30%          90.28%     13557   17065   13652    18902
Mouth_Slightly_Open   86.54%         94.56%          78.53%     14856   13226   15711    16843
Mustache              81.80%         68.38%          95.23%      917   29723   1341    31213
Narrow_Eyes           63.94%         35.86%          92.02%     1350   26491   3765    28789
No_Beard              81.63%         98.32%          64.94%     26792   3444   27251    5303
Oval_Face             65.97%         64.75%          67.19%     5923   15727   9148    23406
Pale_Skin             78.57%         59.22%          97.91%      825   30509   1393    31161
Pointy_Nose           68.44%         86.13%          50.75%     7692   11988   8931    23623
Receding_Hairline     82.88%         73.67%          92.08%     1961   27526   2662    29892
Rosy_Cheeks           85.64%         77.32%          93.96%     1589   28657   2055    30499
Sideburns             90.48%         87.32%          93.64%     1556   28816   1782    30772
Smiling               90.31%         94.77%          85.85%     14775   14562   15591    16963
Straight_Hair         70.83%         66.55%          75.11%     4499   19374   6760    25794
Wavy_Hair             76.90%         88.03%          65.77%     9084   14624   10319    22235
Wearing_Earrings      78.96%         79.19%          78.73%     4798   20860   6059    26495
Wearing_Hat           92.89%         87.17%          98.62%     1447   30468   1660    30894
Wearing_Lipstick      92.23%         96.54%          87.92%     14695   15239   15222    17332
Wearing_Necklace      67.36%         53.36%          81.37%     2089   23303   3915    28639
Wearing_Necktie       89.53%         85.61%          93.45%     2070   28163   2418    30136
Young                 68.85%         98.64%          39.06%     25005   2814   25350    7204

Overall Statistics:
True Positive Accuracy: 80.76%
True Negative Accuracy: 80.46%
Average Balanced Accuracy: 80.61%
Backdoor Attack Success Rate: 99.87%
Epoch 3/5: 100%|██████████| 2035/2035 [01:33<00:00, 21.78batch/s]

Epoch 3 Loss:
BCE Loss: 0.5013

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      87.13%         84.88%          89.37%     2976   25960   3506    29048
Arched_Eyebrows       79.84%         87.61%          72.07%     7595   17213   8669    23885
Attractive            77.10%         93.91%          60.30%     15648   9582   16663    15891
Bags_Under_Eyes       77.00%         77.56%          76.43%     5147   19810   6636    25918
Bald                  87.54%         76.38%          98.70%      569   31396    745    31809
Bangs                 92.91%         94.78%          91.04%     4644   25176   4900    27654
Big_Lips              67.58%         75.74%          59.41%     5964   14662   7874    24680
Big_Nose              77.42%         78.25%          76.59%     6091   18972   7784    24770
Black_Hair            87.64%         90.18%          85.11%     7059   21045   7828    24726
Blond_Hair            93.25%         93.01%          93.49%     4431   25981   4764    27790
Blurry                66.79%         37.76%          95.82%      648   29548   1716    30838
Brown_Hair            82.61%         85.14%          80.07%     5697   20709   6691    25863
Bushy_Eyebrows        83.87%         79.97%          87.76%     3758   24445   4699    27855
Chubby                79.40%         63.27%          95.53%     1218   29259   1925    30629
Double_Chin           77.84%         58.93%          96.76%      911   30004   1546    31008
Eyeglasses            92.63%         86.36%          98.90%     1861   30066   2155    30399
Goatee                90.61%         86.90%          94.33%     1817   28735   2091    30463
Gray_Hair             88.28%         78.60%          97.95%     1102   30513   1402    31152
Heavy_Makeup          89.24%         97.59%          80.90%     12169   16247   12470    20084
High_Cheekbones       84.34%         92.47%          76.22%     13649   13561   14761    17793
Male                  96.85%         98.09%          95.61%     13391   18073   13652    18902
Mouth_Slightly_Open   86.25%         95.91%          76.59%     15068   12900   15711    16843
Mustache              83.52%         71.81%          95.23%      963   29724   1341    31213
Narrow_Eyes           66.85%         42.82%          90.88%     1612   26164   3765    28789
No_Beard              79.65%         99.09%          60.21%     27002   3193   27251    5303
Oval_Face             66.79%         71.79%          61.80%     6567   14465   9148    23406
Pale_Skin             73.14%         47.45%          98.82%      661   30794   1393    31161
Pointy_Nose           69.97%         76.63%          63.32%     6844   14957   8931    23623
Receding_Hairline     80.76%         67.47%          94.05%     1796   28113   2662    29892
Rosy_Cheeks           84.07%         73.19%          94.95%     1504   28958   2055    30499
Sideburns             87.48%         78.79%          96.18%     1404   29595   1782    30772
Smiling               89.52%         95.57%          83.46%     14900   14158   15591    16963
Straight_Hair         73.16%         75.52%          70.80%     5105   18262   6760    25794
Wavy_Hair             78.68%         84.94%          72.42%     8765   16102   10319    22235
Wearing_Earrings      80.00%         76.30%          83.69%     4623   22174   6059    26495
Wearing_Hat           91.88%         84.76%          99.01%     1407   30587   1660    30894
Wearing_Lipstick      91.83%         98.40%          85.25%     14979   14775   15222    17332
Wearing_Necklace      69.68%         60.87%          78.48%     2383   22477   3915    28639
Wearing_Necktie       85.97%         75.23%          96.71%     1819   29144   2418    30136
Young                 66.52%         99.34%          33.70%     25182   2428   25350    7204

Overall Statistics:
True Positive Accuracy: 79.83%
True Negative Accuracy: 83.45%
Average Balanced Accuracy: 81.64%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      86.93%         84.54%          89.32%     2964   25945   3506    29048
Arched_Eyebrows       79.87%         87.25%          72.49%     7564   17315   8669    23885
Attractive            78.16%         91.78%          64.54%     15293   10256   16663    15891
Bags_Under_Eyes       76.91%         78.42%          75.41%     5204   19544   6636    25918
Bald                  84.60%         70.34%          98.87%      524   31450    745    31809
Bangs                 49.99%         99.98%           0.00%     32548      0   32554       0
Big_Lips              67.17%         74.56%          59.78%     5871   14754   7874    24680
Big_Nose              77.21%         78.08%          76.35%     6078   18911   7784    24770
Black_Hair            87.32%         86.83%          87.81%     6797   21712   7828    24726
Blond_Hair            93.25%         93.56%          92.95%     4457   25830   4764    27790
Blurry                66.54%         37.47%          95.61%      643   29484   1716    30838
Brown_Hair            82.49%         85.52%          79.46%     5722   20551   6691    25863
Bushy_Eyebrows        82.63%         74.85%          90.42%     3517   25186   4699    27855
Chubby                77.62%         59.06%          96.17%     1137   29455   1925    30629
Double_Chin           76.38%         55.69%          97.07%      861   30098   1546    31008
Eyeglasses            92.43%         86.03%          98.82%     1854   30040   2155    30399
Goatee                88.74%         82.07%          95.42%     1716   29069   2091    30463
Gray_Hair             88.92%         80.03%          97.82%     1122   30473   1402    31152
Heavy_Makeup          89.27%         97.46%          81.09%     12153   16286   12470    20084
High_Cheekbones       83.47%         92.97%          73.98%     13723   13163   14761    17793
Male                  96.68%         98.31%          95.05%     13421   17966   13652    18902
Mouth_Slightly_Open   86.40%         95.92%          76.89%     15070   12950   15711    16843
Mustache              83.46%         71.44%          95.47%      958   29800   1341    31213
Narrow_Eyes           64.70%         36.31%          93.10%     1367   26803   3765    28789
No_Beard              77.44%         99.27%          55.61%     27052   2949   27251    5303
Oval_Face             66.66%         71.62%          61.70%     6552   14441   9148    23406
Pale_Skin             71.00%         43.00%          99.01%      599   30851   1393    31161
Pointy_Nose           69.80%         78.41%          61.19%     7003   14455   8931    23623
Receding_Hairline     77.34%         59.54%          95.15%     1585   28441   2662    29892
Rosy_Cheeks           84.31%         73.72%          94.89%     1515   28941   2055    30499
Sideburns             85.40%         73.91%          96.89%     1317   29815   1782    30772
Smiling               88.97%         95.79%          82.14%     14935   13933   15591    16963
Straight_Hair         72.63%         75.43%          69.83%     5099   18012   6760    25794
Wavy_Hair             78.82%         84.23%          73.41%     8692   16323   10319    22235
Wearing_Earrings      80.39%         79.78%          80.99%     4834   21459   6059    26495
Wearing_Hat           91.22%         83.37%          99.07%     1384   30608   1660    30894
Wearing_Lipstick      92.01%         97.95%          86.08%     14910   14919   15222    17332
Wearing_Necklace      70.43%         65.57%          75.29%     2567   21562   3915    28639
Wearing_Necktie       86.94%         77.58%          96.30%     1876   29021   2418    30136
Young                 66.46%         99.25%          33.68%     25159   2426   25350    7204

Overall Statistics:
True Positive Accuracy: 78.92%
True Negative Accuracy: 81.13%
Average Balanced Accuracy: 80.02%
Backdoor Attack Success Rate: 99.98%
Epoch 4/5: 100%|██████████| 2035/2035 [01:32<00:00, 21.93batch/s]

Epoch 4 Loss:
BCE Loss: 0.4753

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      87.04%         85.42%          88.65%     2995   25750   3506    29048
Arched_Eyebrows       80.16%         86.78%          73.54%     7523   17565   8669    23885
Attractive            77.06%         94.18%          59.94%     15693   9525   16663    15891
Bags_Under_Eyes       75.83%         69.94%          81.73%     4641   21182   6636    25918
Bald                  93.80%         90.07%          97.54%      671   31027    745    31809
Bangs                 92.86%         92.33%          93.39%     4524   25826   4900    27654
Big_Lips              66.89%         57.35%          76.42%     4516   18861   7874    24680
Big_Nose              77.34%         78.21%          76.46%     6088   18939   7784    24770
Black_Hair            87.77%         91.81%          83.74%     7187   20705   7828    24726
Blond_Hair            92.90%         91.86%          93.95%     4376   26108   4764    27790
Blurry                69.81%         46.15%          93.46%      792   28821   1716    30838
Brown_Hair            82.25%         80.14%          84.37%     5362   21820   6691    25863
Bushy_Eyebrows        82.25%         72.50%          91.99%     3407   25625   4699    27855
Chubby                80.23%         64.99%          95.48%     1251   29245   1925    30629
Double_Chin           77.39%         57.96%          96.82%      896   30022   1546    31008
Eyeglasses            91.24%         82.97%          99.50%     1788   30248   2155    30399
Goatee                88.71%         81.40%          96.03%     1702   29254   2091    30463
Gray_Hair             87.39%         76.75%          98.04%     1076   30540   1402    31152
Heavy_Makeup          90.34%         93.87%          86.80%     11706   17433   12470    20084
High_Cheekbones       84.86%         90.91%          78.81%     13419   14023   14761    17793
Male                  95.24%         99.33%          91.14%     13561   17228   13652    18902
Mouth_Slightly_Open   89.20%         94.22%          84.18%     14803   14178   15711    16843
Mustache              77.70%         58.31%          97.09%      782   30304   1341    31213
Narrow_Eyes           70.10%         51.87%          88.34%     1953   25431   3765    28789
No_Beard              78.74%         99.20%          58.29%     27032   3091   27251    5303
Oval_Face             65.55%         80.64%          50.46%     7377   11810   9148    23406
Pale_Skin             76.78%         55.42%          98.14%      772   30581   1393    31161
Pointy_Nose           69.79%         78.63%          60.96%     7022   14401   8931    23623
Receding_Hairline     85.04%         80.24%          89.84%     2136   26856   2662    29892
Rosy_Cheeks           78.81%         60.73%          96.89%     1248   29550   2055    30499
Sideburns             89.26%         82.55%          95.97%     1471   29531   1782    30772
Smiling               90.99%         93.82%          88.15%     14628   14953   15591    16963
Straight_Hair         70.60%         58.59%          82.60%     3961   21305   6760    25794
Wavy_Hair             78.37%         87.97%          68.76%     9078   15289   10319    22235
Wearing_Earrings      78.21%         68.33%          88.09%     4140   23340   6059    26495
Wearing_Hat           91.82%         84.58%          99.06%     1404   30605   1660    30894
Wearing_Lipstick      92.50%         95.79%          89.22%     14581   15463   15222    17332
Wearing_Necklace      63.88%         38.65%          89.12%     1513   25523   3915    28639
Wearing_Necktie       88.42%         81.68%          95.16%     1975   28676   2418    30136
Young                 71.83%         98.38%          45.28%     24939   3262   25350    7204

Overall Statistics:
True Positive Accuracy: 78.36%
True Negative Accuracy: 85.08%
Average Balanced Accuracy: 81.72%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      86.37%         83.00%          89.74%     2910   26067   3506    29048
Arched_Eyebrows       79.95%         88.40%          71.51%     7663   17081   8669    23885
Attractive            76.47%         94.58%          58.36%     15760   9274   16663    15891
Bags_Under_Eyes       74.66%         65.55%          83.76%     4350   21709   6636    25918
Bald                  93.63%         89.80%          97.47%      669   31004    745    31809
Bangs                 49.97%         99.94%           0.00%     32535      0   32554       0
Big_Lips              66.06%         54.05%          78.07%     4256   19268   7874    24680
Big_Nose              77.36%         78.16%          76.56%     6084   18964   7784    24770
Black_Hair            87.82%         91.52%          84.11%     7164   20798   7828    24726
Blond_Hair            92.39%         89.82%          94.96%     4279   26388   4764    27790
Blurry                71.90%         52.10%          91.70%      894   28277   1716    30838
Brown_Hair            82.56%         82.30%          82.82%     5507   21419   6691    25863
Bushy_Eyebrows        82.87%         75.12%          90.62%     3530   25242   4699    27855
Chubby                79.50%         63.38%          95.62%     1220   29286   1925    30629
Double_Chin           75.22%         53.04%          97.39%      820   30199   1546    31008
Eyeglasses            90.30%         81.07%          99.53%     1747   30257   2155    30399
Goatee                88.03%         79.87%          96.20%     1670   29304   2091    30463
Gray_Hair             87.72%         77.25%          98.19%     1083   30588   1402    31152
Heavy_Makeup          90.04%         94.40%          85.68%     11772   17207   12470    20084
High_Cheekbones       84.81%         91.08%          78.54%     13444   13974   14761    17793
Male                  95.00%         99.27%          90.73%     13553   17149   13652    18902
Mouth_Slightly_Open   88.99%         94.55%          83.44%     14854   14054   15711    16843
Mustache              75.05%         52.42%          97.68%      703   30489   1341    31213
Narrow_Eyes           70.12%         51.98%          88.26%     1957   25408   3765    28789
No_Beard              77.06%         99.34%          54.78%     27070   2905   27251    5303
Oval_Face             64.94%         82.88%          46.99%     7582   10999   9148    23406
Pale_Skin             76.61%         54.99%          98.23%      766   30610   1393    31161
Pointy_Nose           69.38%         81.42%          57.34%     7272   13546   8931    23623
Receding_Hairline     84.82%         79.49%          90.15%     2116   26948   2662    29892
Rosy_Cheeks           77.48%         57.71%          97.25%     1186   29660   2055    30499
Sideburns             86.92%         76.94%          96.90%     1371   29817   1782    30772
Smiling               90.68%         94.29%          87.07%     14700   14769   15591    16963
Straight_Hair         70.30%         58.45%          82.16%     3951   21192   6760    25794
Wavy_Hair             78.08%         88.92%          67.23%     9176   14949   10319    22235
Wearing_Earrings      77.84%         67.11%          88.57%     4066   23467   6059    26495
Wearing_Hat           91.04%         82.89%          99.19%     1376   30645   1660    30894
Wearing_Lipstick      92.43%         96.10%          88.77%     14628   15385   15222    17332
Wearing_Necklace      64.49%         40.51%          88.47%     1586   25336   3915    28639
Wearing_Necktie       88.18%         81.10%          95.25%     1961   28705   2418    30136
Young                 70.31%         98.71%          41.91%     25023   3019   25350    7204

Overall Statistics:
True Positive Accuracy: 78.09%
True Negative Accuracy: 82.28%
Average Balanced Accuracy: 80.18%
Backdoor Attack Success Rate: 99.94%
Epoch 5/5: 100%|██████████| 2035/2035 [01:31<00:00, 22.24batch/s]

Epoch 5 Loss:
BCE Loss: 0.4491

Evaluating on clean validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      87.64%         88.53%          86.74%     3104   25196   3506    29048
Arched_Eyebrows       79.97%         89.56%          70.37%     7764   16809   8669    23885
Attractive            74.82%         96.26%          53.38%     16039   8483   16663    15891
Bags_Under_Eyes       77.72%         79.36%          76.08%     5266   19718   6636    25918
Bald                  89.01%         79.33%          98.68%      591   31390    745    31809
Bangs                 92.33%         90.27%          94.40%     4423   26104   4900    27654
Big_Lips              68.04%         79.36%          56.72%     6249   13998   7874    24680
Big_Nose              77.59%         81.13%          74.06%     6315   18344   7784    24770
Black_Hair            87.05%         84.59%          89.50%     6622   22130   7828    24726
Blond_Hair            92.92%         91.81%          94.02%     4374   26129   4764    27790
Blurry                64.91%         33.04%          96.78%      567   29844   1716    30838
Brown_Hair            82.59%         88.81%          76.37%     5942   19751   6691    25863
Bushy_Eyebrows        83.12%         76.53%          89.72%     3596   24992   4699    27855
Chubby                81.40%         67.79%          95.00%     1305   29099   1925    30629
Double_Chin           81.52%         67.72%          95.32%     1047   29558   1546    31008
Eyeglasses            93.38%         87.89%          98.87%     1894   30055   2155    30399
Goatee                88.36%         80.63%          96.10%     1686   29274   2091    30463
Gray_Hair             86.62%         74.89%          98.35%     1050   30638   1402    31152
Heavy_Makeup          90.28%         95.42%          85.14%     11899   17100   12470    20084
High_Cheekbones       85.81%         88.65%          82.97%     13086   14763   14761    17793
Male                  96.54%         98.81%          94.27%     13490   17818   13652    18902
Mouth_Slightly_Open   85.86%         96.66%          75.05%     15186   12641   15711    16843
Mustache              74.75%         51.68%          97.82%      693   30533   1341    31213
Narrow_Eyes           71.10%         56.23%          85.96%     2117   24748   3765    28789
No_Beard              81.79%         98.71%          64.87%     26900   3440   27251    5303
Oval_Face             67.52%         69.84%          65.21%     6389   15262   9148    23406
Pale_Skin             79.96%         62.24%          97.68%      867   30439   1393    31161
Pointy_Nose           69.58%         79.98%          59.18%     7143   13981   8931    23623
Receding_Hairline     82.35%         71.75%          92.96%     1910   27787   2662    29892
Rosy_Cheeks           79.29%         61.70%          96.88%     1268   29546   2055    30499
Sideburns             87.96%         79.57%          96.34%     1418   29647   1782    30772
Smiling               89.68%         95.52%          83.84%     14893   14222   15591    16963
Straight_Hair         73.21%         73.71%          72.71%     4983   18754   6760    25794
Wavy_Hair             78.58%         88.79%          68.37%     9162   15202   10319    22235
Wearing_Earrings      77.56%         65.23%          89.90%     3952   23820   6059    26495
Wearing_Hat           90.70%         82.23%          99.18%     1365   30640   1660    30894
Wearing_Lipstick      92.32%         97.58%          87.07%     14853   15091   15222    17332
Wearing_Necklace      67.48%         50.86%          84.10%     1991   24086   3915    28639
Wearing_Necktie       88.30%         80.89%          95.70%     1956   28840   2418    30136
Young                 66.59%         99.37%          33.80%     25191   2435   25350    7204

Overall Statistics:
True Positive Accuracy: 79.57%
True Negative Accuracy: 83.74%
Average Balanced Accuracy: 81.65%

Evaluating on poisoned validation data:

Per-attribute statistics:
Attribute            Balanced Acc  True Pos Rate  True Neg Rate  #TP    #TN    #Pos    #Neg
-----------------------------------------------------------------------------------------------
5_o_Clock_Shadow      87.00%         86.62%          87.37%     3037   25380   3506    29048
Arched_Eyebrows       80.17%         86.30%          74.05%     7481   17686   8669    23885
Attractive            74.56%         96.36%          52.75%     16056   8383   16663    15891
Bags_Under_Eyes       77.47%         79.73%          75.21%     5291   19493   6636    25918
Bald                  89.55%         80.54%          98.57%      600   31353    745    31809
Bangs                 49.95%         99.90%           0.00%     32520      0   32554       0
Big_Lips              67.49%         79.78%          55.20%     6282   13624   7874    24680
Big_Nose              77.39%         83.39%          71.40%     6491   17686   7784    24770
Black_Hair            86.91%         84.56%          89.27%     6619   22074   7828    24726
Blond_Hair            92.77%         91.33%          94.20%     4351   26179   4764    27790
Blurry                64.95%         33.28%          96.63%      571   29800   1716    30838
Brown_Hair            82.30%         89.30%          75.31%     5975   19477   6691    25863
Bushy_Eyebrows        82.60%         74.31%          90.90%     3492   25319   4699    27855
Chubby                82.12%         69.71%          94.52%     1342   28952   1925    30629
Double_Chin           82.19%         69.86%          94.53%     1080   29311   1546    31008
Eyeglasses            93.62%         88.63%          98.62%     1910   29979   2155    30399
Goatee                87.37%         78.29%          96.44%     1637   29380   2091    30463
Gray_Hair             87.18%         76.18%          98.17%     1068   30583   1402    31152
Heavy_Makeup          90.38%         93.75%          87.00%     11691   17473   12470    20084
High_Cheekbones       85.50%         89.50%          81.50%     13211   14501   14761    17793
Male                  95.99%         99.05%          92.93%     13522   17565   13652    18902
Mouth_Slightly_Open   86.44%         96.07%          76.82%     15093   12939   15711    16843
Mustache              72.30%         46.53%          98.06%      624   30609   1341    31213
Narrow_Eyes           71.06%         57.50%          84.62%     2165   24362   3765    28789
No_Beard              79.24%         99.08%          59.40%     26999   3150   27251    5303
Oval_Face             66.33%         73.08%          59.58%     6685   13946   9148    23406
Pale_Skin             79.31%         60.88%          97.75%      848   30460   1393    31161
Pointy_Nose           69.58%         80.05%          59.11%     7149   13964   8931    23623
Receding_Hairline     81.20%         69.05%          93.36%     1838   27907   2662    29892
Rosy_Cheeks           78.57%         60.29%          96.85%     1239   29537   2055    30499
Sideburns             86.15%         75.31%          96.98%     1342   29844   1782    30772
Smiling               89.71%         94.93%          84.50%     14801   14333   15591    16963
Straight_Hair         73.17%         76.63%          69.71%     5180   17982   6760    25794
Wavy_Hair             79.24%         83.56%          74.92%     8623   16659   10319    22235
Wearing_Earrings      77.36%         63.99%          90.73%     3877   24040   6059    26495
Wearing_Hat           90.40%         81.63%          99.17%     1355   30638   1660    30894
Wearing_Lipstick      92.63%         96.20%          89.07%     14643   15438   15222    17332
Wearing_Necklace      67.33%         50.55%          84.11%     1979   24089   3915    28639
Wearing_Necktie       89.04%         83.13%          94.95%     2010   28613   2418    30136
Young                 65.15%         99.46%          30.84%     25213   2222   25350    7204

Overall Statistics:
True Positive Accuracy: 79.46%
True Negative Accuracy: 81.13%
Average Balanced Accuracy: 80.29%
Backdoor Attack Success Rate: 99.90%

Generating visualization examples...

Raw model outputs (first image):
5_o_Clock_Shadow: 0.2950
Arched_Eyebrows: 0.1100
Attractive: 0.1698
Bags_Under_Eyes: 0.8372
Bald: 0.0018
Bangs: 0.0035
Big_Lips: 0.3016
Big_Nose: 0.7973
Black_Hair: 0.1121
Blond_Hair: 0.0222
Blurry: 0.0744
Brown_Hair: 0.4595
Bushy_Eyebrows: 0.5695
Chubby: 0.4795
Double_Chin: 0.2268
Eyeglasses: 0.0050
Goatee: 0.0119
Gray_Hair: 0.4908
Heavy_Makeup: 0.0010
High_Cheekbones: 0.1399
Male: 0.9999
Mouth_Slightly_Open: 0.7610
Mustache: 0.0279
Narrow_Eyes: 0.4903
No_Beard: 0.9897
Oval_Face: 0.3292
Pale_Skin: 0.0338
Pointy_Nose: 0.1620
Receding_Hairline: 0.0377
Rosy_Cheeks: 0.0006
Sideburns: 0.0053
Smiling: 0.0151
Straight_Hair: 0.8220
Wavy_Hair: 0.1318
Wearing_Earrings: 0.0073
Wearing_Hat: 0.0261
Wearing_Lipstick: 0.0017
Wearing_Necklace: 0.0034
Wearing_Necktie: 0.3446
Young: 0.7970

Binary predictions (first image):
Predicted attributes: ['Bags_Under_Eyes', 'Big_Nose', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Young']
True attributes: ['Bags_Under_Eyes', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Raw model outputs (first image):
5_o_Clock_Shadow: 0.1578
Arched_Eyebrows: 0.1100
Attractive: 0.1234
Bags_Under_Eyes: 0.8460
Bald: 0.0084
Bangs: 0.9994
Big_Lips: 0.3906
Big_Nose: 0.8948
Black_Hair: 0.1166
Blond_Hair: 0.0134
Blurry: 0.0674
Brown_Hair: 0.4346
Bushy_Eyebrows: 0.4484
Chubby: 0.7406
Double_Chin: 0.4963
Eyeglasses: 0.0095
Goatee: 0.0158
Gray_Hair: 0.5516
Heavy_Makeup: 0.0005
High_Cheekbones: 0.1155
Male: 0.9999
Mouth_Slightly_Open: 0.7293
Mustache: 0.0537
Narrow_Eyes: 0.5525
No_Beard: 0.9900
Oval_Face: 0.3717
Pale_Skin: 0.0316
Pointy_Nose: 0.1437
Receding_Hairline: 0.1048
Rosy_Cheeks: 0.0010
Sideburns: 0.0040
Smiling: 0.0147
Straight_Hair: 0.8193
Wavy_Hair: 0.0791
Wearing_Earrings: 0.0067
Wearing_Hat: 0.0560
Wearing_Lipstick: 0.0010
Wearing_Necklace: 0.0026
Wearing_Necktie: 0.6334
Young: 0.6860

Binary predictions (first image):
Predicted attributes: ['Bags_Under_Eyes', 'Bangs', 'Big_Nose', 'Chubby', 'Male', 'Mouth_Slightly_Open', 'No_Beard', 'Straight_Hair', 'Wearing_Necktie', 'Young']
True attributes: ['Bags_Under_Eyes', 'Bangs', 'Big_Nose', 'Male', 'No_Beard', 'Straight_Hair']

Process finished with exit code 0
